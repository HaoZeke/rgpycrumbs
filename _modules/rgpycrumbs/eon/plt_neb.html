<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>rgpycrumbs.eon.plt_neb - rgpycrumbs documentation</title><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />
      <link rel="canonical" href="rgpycrumbs.rgoswami.me/_modules/rgpycrumbs/eon/plt_neb.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=a318c5d4" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
  <meta property="og:url" content="rgpycrumbs.rgoswami.me/_modules/rgpycrumbs/eon/plt_neb.html"/>
  <meta property="og:title" content="rgpycrumbs.eon.plt_neb"/>
    <meta name="twitter:card" content="summary"/>
  <!-- Manual favicon handling with favicon.io -->
<!-- since sphinx-favicon doesn't work with shibuya -->
<link rel="icon" type="image/png" sizes="16x16" href="../../../_static/favicons/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../_static/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="../../../_static/favicons/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="../../../_static/favicons/android-chrome-512x512.png">
<link rel="apple-touch-icon" sizes="180x180" href="../../../_static/favicons/apple-touch-icon.png">
<link rel="shortcut icon" href="../../../_static/favicons/favicon.ico">
<link rel="manifest" href="../../../_static/favicons/site.webmanifest">
<!-- Plausible injection -->
<script
  defer
  data-domain="rgpycrumbs.rgoswami.me"
  src="https://analytics.turtletech.us/js/script.hash.outbound-links.js"
></script>
<script>
  window.plausible =
    window.plausible ||
    function () {
      (window.plausible.q = window.plausible.q || []).push(arguments);
    };
</script></head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../../index.html">
      <img class="light-logo" src="../../../_static/pycrumbs_notext.svg" alt="rgpycrumbs" height="28" loading="lazy" />
      <img class="dark-logo" src="../../../_static/pycrumbs_notext.svg" alt="rgpycrumbs" height="28" loading="lazy" />
      <strong>rgpycrumbs</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/Haozeke/rgpycrumbs" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/eon/index.html">EON Helpers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/eon/con_splitter.html">Splitting <code class="docutils literal notranslate"><span class="pre">con</span></code> files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/eon/generate_nwchem_input.html">Generators for NWChem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/eon/mlflow.html">MLFlow Logging for EON</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/eon/plt_neb.html">Plotting NEB paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/eon/ptmdisp.html">Polyhedral Template Matcher</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/geom/index.html">Geometry Helpers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/geom/alignment.html">Robust Structural Alignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/geom/detect_fragments.html">Fragment Detection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/utils/index.html">General Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/utils/jupyter.html">Jupyter Notebook Helpers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/prefix/index.html">Prefix Helpers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/prefix/delete_packages.html">Prefix Channel Package Deletion</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devnotes.html"><code class="docutils literal notranslate"><span class="pre">rgpycrumbs</span></code> Design &amp; Architecture Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/index.html">Contributing to <code class="docutils literal notranslate"><span class="pre">rgpycrumbs</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/doc_builds.html">Documentation Standards &amp; Authoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/test_requirements.html">Testing &amp; Environment Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/release.html">Release Management</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/helpers/index.html">helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/rgpycrumbs/index.html">rgpycrumbs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/_aux/index.html">rgpycrumbs._aux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/cli/index.html">rgpycrumbs.cli</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/index.html">rgpycrumbs.eon</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/_mlflow/index.html">rgpycrumbs.eon._mlflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/con_splitter/index.html">rgpycrumbs.eon.con_splitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/generate_nwchem_input/index.html">rgpycrumbs.eon.generate_nwchem_input</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/helpers/index.html">rgpycrumbs.eon.helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html">rgpycrumbs.eon.plt_neb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/ptmdisp/index.html">rgpycrumbs.eon.ptmdisp</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/func/index.html">rgpycrumbs.func</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/func/muller_brown/index.html">rgpycrumbs.func.muller_brown</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/geom/index.html">rgpycrumbs.geom</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/geom/api/index.html">rgpycrumbs.geom.api</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/geom/detect_fragments/index.html">rgpycrumbs.geom.detect_fragments</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/parsers/index.html">rgpycrumbs.parsers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/parsers/bless/index.html">rgpycrumbs.parsers.bless</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/parsers/common/index.html">rgpycrumbs.parsers.common</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/plumed/index.html">rgpycrumbs.plumed</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/plumed/direct_reconstruction/index.html">rgpycrumbs.plumed.direct_reconstruction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/prefix/index.html">rgpycrumbs.prefix</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/prefix/delete_packages/index.html">rgpycrumbs.prefix.delete_packages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/run/index.html">rgpycrumbs.run</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/run/jupyter/index.html">rgpycrumbs.run.jupyter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/xts/index.html">rgpycrumbs.xts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/xts/cuh2/index.html">rgpycrumbs.xts.cuh2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/xts/saddle/index.html">rgpycrumbs.xts.saddle</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../index.html"><span itemprop="name">rgpycrumbs</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">rgpycrumbs.eon.plt_neb</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <article class="yue" role="main">
          <h1>Source code for rgpycrumbs.eon.plt_neb</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="ch">#!/usr/bin/env python3</span>
</span><span data-line="2"><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="3"><span class="sd">Plots Nudged Elastic Band (NEB) reaction paths and landscapes.</span>
</span><span data-line="4">
</span><span data-line="5"><span class="sd">This script provides a command-line interface (CLI) to visualize data</span>
</span><span data-line="6"><span class="sd">generated from NEB calculations. It can plot:</span>
</span><span data-line="7">
</span><span data-line="8"><span class="sd">1.  **Energy/Eigenvalue Profiles:** Shows the evolution of the energy or</span>
</span><span data-line="9"><span class="sd">    lowest eigenvalue along the reaction coordinate. It can overlay multiple</span>
</span><span data-line="10"><span class="sd">    paths (e.g., from different optimization steps) and use a</span>
</span><span data-line="11"><span class="sd">    physically-motivated Hermite spline interpolation using force data.</span>
</span><span data-line="12">
</span><span data-line="13"><span class="sd">2.  **2D Reaction Landscapes:** Plots the path on a 2D coordinate system</span>
</span><span data-line="14"><span class="sd">    defined by the Root Mean Square Deviation (RMSD) from the reactant</span>
</span><span data-line="15"><span class="sd">    and product structures. This requires the &#39;ira_mod&#39; library.</span>
</span><span data-line="16"><span class="sd">    It can also interpolate and display the 2D energy/eigenvalue surface.</span>
</span><span data-line="17">
</span><span data-line="18"><span class="sd">The script can also render atomic structures from a .con file as insets</span>
</span><span data-line="19"><span class="sd">on the plots for key points (reactant, saddle, product).</span>
</span><span data-line="20">
</span><span data-line="21"><span class="sd">This script follows the guidelines laid out here:</span>
</span><span data-line="22"><span class="sd">https://realpython.com/python-script-structure/</span>
</span><span data-line="23"><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="24">
</span><span data-line="25"><span class="c1"># /// script</span>
</span><span data-line="26"><span class="c1"># requires-python = &quot;&gt;=3.11&quot;</span>
</span><span data-line="27"><span class="c1"># dependencies = [</span>
</span><span data-line="28"><span class="c1">#   &quot;click&quot;,</span>
</span><span data-line="29"><span class="c1">#   &quot;matplotlib&quot;,</span>
</span><span data-line="30"><span class="c1">#   &quot;numpy&quot;,</span>
</span><span data-line="31"><span class="c1">#   &quot;scipy&quot;,</span>
</span><span data-line="32"><span class="c1">#   &quot;adjustText&quot;,</span>
</span><span data-line="33"><span class="c1">#   &quot;cmcrameri&quot;,</span>
</span><span data-line="34"><span class="c1">#   &quot;rich&quot;,</span>
</span><span data-line="35"><span class="c1">#   &quot;ase&quot;,</span>
</span><span data-line="36"><span class="c1">#   &quot;polars&quot;,</span>
</span><span data-line="37"><span class="c1"># ]</span>
</span><span data-line="38"><span class="c1"># ///</span>
</span><span data-line="39">
</span><span data-line="40"><span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
</span><span data-line="41"><span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
</span><span data-line="42"><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span data-line="43"><span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span data-line="44"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span data-line="45"><span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">namedtuple</span>
</span><span data-line="46"><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span>
</span><span data-line="47"><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">replace</span>
</span><span data-line="48"><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
</span><span data-line="49"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="50">
</span><span data-line="51"><span class="kn">import</span><span class="w"> </span><span class="nn">click</span>
</span><span data-line="52"><span class="kn">import</span><span class="w"> </span><span class="nn">cmcrameri.cm</span>  <span class="c1"># noqa: F401</span>
</span><span data-line="53"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
</span><span data-line="54"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patheffects</span>
</span><span data-line="55"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span data-line="56"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span data-line="57"><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
</span><span data-line="58"><span class="kn">from</span><span class="w"> </span><span class="nn">adjustText</span><span class="w"> </span><span class="kn">import</span> <span class="n">adjust_text</span>
</span><span data-line="59"><span class="kn">from</span><span class="w"> </span><span class="nn">ase.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">read</span> <span class="k">as</span> <span class="n">ase_read</span>
</span><span data-line="60"><span class="kn">from</span><span class="w"> </span><span class="nn">ase.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">write</span> <span class="k">as</span> <span class="n">ase_write</span>
</span><span data-line="61"><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">LineCollection</span>
</span><span data-line="62"><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>
</span><span data-line="63"><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.gridspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSpec</span>
</span><span data-line="64"><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.offsetbox</span><span class="w"> </span><span class="kn">import</span> <span class="n">AnnotationBbox</span><span class="p">,</span> <span class="n">OffsetImage</span>
</span><span data-line="65"><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArrowStyle</span>
</span><span data-line="66"><span class="kn">from</span><span class="w"> </span><span class="nn">rich.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">RichHandler</span>
</span><span data-line="67"><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="68">    <span class="n">CubicHermiteSpline</span><span class="p">,</span>
</span><span data-line="69">    <span class="n">RBFInterpolator</span><span class="p">,</span>
</span><span data-line="70">    <span class="n">griddata</span><span class="p">,</span>
</span><span data-line="71">    <span class="n">splev</span><span class="p">,</span>
</span><span data-line="72">    <span class="n">splrep</span><span class="p">,</span>
</span><span data-line="73"><span class="p">)</span>
</span><span data-line="74"><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="kn">import</span> <span class="n">savgol_filter</span>
</span><span data-line="75">
</span><span data-line="76"><span class="kn">from</span><span class="w"> </span><span class="nn">rgpycrumbs._aux</span><span class="w"> </span><span class="kn">import</span> <span class="n">_import_from_parent_env</span>
</span><span data-line="77"><span class="kn">from</span><span class="w"> </span><span class="nn">rgpycrumbs.geom.api.alignment</span><span class="w"> </span><span class="kn">import</span> <span class="n">IRAConfig</span><span class="p">,</span> <span class="n">align_structure_robust</span>
</span><span data-line="78">
</span><span data-line="79"><span class="c1"># IRA is optional, use None if not present</span>
<div class="viewcode-block" id="ira_mod">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.ira_mod">[docs]</a>
</span><span data-line="80"><span class="n">ira_mod</span> <span class="o">=</span> <span class="n">_import_from_parent_env</span><span class="p">(</span><span class="s2">&quot;ira_mod&quot;</span><span class="p">)</span></div>

</span><span data-line="81">
</span><span data-line="82"><span class="c1"># --- Logging Setup ---</span>
</span><span data-line="83"><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
</span><span data-line="84">    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
</span><span data-line="85">    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span data-line="86">    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">RichHandler</span><span class="p">(</span><span class="n">rich_tracebacks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_path</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">markup</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
</span><span data-line="87"><span class="p">)</span>
<div class="viewcode-block" id="log">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.log">[docs]</a>
</span><span data-line="88"><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;rich&quot;</span><span class="p">)</span></div>

</span><span data-line="89">
</span><span data-line="90">
</span><span data-line="91"><span class="c1"># --- Enumerations, Constants, and Themes ---</span>
</span><span data-line="92">
</span><span data-line="93"><span class="c1"># --- Color Definitions ---</span>
<div class="viewcode-block" id="RUHI_COLORS">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.RUHI_COLORS">[docs]</a>
</span><span data-line="94"><span class="n">RUHI_COLORS</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="95">    <span class="s2">&quot;coral&quot;</span><span class="p">:</span> <span class="s2">&quot;#FF655D&quot;</span><span class="p">,</span>
</span><span data-line="96">    <span class="s2">&quot;sunshine&quot;</span><span class="p">:</span> <span class="s2">&quot;#F1DB4B&quot;</span><span class="p">,</span>
</span><span data-line="97">    <span class="s2">&quot;teal&quot;</span><span class="p">:</span> <span class="s2">&quot;#004D40&quot;</span><span class="p">,</span>
</span><span data-line="98">    <span class="s2">&quot;sky&quot;</span><span class="p">:</span> <span class="s2">&quot;#1E88E5&quot;</span><span class="p">,</span>
</span><span data-line="99">    <span class="s2">&quot;magenta&quot;</span><span class="p">:</span> <span class="s2">&quot;#D81B60&quot;</span><span class="p">,</span>
</span><span data-line="100"><span class="p">}</span></div>

</span><span data-line="101">
<div class="viewcode-block" id="MIN_PATH_LENGTH">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.MIN_PATH_LENGTH">[docs]</a>
</span><span data-line="102"><span class="n">MIN_PATH_LENGTH</span> <span class="o">=</span> <span class="mf">1e-6</span></div>

</span><span data-line="103">
</span><span data-line="104">
</span><span data-line="105"><span class="c1"># --- Custom Colormap Generation ---</span>
<div class="viewcode-block" id="build_cmap">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.build_cmap">[docs]</a>
</span><span data-line="106"><span class="k">def</span><span class="w"> </span><span class="nf">build_cmap</span><span class="p">(</span><span class="n">hex_list</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span data-line="107"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Build and register a LinearSegmentedColormap from a list of hex colors.&quot;&quot;&quot;</span>
</span><span data-line="108">    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">hex_list</span><span class="p">]</span>
</span><span data-line="109">    <span class="n">cmap</span> <span class="o">=</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">cols</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
</span><span data-line="110">    <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
</span><span data-line="111">    <span class="k">return</span> <span class="n">cmap</span></div>

</span><span data-line="112">
</span><span data-line="113">
</span><span data-line="114"><span class="c1"># Build and register Ruhi colormaps</span>
</span><span data-line="115"><span class="n">build_cmap</span><span class="p">(</span>
</span><span data-line="116">    <span class="p">[</span>
</span><span data-line="117">        <span class="n">RUHI_COLORS</span><span class="p">[</span><span class="s2">&quot;coral&quot;</span><span class="p">],</span>
</span><span data-line="118">        <span class="n">RUHI_COLORS</span><span class="p">[</span><span class="s2">&quot;sunshine&quot;</span><span class="p">],</span>
</span><span data-line="119">        <span class="n">RUHI_COLORS</span><span class="p">[</span><span class="s2">&quot;teal&quot;</span><span class="p">],</span>
</span><span data-line="120">        <span class="n">RUHI_COLORS</span><span class="p">[</span><span class="s2">&quot;sky&quot;</span><span class="p">],</span>
</span><span data-line="121">        <span class="n">RUHI_COLORS</span><span class="p">[</span><span class="s2">&quot;magenta&quot;</span><span class="p">],</span>
</span><span data-line="122">    <span class="p">],</span>
</span><span data-line="123">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ruhi_full&quot;</span><span class="p">,</span>
</span><span data-line="124"><span class="p">)</span>
</span><span data-line="125"><span class="n">build_cmap</span><span class="p">(</span>
</span><span data-line="126">    <span class="p">[</span>
</span><span data-line="127">        <span class="n">RUHI_COLORS</span><span class="p">[</span><span class="s2">&quot;teal&quot;</span><span class="p">],</span>
</span><span data-line="128">        <span class="n">RUHI_COLORS</span><span class="p">[</span><span class="s2">&quot;sky&quot;</span><span class="p">],</span>  <span class="c1"># Low</span>
</span><span data-line="129">        <span class="n">RUHI_COLORS</span><span class="p">[</span><span class="s2">&quot;magenta&quot;</span><span class="p">],</span>  <span class="c1"># Mid</span>
</span><span data-line="130">        <span class="n">RUHI_COLORS</span><span class="p">[</span><span class="s2">&quot;coral&quot;</span><span class="p">],</span>  <span class="c1"># High</span>
</span><span data-line="131">        <span class="n">RUHI_COLORS</span><span class="p">[</span><span class="s2">&quot;sunshine&quot;</span><span class="p">],</span>
</span><span data-line="132">    <span class="p">],</span>
</span><span data-line="133">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ruhi_diverging&quot;</span><span class="p">,</span>
</span><span data-line="134"><span class="p">)</span>
</span><span data-line="135">
</span><span data-line="136">
</span><span data-line="137"><span class="c1"># --- Theme Dataclass ---</span>
</span><span data-line="138"><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<div class="viewcode-block" id="PlotTheme">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme">[docs]</a>
</span><span data-line="139"><span class="k">class</span><span class="w"> </span><span class="nc">PlotTheme</span><span class="p">:</span>
</span><span data-line="140"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Holds all aesthetic parameters for a matplotlib theme.&quot;&quot;&quot;</span>
</span><span data-line="141">
<div class="viewcode-block" id="PlotTheme.name">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme.name">[docs]</a>
</span><span data-line="142">    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span></div>

<div class="viewcode-block" id="PlotTheme.font_family">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme.font_family">[docs]</a>
</span><span data-line="143">    <span class="n">font_family</span><span class="p">:</span> <span class="nb">str</span></div>

<div class="viewcode-block" id="PlotTheme.font_size">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme.font_size">[docs]</a>
</span><span data-line="144">    <span class="n">font_size</span><span class="p">:</span> <span class="nb">int</span></div>

<div class="viewcode-block" id="PlotTheme.facecolor">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme.facecolor">[docs]</a>
</span><span data-line="145">    <span class="n">facecolor</span><span class="p">:</span> <span class="nb">str</span></div>

<div class="viewcode-block" id="PlotTheme.textcolor">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme.textcolor">[docs]</a>
</span><span data-line="146">    <span class="n">textcolor</span><span class="p">:</span> <span class="nb">str</span></div>

<div class="viewcode-block" id="PlotTheme.edgecolor">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme.edgecolor">[docs]</a>
</span><span data-line="147">    <span class="n">edgecolor</span><span class="p">:</span> <span class="nb">str</span></div>

<div class="viewcode-block" id="PlotTheme.gridcolor">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme.gridcolor">[docs]</a>
</span><span data-line="148">    <span class="n">gridcolor</span><span class="p">:</span> <span class="nb">str</span></div>

<div class="viewcode-block" id="PlotTheme.cmap_profile">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme.cmap_profile">[docs]</a>
</span><span data-line="149">    <span class="n">cmap_profile</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Colormap for 1D profile paths</span></div>

<div class="viewcode-block" id="PlotTheme.cmap_landscape">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme.cmap_landscape">[docs]</a>
</span><span data-line="150">    <span class="n">cmap_landscape</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Colormap for 2D landscape surface</span></div>

<div class="viewcode-block" id="PlotTheme.highlight_color">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotTheme.highlight_color">[docs]</a>
</span><span data-line="151">    <span class="n">highlight_color</span><span class="p">:</span> <span class="nb">str</span></div>
</div>

</span><span data-line="152">
</span><span data-line="153">
</span><span data-line="154"><span class="c1"># --- Theme Definitions ---</span>
<div class="viewcode-block" id="BATLOW_THEME">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.BATLOW_THEME">[docs]</a>
</span><span data-line="155"><span class="n">BATLOW_THEME</span> <span class="o">=</span> <span class="n">PlotTheme</span><span class="p">(</span>
</span><span data-line="156">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cmc.batlow&quot;</span><span class="p">,</span>
</span><span data-line="157">    <span class="n">font_family</span><span class="o">=</span><span class="s2">&quot;Atkinson Hyperlegible&quot;</span><span class="p">,</span>
</span><span data-line="158">    <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
</span><span data-line="159">    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span data-line="160">    <span class="n">textcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="161">    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="162">    <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;#FFFFFF&quot;</span><span class="p">,</span>
</span><span data-line="163">    <span class="n">cmap_profile</span><span class="o">=</span><span class="s2">&quot;cmc.batlow&quot;</span><span class="p">,</span>
</span><span data-line="164">    <span class="n">cmap_landscape</span><span class="o">=</span><span class="s2">&quot;cmc.batlow&quot;</span><span class="p">,</span>
</span><span data-line="165">    <span class="n">highlight_color</span><span class="o">=</span><span class="s2">&quot;#FF0000&quot;</span><span class="p">,</span>  <span class="c1"># red</span>
</span><span data-line="166"><span class="p">)</span></div>

</span><span data-line="167">
</span><span data-line="168"><span class="c1"># Theme 2: &quot;ruhi&quot;</span>
<div class="viewcode-block" id="RUHI_THEME">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.RUHI_THEME">[docs]</a>
</span><span data-line="169"><span class="n">RUHI_THEME</span> <span class="o">=</span> <span class="n">PlotTheme</span><span class="p">(</span>
</span><span data-line="170">    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;ruhi&quot;</span><span class="p">,</span>
</span><span data-line="171">    <span class="n">font_family</span><span class="o">=</span><span class="s2">&quot;Atkinson Hyperlegible&quot;</span><span class="p">,</span>
</span><span data-line="172">    <span class="n">font_size</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
</span><span data-line="173">    <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span data-line="174">    <span class="n">textcolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="175">    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="176">    <span class="n">gridcolor</span><span class="o">=</span><span class="s2">&quot;floralwhite&quot;</span><span class="p">,</span>
</span><span data-line="177">    <span class="n">cmap_profile</span><span class="o">=</span><span class="s2">&quot;ruhi_diverging&quot;</span><span class="p">,</span>
</span><span data-line="178">    <span class="n">cmap_landscape</span><span class="o">=</span><span class="s2">&quot;ruhi_diverging&quot;</span><span class="p">,</span>
</span><span data-line="179">    <span class="n">highlight_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="180"><span class="p">)</span></div>

</span><span data-line="181">
<div class="viewcode-block" id="THEMES">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.THEMES">[docs]</a>
</span><span data-line="182"><span class="n">THEMES</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="183">    <span class="s2">&quot;cmc.batlow&quot;</span><span class="p">:</span> <span class="n">BATLOW_THEME</span><span class="p">,</span>
</span><span data-line="184">    <span class="s2">&quot;ruhi&quot;</span><span class="p">:</span> <span class="n">RUHI_THEME</span><span class="p">,</span>
</span><span data-line="185"><span class="p">}</span></div>

</span><span data-line="186">
</span><span data-line="187">
</span><span data-line="188"><span class="c1"># --- Other Constants ---</span>
<div class="viewcode-block" id="PlotType">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotType">[docs]</a>
</span><span data-line="189"><span class="k">class</span><span class="w"> </span><span class="nc">PlotType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span data-line="190"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines the overall plot type.&quot;&quot;&quot;</span>
</span><span data-line="191">
<div class="viewcode-block" id="PlotType.PROFILE">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotType.PROFILE">[docs]</a>
</span><span data-line="192">    <span class="n">PROFILE</span> <span class="o">=</span> <span class="s2">&quot;profile&quot;</span></div>

<div class="viewcode-block" id="PlotType.LANDSCAPE">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotType.LANDSCAPE">[docs]</a>
</span><span data-line="193">    <span class="n">LANDSCAPE</span> <span class="o">=</span> <span class="s2">&quot;landscape&quot;</span></div>
</div>

</span><span data-line="194">
</span><span data-line="195">
<div class="viewcode-block" id="RCMode">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.RCMode">[docs]</a>
</span><span data-line="196"><span class="k">class</span><span class="w"> </span><span class="nc">RCMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span data-line="197"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines the reaction coordinate for profile plots.&quot;&quot;&quot;</span>
</span><span data-line="198">
<div class="viewcode-block" id="RCMode.PATH">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.RCMode.PATH">[docs]</a>
</span><span data-line="199">    <span class="n">PATH</span> <span class="o">=</span> <span class="s2">&quot;path&quot;</span>  <span class="c1"># Default path distance</span></div>

<div class="viewcode-block" id="RCMode.RMSD">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.RCMode.RMSD">[docs]</a>
</span><span data-line="200">    <span class="n">RMSD</span> <span class="o">=</span> <span class="s2">&quot;rmsd&quot;</span>  <span class="c1"># RMSD from reactant</span></div>

<div class="viewcode-block" id="RCMode.INDEX">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.RCMode.INDEX">[docs]</a>
</span><span data-line="201">    <span class="n">INDEX</span> <span class="o">=</span> <span class="s2">&quot;index&quot;</span>  <span class="c1"># Image number (0, 1, 2...)</span></div>
</div>

</span><span data-line="202">
</span><span data-line="203">
<div class="viewcode-block" id="PlotMode">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotMode">[docs]</a>
</span><span data-line="204"><span class="k">class</span><span class="w"> </span><span class="nc">PlotMode</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span data-line="205"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines the primary data to be plotted (Y-axis or color).&quot;&quot;&quot;</span>
</span><span data-line="206">
<div class="viewcode-block" id="PlotMode.ENERGY">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotMode.ENERGY">[docs]</a>
</span><span data-line="207">    <span class="n">ENERGY</span> <span class="o">=</span> <span class="s2">&quot;energy&quot;</span></div>

<div class="viewcode-block" id="PlotMode.EIGENVALUE">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.PlotMode.EIGENVALUE">[docs]</a>
</span><span data-line="208">    <span class="n">EIGENVALUE</span> <span class="o">=</span> <span class="s2">&quot;eigenvalue&quot;</span></div>
</div>

</span><span data-line="209">
</span><span data-line="210">
<div class="viewcode-block" id="SplineMethod">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.SplineMethod">[docs]</a>
</span><span data-line="211"><span class="k">class</span><span class="w"> </span><span class="nc">SplineMethod</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
</span><span data-line="212"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines the interpolation method for profile plots.&quot;&quot;&quot;</span>
</span><span data-line="213">
<div class="viewcode-block" id="SplineMethod.HERMITE">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.SplineMethod.HERMITE">[docs]</a>
</span><span data-line="214">    <span class="n">HERMITE</span> <span class="o">=</span> <span class="s2">&quot;hermite&quot;</span>  <span class="c1"># Cubic Hermite spline (uses derivatives/forces)</span></div>

<div class="viewcode-block" id="SplineMethod.SPLINE">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.SplineMethod.SPLINE">[docs]</a>
</span><span data-line="215">    <span class="n">SPLINE</span> <span class="o">=</span> <span class="s2">&quot;spline&quot;</span>  <span class="c1"># Standard cubic spline (no derivatives)</span></div>
</div>

</span><span data-line="216">
</span><span data-line="217">
<div class="viewcode-block" id="DEFAULT_INPUT_PATTERN">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.DEFAULT_INPUT_PATTERN">[docs]</a>
</span><span data-line="218"><span class="n">DEFAULT_INPUT_PATTERN</span> <span class="o">=</span> <span class="s2">&quot;neb_*.dat&quot;</span></div>

<div class="viewcode-block" id="DEFAULT_PATH_PATTERN">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.DEFAULT_PATH_PATTERN">[docs]</a>
</span><span data-line="219"><span class="n">DEFAULT_PATH_PATTERN</span> <span class="o">=</span> <span class="s2">&quot;neb_path_*.con&quot;</span></div>

<div class="viewcode-block" id="ROUNDING_DF">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.ROUNDING_DF">[docs]</a>
</span><span data-line="220"><span class="n">ROUNDING_DF</span> <span class="o">=</span> <span class="mi">3</span></div>

<div class="viewcode-block" id="IRA_KMAX_DEFAULT">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.IRA_KMAX_DEFAULT">[docs]</a>
</span><span data-line="221"><span class="n">IRA_KMAX_DEFAULT</span> <span class="o">=</span> <span class="mf">1.8</span></div>

</span><span data-line="222">
</span><span data-line="223">
</span><span data-line="224"><span class="nd">@dataclass</span>
<div class="viewcode-block" id="SmoothingParams">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.SmoothingParams">[docs]</a>
</span><span data-line="225"><span class="k">class</span><span class="w"> </span><span class="nc">SmoothingParams</span><span class="p">:</span>
</span><span data-line="226"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Parameters for Savitzky-Golay smoothing of force data.&quot;&quot;&quot;</span>
</span><span data-line="227">
<div class="viewcode-block" id="SmoothingParams.window_length">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.SmoothingParams.window_length">[docs]</a>
</span><span data-line="228">    <span class="n">window_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span></div>

<div class="viewcode-block" id="SmoothingParams.polyorder">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.SmoothingParams.polyorder">[docs]</a>
</span><span data-line="229">    <span class="n">polyorder</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span></div>
</div>

</span><span data-line="230">
</span><span data-line="231">
</span><span data-line="232"><span class="c1"># Datastructure for inset positioning</span>
<div class="viewcode-block" id="InsetImagePos.rad">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.InsetImagePos.rad">[docs]</a>
<div class="viewcode-block" id="InsetImagePos.y">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.InsetImagePos.y">[docs]</a>
<div class="viewcode-block" id="InsetImagePos.x">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.InsetImagePos.x">[docs]</a>
<div class="viewcode-block" id="InsetImagePos">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.InsetImagePos">[docs]</a>
</span><span data-line="233"><span class="n">InsetImagePos</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s2">&quot;InsetImagePos&quot;</span><span class="p">,</span> <span class="s2">&quot;x y rad&quot;</span><span class="p">)</span></div>
</div>
</div>
</div>

</span><span data-line="234">
</span><span data-line="235">
</span><span data-line="236"><span class="c1"># --- Utility Functions ---</span>
</span><span data-line="237">
</span><span data-line="238">
<div class="viewcode-block" id="setup_global_theme">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.setup_global_theme">[docs]</a>
</span><span data-line="239"><span class="k">def</span><span class="w"> </span><span class="nf">setup_global_theme</span><span class="p">(</span><span class="n">theme</span><span class="p">:</span> <span class="n">PlotTheme</span><span class="p">):</span>
</span><span data-line="240"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sets global plt.rcParams based on the theme *before* plot creation.&quot;&quot;&quot;</span>
</span><span data-line="241">    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Setting global rcParams for [bold cyan]</span><span class="si">{</span><span class="n">theme</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">[/bold cyan] theme&quot;</span><span class="p">)</span>
</span><span data-line="242">
</span><span data-line="243">    <span class="n">font_family_to_use</span> <span class="o">=</span> <span class="n">theme</span><span class="o">.</span><span class="n">font_family</span>
</span><span data-line="244">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="245">        <span class="c1"># Check if the font is available to matplotlib</span>
</span><span data-line="246">        <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">findfont</span><span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">font_family</span><span class="p">,</span> <span class="n">fallback_to_default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="247">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Font &#39;</span><span class="si">{</span><span class="n">theme</span><span class="o">.</span><span class="n">font_family</span><span class="si">}</span><span class="s2">&#39; found by matplotlib.&quot;</span><span class="p">)</span>
</span><span data-line="248">    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span data-line="249">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="250">            <span class="sa">f</span><span class="s2">&quot;[bold red]Font &#39;</span><span class="si">{</span><span class="n">theme</span><span class="o">.</span><span class="n">font_family</span><span class="si">}</span><span class="s2">&#39; not found.[/bold red] &quot;</span>
</span><span data-line="251">            <span class="sa">f</span><span class="s2">&quot;Falling back to &#39;sans-serif&#39;.&quot;</span>
</span><span data-line="252">        <span class="p">)</span>
</span><span data-line="253">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="254">            <span class="s2">&quot;For custom fonts to work, they must be installed on your system &quot;</span>
</span><span data-line="255">            <span class="s2">&quot;and recognized by matplotlib.&quot;</span>
</span><span data-line="256">        <span class="p">)</span>
</span><span data-line="257">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="258">            <span class="sa">f</span><span class="s2">&quot;You may need to clear the matplotlib cache: [cyan]</span><span class="si">{</span><span class="n">mpl</span><span class="o">.</span><span class="n">get_cachedir</span><span class="p">()</span><span class="si">}</span><span class="s2">[/cyan]&quot;</span>
</span><span data-line="259">        <span class="p">)</span>
</span><span data-line="260">        <span class="n">font_family_to_use</span> <span class="o">=</span> <span class="s2">&quot;sans-serif&quot;</span>
</span><span data-line="261">
</span><span data-line="262">    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
</span><span data-line="263">        <span class="p">{</span>
</span><span data-line="264">            <span class="s2">&quot;font.size&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
</span><span data-line="265">            <span class="s2">&quot;font.family&quot;</span><span class="p">:</span> <span class="n">font_family_to_use</span><span class="p">,</span>
</span><span data-line="266">            <span class="s2">&quot;text.color&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">,</span>
</span><span data-line="267">            <span class="s2">&quot;axes.labelcolor&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">,</span>
</span><span data-line="268">            <span class="s2">&quot;xtick.color&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">,</span>
</span><span data-line="269">            <span class="s2">&quot;ytick.color&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">,</span>
</span><span data-line="270">            <span class="s2">&quot;axes.edgecolor&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">edgecolor</span><span class="p">,</span>
</span><span data-line="271">            <span class="s2">&quot;axes.titlecolor&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">,</span>
</span><span data-line="272">            <span class="s2">&quot;figure.facecolor&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">facecolor</span><span class="p">,</span>  <span class="c1"># Set global figure facecolor</span>
</span><span data-line="273">            <span class="s2">&quot;axes.titlesize&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">,</span>  <span class="c1"># Make title a bit larger</span>
</span><span data-line="274">            <span class="s2">&quot;axes.labelsize&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
</span><span data-line="275">            <span class="s2">&quot;xtick.labelsize&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
</span><span data-line="276">            <span class="s2">&quot;ytick.labelsize&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
</span><span data-line="277">            <span class="s2">&quot;legend.fontsize&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">font_size</span><span class="p">,</span>
</span><span data-line="278">            <span class="s2">&quot;savefig.facecolor&quot;</span><span class="p">:</span> <span class="n">theme</span><span class="o">.</span><span class="n">facecolor</span><span class="p">,</span>  <span class="c1"># Ensure saved figs also have bg</span>
</span><span data-line="279">            <span class="s2">&quot;savefig.transparent&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="280">        <span class="p">}</span>
</span><span data-line="281">    <span class="p">)</span></div>

</span><span data-line="282">
</span><span data-line="283">
<div class="viewcode-block" id="apply_plot_theme">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.apply_plot_theme">[docs]</a>
</span><span data-line="284"><span class="k">def</span><span class="w"> </span><span class="nf">apply_plot_theme</span><span class="p">(</span><span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">,</span> <span class="n">theme</span><span class="p">:</span> <span class="n">PlotTheme</span><span class="p">):</span>
</span><span data-line="285"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies theme properties *specific* to an axis instance.&quot;&quot;&quot;</span>
</span><span data-line="286">    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Applying axis-specific theme for [bold cyan]</span><span class="si">{</span><span class="n">theme</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">[/bold cyan]&quot;</span><span class="p">)</span>
</span><span data-line="287">
</span><span data-line="288">    <span class="c1"># Set axis-specific properties</span>
</span><span data-line="289">    <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">facecolor</span><span class="p">)</span>
</span><span data-line="290">    <span class="k">for</span> <span class="n">spine</span> <span class="ow">in</span> <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span data-line="291">        <span class="n">spine</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">edgecolor</span><span class="p">)</span>
</span><span data-line="292">
</span><span data-line="293">    <span class="c1"># These are now mostly redundant if rcParams worked, but serve as a final failsafe</span>
</span><span data-line="294">    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">)</span>
</span><span data-line="295">    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">)</span>
</span><span data-line="296">    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">)</span>
</span><span data-line="297">    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">)</span>
</span><span data-line="298">    <span class="n">ax</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">)</span></div>

</span><span data-line="299">
</span><span data-line="300">
<div class="viewcode-block" id="load_paths">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.load_paths">[docs]</a>
</span><span data-line="301"><span class="k">def</span><span class="w"> </span><span class="nf">load_paths</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]:</span>
</span><span data-line="302"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Finds and sorts files matching a glob pattern.&quot;&quot;&quot;</span>
</span><span data-line="303">    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Searching for files with pattern: &#39;</span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
</span><span data-line="304">    <span class="n">file_paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">file_pattern</span><span class="p">))</span>
</span><span data-line="305">    <span class="k">if</span> <span class="ow">not</span> <span class="n">file_paths</span><span class="p">:</span>
</span><span data-line="306">        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No files found matching &#39;</span><span class="si">{</span><span class="n">file_pattern</span><span class="si">}</span><span class="s2">&#39;. Exiting.&quot;</span><span class="p">)</span>
</span><span data-line="307">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="308">    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">file_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> file(s).&quot;</span><span class="p">)</span>
</span><span data-line="309">    <span class="k">return</span> <span class="n">file_paths</span></div>

</span><span data-line="310">
</span><span data-line="311">
<div class="viewcode-block" id="calculate_rmsd_from_ref">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.calculate_rmsd_from_ref">[docs]</a>
</span><span data-line="312"><span class="k">def</span><span class="w"> </span><span class="nf">calculate_rmsd_from_ref</span><span class="p">(</span>
</span><span data-line="313">    <span class="n">atoms_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">ira_instance</span><span class="p">,</span> <span class="n">ref_atom</span><span class="p">:</span> <span class="s2">&quot;ase.Atoms&quot;</span><span class="p">,</span> <span class="n">ira_kmax</span><span class="p">:</span> <span class="nb">float</span>
</span><span data-line="314"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
</span><span data-line="315"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="316"><span class="sd">    Calculates the RMSD of each structure in a list relative to a reference.</span>
</span><span data-line="317">
</span><span data-line="318"><span class="sd">    The function first attempts the IRA algorithm to handle atom permutations.</span>
</span><span data-line="319"><span class="sd">    If IRA fails or lacks the necessary library, the code falls back to</span>
</span><span data-line="320"><span class="sd">    standard ASE Procrustes alignment (minimize_rotation_and_translation).</span>
</span><span data-line="321">
</span><span data-line="322"><span class="sd">    :param atoms_list: A list of ASE Atoms objects.</span>
</span><span data-line="323"><span class="sd">    :type atoms_list: list</span>
</span><span data-line="324"><span class="sd">    :param ira_instance: An instantiated IRA object.</span>
</span><span data-line="325"><span class="sd">    :type ira_instance: ira_mod.IRA</span>
</span><span data-line="326"><span class="sd">    :param ref_atom: The reference Atoms object to align against.</span>
</span><span data-line="327"><span class="sd">    :type ref_atom: ase.Atoms</span>
</span><span data-line="328"><span class="sd">    :param ira_kmax: kmax factor for IRA.</span>
</span><span data-line="329"><span class="sd">    :type ira_kmax: float</span>
</span><span data-line="330"><span class="sd">    :return: An array of RMSD values, one for each structure in `atoms_list`.</span>
</span><span data-line="331"><span class="sd">    :rtype: np.ndarray</span>
</span><span data-line="332"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="333">    <span class="n">rmsd_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">))</span>
</span><span data-line="334">    <span class="n">coords_ref</span> <span class="o">=</span> <span class="n">ref_atom</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
</span><span data-line="335">
</span><span data-line="336">    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">atom_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">):</span>
</span><span data-line="337">        <span class="k">if</span> <span class="n">atom_i</span> <span class="ow">is</span> <span class="n">ref_atom</span><span class="p">:</span>
</span><span data-line="338">            <span class="n">rmsd_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span data-line="339">            <span class="k">continue</span>
</span><span data-line="340">
</span><span data-line="341">        <span class="c1"># Create a working copy to avoid mutating the original trajectory</span>
</span><span data-line="342">        <span class="c1"># during the plotting/analysis phase</span>
</span><span data-line="343">        <span class="n">mobile_copy</span> <span class="o">=</span> <span class="n">atom_i</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span data-line="344">
</span><span data-line="345">        <span class="c1"># Delegate alignment to the robust library function</span>
</span><span data-line="346">        <span class="n">align_structure_robust</span><span class="p">(</span>
</span><span data-line="347">            <span class="n">ref_atom</span><span class="p">,</span>
</span><span data-line="348">            <span class="n">mobile_copy</span><span class="p">,</span>
</span><span data-line="349">            <span class="n">IRAConfig</span><span class="p">(</span><span class="n">enabled</span><span class="o">=</span><span class="p">(</span><span class="n">ira_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">),</span> <span class="n">kmax</span><span class="o">=</span><span class="n">ira_kmax</span><span class="p">),</span>
</span><span data-line="350">        <span class="p">)</span>
</span><span data-line="351">
</span><span data-line="352">        <span class="c1"># Calculate RMSD: $\sqrt{\frac{1}{N} \sum (r_{ref} - r_{aligned})^2}$</span>
</span><span data-line="353">        <span class="n">coords_aligned</span> <span class="o">=</span> <span class="n">mobile_copy</span><span class="o">.</span><span class="n">get_positions</span><span class="p">()</span>
</span><span data-line="354">        <span class="n">diff_sq</span> <span class="o">=</span> <span class="p">(</span><span class="n">coords_ref</span> <span class="o">-</span> <span class="n">coords_aligned</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
</span><span data-line="355">        <span class="n">rmsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">diff_sq</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
</span><span data-line="356">        <span class="n">rmsd_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmsd</span>
</span><span data-line="357">
</span><span data-line="358">    <span class="k">return</span> <span class="n">rmsd_values</span></div>

</span><span data-line="359">
</span><span data-line="360">
<div class="viewcode-block" id="calculate_landscape_coords">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.calculate_landscape_coords">[docs]</a>
</span><span data-line="361"><span class="k">def</span><span class="w"> </span><span class="nf">calculate_landscape_coords</span><span class="p">(</span>
</span><span data-line="362">    <span class="n">atoms_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">ira_instance</span><span class="p">:</span> <span class="s2">&quot;ira_mod.IRA&quot;</span><span class="p">,</span> <span class="n">ira_kmax</span><span class="p">:</span> <span class="nb">float</span>
</span><span data-line="363"><span class="p">):</span>
</span><span data-line="364"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="365"><span class="sd">    Calculates 2D landscape coordinates (RMSD-R, RMSD-P) for a path.</span>
</span><span data-line="366">
</span><span data-line="367"><span class="sd">    :param atoms_list: List of ASE Atoms objects representing the path.</span>
</span><span data-line="368"><span class="sd">    :type atoms_list: list</span>
</span><span data-line="369"><span class="sd">    :param ira_instance: An instantiated IRA object.</span>
</span><span data-line="370"><span class="sd">    :type ira_instance: ira_mod.IRA</span>
</span><span data-line="371"><span class="sd">    :param ira_kmax: kmax factor for IRA.</span>
</span><span data-line="372"><span class="sd">    :type ira_kmax: float</span>
</span><span data-line="373"><span class="sd">    :return: A tuple of (rmsd_r, rmsd_p) arrays relative to reactant and product.</span>
</span><span data-line="374"><span class="sd">    :rtype: tuple[np.ndarray, np.ndarray]</span>
</span><span data-line="375"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="376">    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="377">        <span class="s2">&quot;Calculating landscape coordinates using [bold magenta]ira.match[/bold magenta]...&quot;</span>
</span><span data-line="378">    <span class="p">)</span>
</span><span data-line="379">    <span class="n">rmsd_r</span> <span class="o">=</span> <span class="n">calculate_rmsd_from_ref</span><span class="p">(</span>
</span><span data-line="380">        <span class="n">atoms_list</span><span class="p">,</span> <span class="n">ira_instance</span><span class="p">,</span> <span class="n">ref_atom</span><span class="o">=</span><span class="n">atoms_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ira_kmax</span><span class="o">=</span><span class="n">ira_kmax</span>
</span><span data-line="381">    <span class="p">)</span>
</span><span data-line="382">    <span class="n">rmsd_p</span> <span class="o">=</span> <span class="n">calculate_rmsd_from_ref</span><span class="p">(</span>
</span><span data-line="383">        <span class="n">atoms_list</span><span class="p">,</span> <span class="n">ira_instance</span><span class="p">,</span> <span class="n">ref_atom</span><span class="o">=</span><span class="n">atoms_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ira_kmax</span><span class="o">=</span><span class="n">ira_kmax</span>
</span><span data-line="384">    <span class="p">)</span>
</span><span data-line="385">    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Landscape coordinate calculation complete.&quot;</span><span class="p">)</span>
</span><span data-line="386">    <span class="k">return</span> <span class="n">rmsd_r</span><span class="p">,</span> <span class="n">rmsd_p</span></div>

</span><span data-line="387">
</span><span data-line="388">
<div class="viewcode-block" id="_load_or_compute_data">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb._load_or_compute_data">[docs]</a>
</span><span data-line="389"><span class="k">def</span><span class="w"> </span><span class="nf">_load_or_compute_data</span><span class="p">(</span>
</span><span data-line="390">    <span class="n">cache_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="391">    <span class="n">force_recompute</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span data-line="392">    <span class="n">validation_check</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span> <span class="kc">None</span><span class="p">],</span>
</span><span data-line="393">    <span class="n">computation_callback</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[],</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">],</span>
</span><span data-line="394">    <span class="n">context_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span data-line="395"><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span data-line="396"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="397"><span class="sd">    Retrieves data from a parquet cache or triggers a computation callback.</span>
</span><span data-line="398">
</span><span data-line="399"><span class="sd">    :param cache_file: The path to the cache file.</span>
</span><span data-line="400"><span class="sd">    :type cache_file: Path | None</span>
</span><span data-line="401"><span class="sd">    :param force_recompute: If True, skips loading and forces computation.</span>
</span><span data-line="402"><span class="sd">    :type force_recompute: bool</span>
</span><span data-line="403"><span class="sd">    :param validation_check: A function that receives the loaded DataFrame and raises ValueError</span>
</span><span data-line="404"><span class="sd">                             if the schema appears incorrect (e.g., missing columns).</span>
</span><span data-line="405"><span class="sd">    :type validation_check: Callable</span>
</span><span data-line="406"><span class="sd">    :param computation_callback: A function that performs the heavy calculation and returns a DataFrame</span>
</span><span data-line="407"><span class="sd">                                 if the cache remains unavailable or invalid.</span>
</span><span data-line="408"><span class="sd">    :type computation_callback: Callable</span>
</span><span data-line="409"><span class="sd">    :param context_name: Label for logging (e.g., &quot;Profile&quot; or &quot;Landscape&quot;).</span>
</span><span data-line="410"><span class="sd">    :type context_name: str</span>
</span><span data-line="411"><span class="sd">    :return: The requested data.</span>
</span><span data-line="412"><span class="sd">    :rtype: pl.DataFrame</span>
</span><span data-line="413"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="414">    <span class="c1"># Attempt to load from cache</span>
</span><span data-line="415">    <span class="k">if</span> <span class="n">cache_file</span> <span class="ow">and</span> <span class="n">cache_file</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force_recompute</span><span class="p">:</span>
</span><span data-line="416">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="417">            <span class="sa">f</span><span class="s2">&quot;Loading cached </span><span class="si">{</span><span class="n">context_name</span><span class="si">}</span><span class="s2"> data from [green]</span><span class="si">{</span><span class="n">cache_file</span><span class="si">}</span><span class="s2">[/green]...&quot;</span>
</span><span data-line="418">        <span class="p">)</span>
</span><span data-line="419">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="420">            <span class="n">df</span> <span class="o">=</span> <span class="n">pl</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">cache_file</span><span class="p">)</span>
</span><span data-line="421">            <span class="n">validation_check</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span data-line="422">            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s2"> rows from cache.&quot;</span><span class="p">)</span>
</span><span data-line="423">            <span class="k">return</span> <span class="n">df</span>
</span><span data-line="424">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="425">            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cache load failed or invalid: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. Recomputing...&quot;</span><span class="p">)</span>
</span><span data-line="426">
</span><span data-line="427">    <span class="c1"># Compute if cache failed, didn&#39;t exist, or recompute requested</span>
</span><span data-line="428">    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing </span><span class="si">{</span><span class="n">context_name</span><span class="si">}</span><span class="s2"> data...&quot;</span><span class="p">)</span>
</span><span data-line="429">    <span class="n">df</span> <span class="o">=</span> <span class="n">computation_callback</span><span class="p">()</span>
</span><span data-line="430">
</span><span data-line="431">    <span class="c1"># Save to cache</span>
</span><span data-line="432">    <span class="k">if</span> <span class="n">cache_file</span><span class="p">:</span>
</span><span data-line="433">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving </span><span class="si">{</span><span class="n">context_name</span><span class="si">}</span><span class="s2"> cache to [green]</span><span class="si">{</span><span class="n">cache_file</span><span class="si">}</span><span class="s2">[/green]...&quot;</span><span class="p">)</span>
</span><span data-line="434">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="435">            <span class="n">df</span><span class="o">.</span><span class="n">write_parquet</span><span class="p">(</span><span class="n">cache_file</span><span class="p">)</span>
</span><span data-line="436">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="437">            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to write cache file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="438">
</span><span data-line="439">    <span class="k">return</span> <span class="n">df</span></div>

</span><span data-line="440">
</span><span data-line="441">
<div class="viewcode-block" id="plot_structure_strip">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.plot_structure_strip">[docs]</a>
</span><span data-line="442"><span class="k">def</span><span class="w"> </span><span class="nf">plot_structure_strip</span><span class="p">(</span>
</span><span data-line="443">    <span class="n">ax</span><span class="p">,</span>
</span><span data-line="444">    <span class="n">atoms_list</span><span class="p">,</span>
</span><span data-line="445">    <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="446">    <span class="n">zoom</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span data-line="447">    <span class="n">ase_rotation</span><span class="o">=</span><span class="s2">&quot;0x, 90y, 0z&quot;</span><span class="p">,</span>
</span><span data-line="448">    <span class="n">theme_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="449">    <span class="n">max_cols</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span data-line="450"><span class="p">):</span>
</span><span data-line="451"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="452"><span class="sd">    Renders a horizontal gallery of atomic structures (equidistant).</span>
</span><span data-line="453"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="454">    <span class="c1"># completely turn off axis lines/ticks</span>
</span><span data-line="455">    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s2">&quot;off&quot;</span><span class="p">)</span>
</span><span data-line="456">
</span><span data-line="457">    <span class="n">n_plot</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span>
</span><span data-line="458">    <span class="c1"># Calculate Grid Dimensions</span>
</span><span data-line="459">    <span class="n">n_cols</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">n_plot</span><span class="p">,</span> <span class="n">max_cols</span><span class="p">)</span>
</span><span data-line="460">    <span class="n">n_rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_plot</span> <span class="o">+</span> <span class="n">max_cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">max_cols</span>
</span><span data-line="461">
</span><span data-line="462">    <span class="c1"># Define Layout Constants (Data Units)</span>
</span><span data-line="463">    <span class="n">row_step</span> <span class="o">=</span> <span class="mf">8.5</span>  <span class="c1"># Vertical distance between rows</span>
</span><span data-line="464">
</span><span data-line="465">    <span class="c1"># Set Limits</span>
</span><span data-line="466">    <span class="c1"># X: [0, max_cols-1] with padding</span>
</span><span data-line="467">    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n_cols</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>
</span><span data-line="468">    <span class="c1"># Y: Top row at 0, bottom row at -(n_rows-1)*row_step</span>
</span><span data-line="469">    <span class="n">y_max</span> <span class="o">=</span> <span class="mf">0.6</span>
</span><span data-line="470">    <span class="n">y_min</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">n_rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">row_step</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.8</span>
</span><span data-line="471">    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>
</span><span data-line="472">
</span><span data-line="473">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_plot</span><span class="p">):</span>
</span><span data-line="474">        <span class="n">atoms</span> <span class="o">=</span> <span class="n">atoms_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span data-line="475">        <span class="c1"># Force integer positioning (0, 1, 2...)</span>
</span><span data-line="476">        <span class="n">x_pos</span> <span class="o">=</span> <span class="n">i</span>
</span><span data-line="477">
</span><span data-line="478">        <span class="c1"># Grid Coordinates</span>
</span><span data-line="479">        <span class="n">col</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="n">max_cols</span>
</span><span data-line="480">        <span class="n">row</span> <span class="o">=</span> <span class="n">i</span> <span class="o">//</span> <span class="n">max_cols</span>
</span><span data-line="481">
</span><span data-line="482">        <span class="n">x_pos</span> <span class="o">=</span> <span class="n">col</span>
</span><span data-line="483">        <span class="n">y_pos</span> <span class="o">=</span> <span class="o">-</span><span class="n">row</span> <span class="o">*</span> <span class="n">row_step</span>
</span><span data-line="484">
</span><span data-line="485">        <span class="c1"># High-Res Rendering</span>
</span><span data-line="486">        <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
</span><span data-line="487">        <span class="n">ase_write</span><span class="p">(</span>
</span><span data-line="488">            <span class="n">buf</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span> <span class="n">show_unit_cell</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">100</span>
</span><span data-line="489">        <span class="p">)</span>
</span><span data-line="490">        <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span data-line="491">        <span class="n">img_data</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
</span><span data-line="492">        <span class="n">buf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span data-line="493">
</span><span data-line="494">        <span class="c1"># Adjust Zoom</span>
</span><span data-line="495">        <span class="n">effective_zoom</span> <span class="o">=</span> <span class="n">zoom</span> <span class="o">*</span> <span class="mf">0.45</span>
</span><span data-line="496">        <span class="n">imagebox</span> <span class="o">=</span> <span class="n">OffsetImage</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="n">effective_zoom</span><span class="p">)</span>
</span><span data-line="497">
</span><span data-line="498">        <span class="n">ab</span> <span class="o">=</span> <span class="n">AnnotationBbox</span><span class="p">(</span>
</span><span data-line="499">            <span class="n">imagebox</span><span class="p">,</span>
</span><span data-line="500">            <span class="p">(</span><span class="n">x_pos</span><span class="p">,</span> <span class="n">y_pos</span><span class="p">),</span>
</span><span data-line="501">            <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="502">            <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
</span><span data-line="503">            <span class="n">boxcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
</span><span data-line="504">            <span class="n">pad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span data-line="505">        <span class="p">)</span>
</span><span data-line="506">        <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ab</span><span class="p">)</span>
</span><span data-line="507">
</span><span data-line="508">        <span class="k">if</span> <span class="n">labels</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
</span><span data-line="509">            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span data-line="510">                <span class="n">x_pos</span><span class="p">,</span>
</span><span data-line="511">                <span class="n">y_pos</span> <span class="o">-</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span data-line="512">                <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span data-line="513">                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span data-line="514">                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
</span><span data-line="515">                <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
</span><span data-line="516">                <span class="n">color</span><span class="o">=</span><span class="n">theme_color</span><span class="p">,</span>
</span><span data-line="517">                <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
</span><span data-line="518">            <span class="p">)</span></div>

</span><span data-line="519">
</span><span data-line="520">
</span><span data-line="521"><span class="c1"># --- Plotting Functions ---</span>
<div class="viewcode-block" id="plot_single_inset">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.plot_single_inset">[docs]</a>
</span><span data-line="522"><span class="k">def</span><span class="w"> </span><span class="nf">plot_single_inset</span><span class="p">(</span>
</span><span data-line="523">    <span class="n">ax</span><span class="p">,</span>
</span><span data-line="524">    <span class="n">atoms</span><span class="p">,</span>
</span><span data-line="525">    <span class="n">x_coord</span><span class="p">,</span>
</span><span data-line="526">    <span class="n">y_coord</span><span class="p">,</span>
</span><span data-line="527">    <span class="n">xybox</span><span class="o">=</span><span class="p">(</span><span class="mf">15.0</span><span class="p">,</span> <span class="mf">60.0</span><span class="p">),</span>
</span><span data-line="528">    <span class="n">rad</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
</span><span data-line="529">    <span class="n">zoom</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
</span><span data-line="530">    <span class="n">ase_rotation</span><span class="o">=</span><span class="s2">&quot;0x, 90y, 0z&quot;</span><span class="p">,</span>
</span><span data-line="531">    <span class="n">arrow_head_length</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
</span><span data-line="532">    <span class="n">arrow_head_width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
</span><span data-line="533">    <span class="n">arrow_tail_width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span data-line="534"><span class="p">):</span>
</span><span data-line="535"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="536"><span class="sd">    Renders a single ASE Atoms object and plots it as an inset.</span>
</span><span data-line="537">
</span><span data-line="538"><span class="sd">    :param ax: The axis to plot on.</span>
</span><span data-line="539"><span class="sd">    :type ax: matplotlib.axes.Axes</span>
</span><span data-line="540"><span class="sd">    :param atoms: The atomic structure to render.</span>
</span><span data-line="541"><span class="sd">    :type atoms: ase.Atoms</span>
</span><span data-line="542"><span class="sd">    :param x_coord: The x-data coordinate to anchor the arrow to.</span>
</span><span data-line="543"><span class="sd">    :type x_coord: float</span>
</span><span data-line="544"><span class="sd">    :param y_coord: The y-data coordinate to anchor the arrow to.</span>
</span><span data-line="545"><span class="sd">    :type y_coord: float</span>
</span><span data-line="546"><span class="sd">    :param xybox: The (x, y) offset in points for placing the image box.</span>
</span><span data-line="547"><span class="sd">    :type xybox: tuple, optional</span>
</span><span data-line="548"><span class="sd">    :param rad: The connection style &#39;rad&#39; parameter for the arrow.</span>
</span><span data-line="549"><span class="sd">    :type rad: float, optional</span>
</span><span data-line="550"><span class="sd">    :param zoom: Scale the inset image.</span>
</span><span data-line="551"><span class="sd">    :type zoom: float</span>
</span><span data-line="552"><span class="sd">    :param ase_rotation: ASE rotation string for structure insets.</span>
</span><span data-line="553"><span class="sd">    :type ase_rotation: str</span>
</span><span data-line="554"><span class="sd">    :param arrow_head_length: Arrow head length for insets.</span>
</span><span data-line="555"><span class="sd">    :type arrow_head_length: float</span>
</span><span data-line="556"><span class="sd">    :param arrow_head_width: Arrow head width for insets.</span>
</span><span data-line="557"><span class="sd">    :type arrow_head_width: float</span>
</span><span data-line="558"><span class="sd">    :param arrow_tail_width: Arrow tail width for insets.</span>
</span><span data-line="559"><span class="sd">    :type arrow_tail_width: float</span>
</span><span data-line="560"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="561">    <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
</span><span data-line="562">    <span class="n">ase_write</span><span class="p">(</span>
</span><span data-line="563">        <span class="n">buf</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span> <span class="n">show_unit_cell</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">35</span>
</span><span data-line="564">    <span class="p">)</span>
</span><span data-line="565">    <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span data-line="566">    <span class="n">img_data</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
</span><span data-line="567">    <span class="n">buf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span data-line="568">
</span><span data-line="569">    <span class="n">imagebox</span> <span class="o">=</span> <span class="n">OffsetImage</span><span class="p">(</span><span class="n">img_data</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="n">zoom</span><span class="p">)</span>
</span><span data-line="570">    <span class="n">ab</span> <span class="o">=</span> <span class="n">AnnotationBbox</span><span class="p">(</span>
</span><span data-line="571">        <span class="n">imagebox</span><span class="p">,</span>
</span><span data-line="572">        <span class="p">(</span><span class="n">x_coord</span><span class="p">,</span> <span class="n">y_coord</span><span class="p">),</span>
</span><span data-line="573">        <span class="n">xybox</span><span class="o">=</span><span class="n">xybox</span><span class="p">,</span>
</span><span data-line="574">        <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="575">        <span class="n">xycoords</span><span class="o">=</span><span class="s2">&quot;data&quot;</span><span class="p">,</span>
</span><span data-line="576">        <span class="n">boxcoords</span><span class="o">=</span><span class="s2">&quot;offset points&quot;</span><span class="p">,</span>
</span><span data-line="577">        <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span data-line="578">        <span class="n">arrowprops</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="579">            <span class="s2">&quot;arrowstyle&quot;</span><span class="p">:</span> <span class="n">ArrowStyle</span><span class="o">.</span><span class="n">Fancy</span><span class="p">(</span>
</span><span data-line="580">                <span class="n">head_length</span><span class="o">=</span><span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="581">                <span class="n">head_width</span><span class="o">=</span><span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="582">                <span class="n">tail_width</span><span class="o">=</span><span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="583">            <span class="p">),</span>
</span><span data-line="584">            <span class="s2">&quot;connectionstyle&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;arc3,rad=</span><span class="si">{</span><span class="n">rad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span data-line="585">            <span class="s2">&quot;linestyle&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span data-line="586">            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span data-line="587">            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>  <span class="c1"># NOTE: This is hardcoded, could be themed</span>
</span><span data-line="588">            <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>
</span><span data-line="589">        <span class="p">},</span>
</span><span data-line="590">    <span class="p">)</span>
</span><span data-line="591">    <span class="n">ax</span><span class="o">.</span><span class="n">add_artist</span><span class="p">(</span><span class="n">ab</span><span class="p">)</span>
</span><span data-line="592">    <span class="n">ab</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">80</span><span class="p">)</span></div>

</span><span data-line="593">
</span><span data-line="594">
<div class="viewcode-block" id="plot_structure_insets">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.plot_structure_insets">[docs]</a>
</span><span data-line="595"><span class="k">def</span><span class="w"> </span><span class="nf">plot_structure_insets</span><span class="p">(</span>
</span><span data-line="596">    <span class="n">ax</span><span class="p">,</span>
</span><span data-line="597">    <span class="n">atoms_list</span><span class="p">,</span>
</span><span data-line="598">    <span class="n">x_coords</span><span class="p">,</span>
</span><span data-line="599">    <span class="n">y_coords</span><span class="p">,</span>
</span><span data-line="600">    <span class="n">saddle_data</span><span class="p">,</span>
</span><span data-line="601">    <span class="n">images_to_plot</span><span class="p">,</span>
</span><span data-line="602">    <span class="n">plot_mode</span><span class="p">,</span>
</span><span data-line="603">    <span class="n">draw_reactant</span><span class="p">:</span> <span class="n">InsetImagePos</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="604">    <span class="n">draw_saddle</span><span class="p">:</span> <span class="n">InsetImagePos</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="605">    <span class="n">draw_product</span><span class="p">:</span> <span class="n">InsetImagePos</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="606">    <span class="n">zoom_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span data-line="607">    <span class="n">ase_rotation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;0x, 90y, 0z&quot;</span><span class="p">,</span>
</span><span data-line="608">    <span class="n">arrow_head_length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span data-line="609">    <span class="n">arrow_head_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span>
</span><span data-line="610">    <span class="n">arrow_tail_width</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
</span><span data-line="611"><span class="p">):</span>
</span><span data-line="612"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="613"><span class="sd">    Plots insets for critical points (reactant, saddle, product) or all images.</span>
</span><span data-line="614">
</span><span data-line="615"><span class="sd">    :param ax: The axis to plot on.</span>
</span><span data-line="616"><span class="sd">    :type ax: matplotlib.axes.Axes</span>
</span><span data-line="617"><span class="sd">    :param atoms_list: List of all ASE Atoms objects for the path.</span>
</span><span data-line="618"><span class="sd">    :type atoms_list: list</span>
</span><span data-line="619"><span class="sd">    :param x_coords: Array of x-coordinates (RC or RMSD-R) for each image.</span>
</span><span data-line="620"><span class="sd">    :type x_coords: np.ndarray</span>
</span><span data-line="621"><span class="sd">    :param y_coords: Array of y-coordinates (Energy, Eigenvalue, or RMSD-P) for each image.</span>
</span><span data-line="622"><span class="sd">    :type y_coords: np.ndarray</span>
</span><span data-line="623"><span class="sd">    :param saddle_data: Data used to find the saddle point. For energy mode, this is the</span>
</span><span data-line="624"><span class="sd">                        energy array. For eigenvalue mode, this is the eigenvalue array.</span>
</span><span data-line="625"><span class="sd">    :type saddle_data: np.ndarray</span>
</span><span data-line="626"><span class="sd">    :param images_to_plot: Which images to plot: &quot;all&quot; or &quot;crit_points&quot;.</span>
</span><span data-line="627"><span class="sd">    :type images_to_plot: str</span>
</span><span data-line="628"><span class="sd">    :param plot_mode: &quot;energy&quot; or &quot;eigenvalue&quot;, used to determine saddle point logic.</span>
</span><span data-line="629"><span class="sd">    :type plot_mode: str</span>
</span><span data-line="630"><span class="sd">    :param draw_reactant: Positioning info for the reactant inset.</span>
</span><span data-line="631"><span class="sd">    :type draw_reactant: InsetImagePos</span>
</span><span data-line="632"><span class="sd">    :param draw_saddle: Positioning info for the saddle inset.</span>
</span><span data-line="633"><span class="sd">    :type draw_saddle: InsetImagePos</span>
</span><span data-line="634"><span class="sd">    :param draw_product: Positioning info for the product inset.</span>
</span><span data-line="635"><span class="sd">    :type draw_product: InsetImagePos</span>
</span><span data-line="636"><span class="sd">    :param zoom_ratio: Scale the inset image.</span>
</span><span data-line="637"><span class="sd">    :type zoom_ratio: float</span>
</span><span data-line="638"><span class="sd">    :param ase_rotation: ASE rotation string for structure insets.</span>
</span><span data-line="639"><span class="sd">    :type ase_rotation: str</span>
</span><span data-line="640"><span class="sd">    :param arrow_head_length: Arrow head length for insets.</span>
</span><span data-line="641"><span class="sd">    :type arrow_head_length: float</span>
</span><span data-line="642"><span class="sd">    :param arrow_head_width: Arrow head width for insets.</span>
</span><span data-line="643"><span class="sd">    :type arrow_head_width: float</span>
</span><span data-line="644"><span class="sd">    :param arrow_tail_width: Arrow tail width for insets.</span>
</span><span data-line="645"><span class="sd">    :type arrow_tail_width: float</span>
</span><span data-line="646"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="647">    <span class="k">if</span> <span class="n">draw_reactant</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="648">        <span class="n">draw_reactant</span> <span class="o">=</span> <span class="n">InsetImagePos</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span data-line="649">    <span class="k">if</span> <span class="n">draw_saddle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="650">        <span class="n">draw_saddle</span> <span class="o">=</span> <span class="n">InsetImagePos</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span data-line="651">    <span class="k">if</span> <span class="n">draw_product</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="652">        <span class="n">draw_product</span> <span class="o">=</span> <span class="n">InsetImagePos</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
</span><span data-line="653">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_coords</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_coords</span><span class="p">):</span>
</span><span data-line="654">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="655">            <span class="sa">f</span><span class="s2">&quot;Mismatch between number of structures (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span data-line="656">            <span class="sa">f</span><span class="s2">&quot; and data points (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">x_coords</span><span class="p">)</span><span class="si">}</span><span class="s2">). Skipping structure plotting.&quot;</span>
</span><span data-line="657">        <span class="p">)</span>
</span><span data-line="658">        <span class="k">return</span>
</span><span data-line="659">
</span><span data-line="660">    <span class="n">plot_indices</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="661">    <span class="n">saddle_index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># Initialize</span>
</span><span data-line="662">    <span class="k">if</span> <span class="n">images_to_plot</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span data-line="663">        <span class="n">plot_indices</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">))</span>
</span><span data-line="664">    <span class="k">elif</span> <span class="n">images_to_plot</span> <span class="o">==</span> <span class="s2">&quot;crit_points&quot;</span><span class="p">:</span>
</span><span data-line="665">        <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span>
</span><span data-line="666">            <span class="c1"># Saddle is max energy, *excluding* endpoints</span>
</span><span data-line="667">            <span class="n">saddle_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">saddle_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
</span><span data-line="668">        <span class="k">else</span><span class="p">:</span>  <span class="c1"># plot_mode == &quot;eigenvalue&quot;</span>
</span><span data-line="669">            <span class="c1"># Saddle is min eigenvalue (can be any point)</span>
</span><span data-line="670">            <span class="n">saddle_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">saddle_data</span><span class="p">)</span>
</span><span data-line="671">
</span><span data-line="672">        <span class="n">crit_indices</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="n">saddle_index</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}</span>
</span><span data-line="673">        <span class="n">plot_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">crit_indices</span><span class="p">)</span>
</span><span data-line="674">
</span><span data-line="675">    <span class="c1"># Plot the selected structures</span>
</span><span data-line="676">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">plot_indices</span><span class="p">:</span>
</span><span data-line="677">        <span class="k">if</span> <span class="n">images_to_plot</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span data-line="678">            <span class="n">y_offset</span> <span class="o">=</span> <span class="mf">60.0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mf">60.0</span>
</span><span data-line="679">            <span class="n">xybox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">y_offset</span><span class="p">)</span>
</span><span data-line="680">            <span class="n">rad</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mf">0.1</span>
</span><span data-line="681">        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="682">            <span class="n">xybox</span> <span class="o">=</span> <span class="p">(</span><span class="n">draw_reactant</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">draw_reactant</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</span><span data-line="683">            <span class="n">rad</span> <span class="o">=</span> <span class="n">draw_reactant</span><span class="o">.</span><span class="n">rad</span>
</span><span data-line="684">        <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">saddle_index</span><span class="p">:</span>
</span><span data-line="685">            <span class="n">xybox</span> <span class="o">=</span> <span class="p">(</span><span class="n">draw_saddle</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">draw_saddle</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</span><span data-line="686">            <span class="n">rad</span> <span class="o">=</span> <span class="n">draw_saddle</span><span class="o">.</span><span class="n">rad</span>
</span><span data-line="687">        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Product</span>
</span><span data-line="688">            <span class="n">xybox</span> <span class="o">=</span> <span class="p">(</span><span class="n">draw_product</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">draw_product</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
</span><span data-line="689">            <span class="n">rad</span> <span class="o">=</span> <span class="n">draw_product</span><span class="o">.</span><span class="n">rad</span>
</span><span data-line="690">
</span><span data-line="691">        <span class="n">plot_single_inset</span><span class="p">(</span>
</span><span data-line="692">            <span class="n">ax</span><span class="p">,</span>
</span><span data-line="693">            <span class="n">atoms_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span data-line="694">            <span class="n">x_coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span data-line="695">            <span class="n">y_coords</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span data-line="696">            <span class="n">xybox</span><span class="o">=</span><span class="n">xybox</span><span class="p">,</span>
</span><span data-line="697">            <span class="n">rad</span><span class="o">=</span><span class="n">rad</span><span class="p">,</span>
</span><span data-line="698">            <span class="n">zoom</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="699">            <span class="n">ase_rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="700">            <span class="n">arrow_head_length</span><span class="o">=</span><span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="701">            <span class="n">arrow_head_width</span><span class="o">=</span><span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="702">            <span class="n">arrow_tail_width</span><span class="o">=</span><span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="703">        <span class="p">)</span></div>

</span><span data-line="704">
</span><span data-line="705">
<div class="viewcode-block" id="plot_energy_path">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.plot_energy_path">[docs]</a>
</span><span data-line="706"><span class="k">def</span><span class="w"> </span><span class="nf">plot_energy_path</span><span class="p">(</span>
</span><span data-line="707">    <span class="n">ax</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;hermite&quot;</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="n">SmoothingParams</span><span class="p">()</span>
</span><span data-line="708"><span class="p">):</span>
</span><span data-line="709"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="710"><span class="sd">    Plots a single interpolated energy path and its data points.</span>
</span><span data-line="711">
</span><span data-line="712"><span class="sd">    Supports two interpolation methods:</span>
</span><span data-line="713">
</span><span data-line="714"><span class="sd">    * &#39;hermite&#39;: Cubic Hermite spline. Uses energy values and their</span>
</span><span data-line="715"><span class="sd">      derivatives (taken from the parallel force `f_para`). This is</span>
</span><span data-line="716"><span class="sd">      often a more physically accurate interpolation for NEB paths.</span>
</span><span data-line="717"><span class="sd">    * &#39;spline&#39;: Standard cubic spline. Ignores derivative information.</span>
</span><span data-line="718">
</span><span data-line="719"><span class="sd">    :param ax: The axis to plot on.</span>
</span><span data-line="720"><span class="sd">    :type ax: matplotlib.axes.Axes</span>
</span><span data-line="721"><span class="sd">    :param path_data: 2D array of data (from neb_*.dat), transposed.</span>
</span><span data-line="722"><span class="sd">                      Expected: path_data[1] = rc, path_data[2] = energy, path_data[3] = f_para</span>
</span><span data-line="723"><span class="sd">    :type path_data: np.ndarray</span>
</span><span data-line="724"><span class="sd">    :param color: Color for the plot.</span>
</span><span data-line="725"><span class="sd">    :type color: str or tuple</span>
</span><span data-line="726"><span class="sd">    :param alpha: Transparency for the plot.</span>
</span><span data-line="727"><span class="sd">    :type alpha: float</span>
</span><span data-line="728"><span class="sd">    :param zorder: Plotting layer order.</span>
</span><span data-line="729"><span class="sd">    :type zorder: int</span>
</span><span data-line="730"><span class="sd">    :param method: Interpolation method: &quot;hermite&quot; or &quot;spline&quot;.</span>
</span><span data-line="731"><span class="sd">    :type method: str, optional</span>
</span><span data-line="732"><span class="sd">    :param smoothing: Parameters for Savitzky-Golay filter if using Hermite spline.</span>
</span><span data-line="733"><span class="sd">    :type smoothing: SmoothingParams, optional</span>
</span><span data-line="734"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="735">    <span class="n">rc</span> <span class="o">=</span> <span class="n">path_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="736">    <span class="n">energy</span> <span class="o">=</span> <span class="n">path_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span data-line="737">    <span class="n">f_para</span> <span class="o">=</span> <span class="n">path_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
</span><span data-line="738">    <span class="n">deriv</span> <span class="o">=</span> <span class="o">-</span><span class="n">f_para</span>
</span><span data-line="739">
</span><span data-line="740">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="741">        <span class="c1"># Sort data by reaction coordinate for correct interpolation</span>
</span><span data-line="742">        <span class="n">sort_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
</span><span data-line="743">        <span class="n">rc_sorted</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">]</span>
</span><span data-line="744">        <span class="n">energy_sorted</span> <span class="o">=</span> <span class="n">energy</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">]</span>
</span><span data-line="745">
</span><span data-line="746">        <span class="c1"># Normalize RC to [0, 1] for stable spline fitting</span>
</span><span data-line="747">        <span class="n">rc_min</span><span class="p">,</span> <span class="n">rc_max</span> <span class="o">=</span> <span class="n">rc_sorted</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">rc_sorted</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span data-line="748">        <span class="n">path_length</span> <span class="o">=</span> <span class="n">rc_max</span> <span class="o">-</span> <span class="n">rc_min</span>
</span><span data-line="749">        <span class="k">if</span> <span class="n">path_length</span> <span class="o">&gt;</span> <span class="n">MIN_PATH_LENGTH</span><span class="p">:</span>
</span><span data-line="750">            <span class="n">rc_norm_sorted</span> <span class="o">=</span> <span class="p">(</span><span class="n">rc_sorted</span> <span class="o">-</span> <span class="n">rc_min</span><span class="p">)</span> <span class="o">/</span> <span class="n">path_length</span>
</span><span data-line="751">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="752">            <span class="n">rc_norm_sorted</span> <span class="o">=</span> <span class="n">rc_sorted</span>
</span><span data-line="753">        <span class="n">rc_fine_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span data-line="754">
</span><span data-line="755">        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;hermite&quot;</span><span class="p">:</span>
</span><span data-line="756">            <span class="c1"># Smooth the derivatives to reduce noise</span>
</span><span data-line="757">            <span class="n">deriv_smooth</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span>
</span><span data-line="758">                <span class="n">deriv</span><span class="p">,</span>
</span><span data-line="759">                <span class="n">window_length</span><span class="o">=</span><span class="n">smoothing</span><span class="o">.</span><span class="n">window_length</span><span class="p">,</span>
</span><span data-line="760">                <span class="n">polyorder</span><span class="o">=</span><span class="n">smoothing</span><span class="o">.</span><span class="n">polyorder</span><span class="p">,</span>
</span><span data-line="761">            <span class="p">)</span>
</span><span data-line="762">            <span class="n">deriv_smooth_sorted</span> <span class="o">=</span> <span class="n">deriv_smooth</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">]</span>
</span><span data-line="763">            <span class="n">deriv_scaled</span> <span class="o">=</span> <span class="n">deriv_smooth_sorted</span> <span class="o">*</span> <span class="n">path_length</span>
</span><span data-line="764">
</span><span data-line="765">            <span class="c1"># Use Hermite spline which respects both values and derivatives</span>
</span><span data-line="766">            <span class="n">hermite_spline</span> <span class="o">=</span> <span class="n">CubicHermiteSpline</span><span class="p">(</span>
</span><span data-line="767">                <span class="n">rc_norm_sorted</span><span class="p">,</span> <span class="n">energy_sorted</span><span class="p">,</span> <span class="n">deriv_scaled</span>
</span><span data-line="768">            <span class="p">)</span>
</span><span data-line="769">            <span class="n">spline_y</span> <span class="o">=</span> <span class="n">hermite_spline</span><span class="p">(</span><span class="n">rc_fine_norm</span><span class="p">)</span>
</span><span data-line="770">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="771">            <span class="c1"># Use standard cubic spline</span>
</span><span data-line="772">            <span class="n">spline_representation</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">rc_norm_sorted</span><span class="p">,</span> <span class="n">energy_sorted</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="773">            <span class="n">spline_y</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">rc_fine_norm</span><span class="p">,</span> <span class="n">spline_representation</span><span class="p">)</span>
</span><span data-line="774">
</span><span data-line="775">        <span class="c1"># Rescale fine RC back to original units for plotting</span>
</span><span data-line="776">        <span class="n">rc_plot_fine</span> <span class="o">=</span> <span class="n">rc_fine_norm</span> <span class="o">*</span> <span class="n">path_length</span> <span class="o">+</span> <span class="n">rc_min</span>
</span><span data-line="777">
</span><span data-line="778">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="779">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Interpolation failed (</span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">), falling back to standard spline.&quot;</span><span class="p">)</span>
</span><span data-line="780">        <span class="n">spline_representation</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="781">        <span class="n">rc_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rc</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">rc</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">num</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span data-line="782">        <span class="n">spline_y</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">rc_fine</span><span class="p">,</span> <span class="n">spline_representation</span><span class="p">)</span>
</span><span data-line="783">        <span class="n">rc_plot_fine</span> <span class="o">=</span> <span class="n">rc_fine</span>
</span><span data-line="784">
</span><span data-line="785">    <span class="c1"># Plot the interpolated line</span>
</span><span data-line="786">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rc_plot_fine</span><span class="p">,</span> <span class="n">spline_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
</span><span data-line="787">    <span class="c1"># Plot the original data points</span>
</span><span data-line="788">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span data-line="789">        <span class="n">rc</span><span class="p">,</span>
</span><span data-line="790">        <span class="n">energy</span><span class="p">,</span>
</span><span data-line="791">        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
</span><span data-line="792">        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span data-line="793">        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span data-line="794">        <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span data-line="795">        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
</span><span data-line="796">        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span data-line="797">        <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span data-line="798">        <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span data-line="799">    <span class="p">)</span></div>

</span><span data-line="800">
</span><span data-line="801">
<div class="viewcode-block" id="plot_eigenvalue_path">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.plot_eigenvalue_path">[docs]</a>
</span><span data-line="802"><span class="k">def</span><span class="w"> </span><span class="nf">plot_eigenvalue_path</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="p">,</span> <span class="n">grid_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">):</span>
</span><span data-line="803"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="804"><span class="sd">    Plots a single interpolated eigenvalue path and its data points.</span>
</span><span data-line="805">
</span><span data-line="806"><span class="sd">    :param ax: The matplotlib axes object on which to plot.</span>
</span><span data-line="807"><span class="sd">    :type ax: matplotlib.axes.Axes</span>
</span><span data-line="808"><span class="sd">    :param path_data: 2D array of data (from neb_*.dat), transposed.</span>
</span><span data-line="809"><span class="sd">                      Expected: path_data[1] = rc, path_data[4] = eigenvalue</span>
</span><span data-line="810"><span class="sd">    :type path_data: np.ndarray</span>
</span><span data-line="811"><span class="sd">    :param color: Color specification for the plot line and markers.</span>
</span><span data-line="812"><span class="sd">    :type color: str or tuple</span>
</span><span data-line="813"><span class="sd">    :param alpha: Transparency level for the plot line and markers.</span>
</span><span data-line="814"><span class="sd">    :type alpha: float</span>
</span><span data-line="815"><span class="sd">    :param zorder: Drawing order for the plot elements.</span>
</span><span data-line="816"><span class="sd">    :type zorder: int</span>
</span><span data-line="817"><span class="sd">    :param grid_color: Color for the horizontal zero line.</span>
</span><span data-line="818"><span class="sd">    :type grid_color: str, optional</span>
</span><span data-line="819"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="820">    <span class="n">rc</span> <span class="o">=</span> <span class="n">path_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="821">    <span class="n">eigenvalue</span> <span class="o">=</span> <span class="n">path_data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
</span><span data-line="822">
</span><span data-line="823">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="824">        <span class="c1"># Sort data by reaction coordinate</span>
</span><span data-line="825">        <span class="n">sort_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
</span><span data-line="826">        <span class="n">rc_sorted</span> <span class="o">=</span> <span class="n">rc</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">]</span>
</span><span data-line="827">        <span class="n">eigenvalue_sorted</span> <span class="o">=</span> <span class="n">eigenvalue</span><span class="p">[</span><span class="n">sort_indices</span><span class="p">]</span>
</span><span data-line="828">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span data-line="829">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not sort eigenvalue data, plotting as is.&quot;</span><span class="p">)</span>
</span><span data-line="830">        <span class="n">rc_sorted</span> <span class="o">=</span> <span class="n">rc</span>
</span><span data-line="831">        <span class="n">eigenvalue_sorted</span> <span class="o">=</span> <span class="n">eigenvalue</span>
</span><span data-line="832">
</span><span data-line="833">    <span class="c1"># Interpolate using a standard cubic spline</span>
</span><span data-line="834">    <span class="n">rc_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rc</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">rc</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">num</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</span><span data-line="835">    <span class="n">spline_representation</span> <span class="o">=</span> <span class="n">splrep</span><span class="p">(</span><span class="n">rc_sorted</span><span class="p">,</span> <span class="n">eigenvalue_sorted</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="836">    <span class="n">spline_y</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">rc_fine</span><span class="p">,</span> <span class="n">spline_representation</span><span class="p">)</span>
</span><span data-line="837">
</span><span data-line="838">    <span class="c1"># Plot the interpolated line</span>
</span><span data-line="839">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rc_fine</span><span class="p">,</span> <span class="n">spline_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
</span><span data-line="840">    <span class="c1"># Plot the original data points</span>
</span><span data-line="841">    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span data-line="842">        <span class="n">rc</span><span class="p">,</span>
</span><span data-line="843">        <span class="n">eigenvalue</span><span class="p">,</span>
</span><span data-line="844">        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
</span><span data-line="845">        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span data-line="846">        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span data-line="847">        <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
</span><span data-line="848">        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
</span><span data-line="849">        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span data-line="850">        <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span data-line="851">        <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span data-line="852">    <span class="p">)</span>
</span><span data-line="853">    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">grid_color</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

</span><span data-line="854">
</span><span data-line="855">
<div class="viewcode-block" id="plot_landscape_path">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.plot_landscape_path">[docs]</a>
</span><span data-line="856"><span class="k">def</span><span class="w"> </span><span class="nf">plot_landscape_path</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">rmsd_r</span><span class="p">,</span> <span class="n">rmsd_p</span><span class="p">,</span> <span class="n">z_data</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">z_label</span><span class="p">):</span>
</span><span data-line="857"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="858"><span class="sd">    Plots the 1D path on the 2D RMSD landscape, colored by z_data.</span>
</span><span data-line="859"><span class="sd">    ...</span>
</span><span data-line="860"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="861">    <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
</span><span data-line="862">    <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">z_data</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">z_data</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</span><span data-line="863">
</span><span data-line="864">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="865">        <span class="n">colormap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
</span><span data-line="866">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span data-line="867">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Colormap &#39;</span><span class="si">{</span><span class="n">cmap</span><span class="si">}</span><span class="s2">&#39; not in registry. Falling back to &#39;batlow&#39;.&quot;</span><span class="p">)</span>
</span><span data-line="868">        <span class="n">colormap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;cmc.batlow&quot;</span><span class="p">)</span>
</span><span data-line="869">
</span><span data-line="870">    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">rmsd_r</span><span class="p">,</span> <span class="n">rmsd_p</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span data-line="871">    <span class="n">segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="872">    <span class="n">lc</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</span><span data-line="873">    <span class="n">segment_z</span> <span class="o">=</span> <span class="p">(</span><span class="n">z_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">z_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
</span><span data-line="874">    <span class="n">lc</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">segment_z</span><span class="p">)</span>
</span><span data-line="875">    <span class="n">lc</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span><span data-line="876">    <span class="n">ax</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
</span><span data-line="877">
</span><span data-line="878">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span data-line="879">        <span class="n">rmsd_r</span><span class="p">,</span>
</span><span data-line="880">        <span class="n">rmsd_p</span><span class="p">,</span>
</span><span data-line="881">        <span class="n">c</span><span class="o">=</span><span class="n">z_data</span><span class="p">,</span>
</span><span data-line="882">        <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span>
</span><span data-line="883">        <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
</span><span data-line="884">        <span class="n">edgecolors</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="885">        <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span data-line="886">        <span class="n">zorder</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
</span><span data-line="887">    <span class="p">)</span>
</span><span data-line="888">
</span><span data-line="889">    <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
</span><span data-line="890">    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">z_label</span><span class="p">)</span></div>

</span><span data-line="891">
</span><span data-line="892">
<div class="viewcode-block" id="plot_interpolated_grid">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.plot_interpolated_grid">[docs]</a>
</span><span data-line="893"><span class="k">def</span><span class="w"> </span><span class="nf">plot_interpolated_grid</span><span class="p">(</span>
</span><span data-line="894">    <span class="n">ax</span><span class="p">,</span> <span class="n">rmsd_r</span><span class="p">,</span> <span class="n">rmsd_p</span><span class="p">,</span> <span class="n">z_data</span><span class="p">,</span> <span class="n">show_pts</span><span class="p">,</span> <span class="n">cmap</span><span class="p">,</span> <span class="n">scatter_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scatter_p</span><span class="o">=</span><span class="kc">None</span>
</span><span data-line="895"><span class="p">):</span>
</span><span data-line="896"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="897"><span class="sd">    Generates and plots an interpolated 2D surface (contour plot) with splines.</span>
</span><span data-line="898">
</span><span data-line="899"><span class="sd">    This may have artifacts where samples are not present, debug with show_pts</span>
</span><span data-line="900"><span class="sd">    or use with &quot;last&quot;.</span>
</span><span data-line="901">
</span><span data-line="902"><span class="sd">    :param ax: The axis to plot on.</span>
</span><span data-line="903"><span class="sd">    :type ax: matplotlib.axes.Axes</span>
</span><span data-line="904"><span class="sd">    :param rmsd_r: RMSD from reactant (x-axis).</span>
</span><span data-line="905"><span class="sd">    :type rmsd_r: np.ndarray</span>
</span><span data-line="906"><span class="sd">    :param rmsd_p: RMSD from product (y-axis).</span>
</span><span data-line="907"><span class="sd">    :type rmsd_p: np.ndarray</span>
</span><span data-line="908"><span class="sd">    :param z_data: Data for coloring the path (z-axis).</span>
</span><span data-line="909"><span class="sd">    :type z_data: np.ndarray</span>
</span><span data-line="910"><span class="sd">    :param show_pts: Whether to show scatter points.</span>
</span><span data-line="911"><span class="sd">    :type show_pts: bool</span>
</span><span data-line="912"><span class="sd">    :param cmap: Name of the colormap to use.</span>
</span><span data-line="913"><span class="sd">    :type cmap: str</span>
</span><span data-line="914"><span class="sd">    :param scatter_r: Optional separate x-coords for scatter points.</span>
</span><span data-line="915"><span class="sd">    :type scatter_r: np.ndarray, optional</span>
</span><span data-line="916"><span class="sd">    :param scatter_p: Optional separate y-coords for scatter points.</span>
</span><span data-line="917"><span class="sd">    :type scatter_p: np.ndarray, optional</span>
</span><span data-line="918"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="919">    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating interpolated 2D surface...&quot;</span><span class="p">)</span>
</span><span data-line="920">    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Visualised best with &#39;last&#39;&quot;</span><span class="p">)</span>
</span><span data-line="921">    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rmsd_r</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">rmsd_r</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
</span><span data-line="922">    <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rmsd_p</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">rmsd_p</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
</span><span data-line="923">    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
</span><span data-line="924">
</span><span data-line="925">    <span class="n">z</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">((</span><span class="n">rmsd_r</span><span class="p">,</span> <span class="n">rmsd_p</span><span class="p">),</span> <span class="n">z_data</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;cubic&quot;</span><span class="p">)</span>
</span><span data-line="926">
</span><span data-line="927">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="928">        <span class="n">colormap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
</span><span data-line="929">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span data-line="930">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Colormap &#39;</span><span class="si">{</span><span class="n">cmap</span><span class="si">}</span><span class="s2">&#39; not in registry. Falling back to &#39;batlow&#39;.&quot;</span><span class="p">)</span>
</span><span data-line="931">        <span class="n">colormap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;cmc.batlow&quot;</span><span class="p">)</span>
</span><span data-line="932">
</span><span data-line="933">    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span data-line="934">    <span class="k">if</span> <span class="n">show_pts</span><span class="p">:</span>
</span><span data-line="935">        <span class="n">pts_r</span> <span class="o">=</span> <span class="n">scatter_r</span> <span class="k">if</span> <span class="n">scatter_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rmsd_r</span>
</span><span data-line="936">        <span class="n">pts_p</span> <span class="o">=</span> <span class="n">scatter_p</span> <span class="k">if</span> <span class="n">scatter_p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rmsd_p</span>
</span><span data-line="937">        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pts_r</span><span class="p">,</span> <span class="n">pts_p</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span></div>

</span><span data-line="938">
</span><span data-line="939">
<div class="viewcode-block" id="plot_interpolated_rbf">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.plot_interpolated_rbf">[docs]</a>
</span><span data-line="940"><span class="k">def</span><span class="w"> </span><span class="nf">plot_interpolated_rbf</span><span class="p">(</span>
</span><span data-line="941">    <span class="n">ax</span><span class="p">,</span>
</span><span data-line="942">    <span class="n">rmsd_r</span><span class="p">,</span>
</span><span data-line="943">    <span class="n">rmsd_p</span><span class="p">,</span>
</span><span data-line="944">    <span class="n">z_data</span><span class="p">,</span>
</span><span data-line="945">    <span class="n">show_pts</span><span class="p">,</span>
</span><span data-line="946">    <span class="n">rbf_smoothing</span><span class="p">,</span>
</span><span data-line="947">    <span class="n">cmap</span><span class="p">,</span>
</span><span data-line="948">    <span class="n">scatter_r</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="949">    <span class="n">scatter_p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="950"><span class="p">):</span>
</span><span data-line="951"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="952"><span class="sd">    Generates and plots an interpolated 2D surface (contour plot).</span>
</span><span data-line="953">
</span><span data-line="954"><span class="sd">    :param ax: The axis to plot on.</span>
</span><span data-line="955"><span class="sd">    :type ax: matplotlib.axes.Axes</span>
</span><span data-line="956"><span class="sd">    :param rmsd_r: RMSD from reactant (x-axis).</span>
</span><span data-line="957"><span class="sd">    :type rmsd_r: np.ndarray</span>
</span><span data-line="958"><span class="sd">    :param rmsd_p: RMSD from product (y-axis).</span>
</span><span data-line="959"><span class="sd">    :type rmsd_p: np.ndarray</span>
</span><span data-line="960"><span class="sd">    :param z_data: Data for coloring the path (z-axis).</span>
</span><span data-line="961"><span class="sd">    :type z_data: np.ndarray</span>
</span><span data-line="962"><span class="sd">    :param show_pts: Whether to show scatter points.</span>
</span><span data-line="963"><span class="sd">    :type show_pts: bool</span>
</span><span data-line="964"><span class="sd">    :param rbf_smoothing: Smoothing parameter for RBF interpolation.</span>
</span><span data-line="965"><span class="sd">    :type rbf_smoothing: float</span>
</span><span data-line="966"><span class="sd">    :param cmap: Name of the colormap to use.</span>
</span><span data-line="967"><span class="sd">    :type cmap: str</span>
</span><span data-line="968"><span class="sd">    :param scatter_r: Optional separate x-coords for scatter points.</span>
</span><span data-line="969"><span class="sd">    :type scatter_r: np.ndarray, optional</span>
</span><span data-line="970"><span class="sd">    :param scatter_p: Optional separate y-coords for scatter points.</span>
</span><span data-line="971"><span class="sd">    :type scatter_p: np.ndarray, optional</span>
</span><span data-line="972"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="973">    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generating interpolated RBF 2D surface...&quot;</span><span class="p">)</span>
</span><span data-line="974">    <span class="c1"># Prepare input points for the interpolator: shape (n_samples, 2)</span>
</span><span data-line="975">    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rmsd_r</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rmsd_p</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
</span><span data-line="976">    <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">z_data</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
</span><span data-line="977">    <span class="n">rbf</span> <span class="o">=</span> <span class="n">RBFInterpolator</span><span class="p">(</span>
</span><span data-line="978">        <span class="n">pts</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">kernel</span><span class="o">=</span><span class="s2">&quot;thin_plate_spline&quot;</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="n">rbf_smoothing</span>
</span><span data-line="979">    <span class="p">)</span>
</span><span data-line="980">    <span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">150</span>
</span><span data-line="981">    <span class="n">xg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rmsd_r</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">rmsd_r</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">nx</span><span class="p">)</span>
</span><span data-line="982">    <span class="n">yg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">rmsd_p</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">rmsd_p</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">ny</span><span class="p">)</span>
</span><span data-line="983">    <span class="n">xg</span><span class="p">,</span> <span class="n">yg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xg</span><span class="p">,</span> <span class="n">yg</span><span class="p">)</span>
</span><span data-line="984">
</span><span data-line="985">    <span class="n">query_pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">xg</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="n">yg</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
</span><span data-line="986">    <span class="n">zflat</span> <span class="o">=</span> <span class="n">rbf</span><span class="p">(</span><span class="n">query_pts</span><span class="p">)</span>  <span class="c1"># returns shape (nx*ny,)</span>
</span><span data-line="987">    <span class="n">zg</span> <span class="o">=</span> <span class="n">zflat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">xg</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span data-line="988">
</span><span data-line="989">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="990">        <span class="n">colormap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>
</span><span data-line="991">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span data-line="992">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Colormap &#39;</span><span class="si">{</span><span class="n">cmap</span><span class="si">}</span><span class="s2">&#39; not in registry. Falling back to &#39;batlow&#39;.&quot;</span><span class="p">)</span>
</span><span data-line="993">        <span class="n">colormap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;cmc.batlow&quot;</span><span class="p">)</span>
</span><span data-line="994">
</span><span data-line="995">    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xg</span><span class="p">,</span> <span class="n">yg</span><span class="p">,</span> <span class="n">zg</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</span><span data-line="996">
</span><span data-line="997">    <span class="k">if</span> <span class="n">show_pts</span><span class="p">:</span>
</span><span data-line="998">        <span class="n">pts_r</span> <span class="o">=</span> <span class="n">scatter_r</span> <span class="k">if</span> <span class="n">scatter_r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rmsd_r</span>
</span><span data-line="999">        <span class="n">pts_p</span> <span class="o">=</span> <span class="n">scatter_p</span> <span class="k">if</span> <span class="n">scatter_p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">rmsd_p</span>
</span><span data-line="1000">        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">pts_r</span><span class="p">,</span> <span class="n">pts_p</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span></div>

</span><span data-line="1001">
</span><span data-line="1002">
<div class="viewcode-block" id="setup_plot_aesthetics">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.setup_plot_aesthetics">[docs]</a>
</span><span data-line="1003"><span class="k">def</span><span class="w"> </span><span class="nf">setup_plot_aesthetics</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">):</span>
</span><span data-line="1004"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Applies labels, limits, and other plot aesthetics.&quot;&quot;&quot;</span>
</span><span data-line="1005">    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</span><span data-line="1006">    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</span><span data-line="1007">    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
</span><span data-line="1008">    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
</span><span data-line="1009">    <span class="k">if</span> <span class="n">xlabel</span> <span class="o">!=</span> <span class="sa">r</span><span class="s2">&quot;RMSD from Reactant ($\AA$)&quot;</span><span class="p">:</span>
</span><span data-line="1010">        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span data-line="1011">    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="1012">    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span></div>

</span><span data-line="1013">
</span><span data-line="1014">
</span><span data-line="1015"><span class="c1"># --- CLI ---</span>
</span><span data-line="1016"><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
</span><span data-line="1017"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1018">    <span class="s2">&quot;--input-dat-pattern&quot;</span><span class="p">,</span>
</span><span data-line="1019">    <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_INPUT_PATTERN</span><span class="p">,</span>
</span><span data-line="1020">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Glob pattern for input data files.&quot;</span><span class="p">,</span>
</span><span data-line="1021"><span class="p">)</span>
</span><span data-line="1022"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1023">    <span class="s2">&quot;--input-path-pattern&quot;</span><span class="p">,</span>
</span><span data-line="1024">    <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_PATH_PATTERN</span><span class="p">,</span>
</span><span data-line="1025">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Glob pattern for input path files.&quot;</span><span class="p">,</span>
</span><span data-line="1026"><span class="p">)</span>
</span><span data-line="1027"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1028">    <span class="s2">&quot;--con-file&quot;</span><span class="p">,</span>
</span><span data-line="1029">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
</span><span data-line="1030">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1031">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to .con trajectory file.&quot;</span><span class="p">,</span>
</span><span data-line="1032"><span class="p">)</span>
</span><span data-line="1033"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1034">    <span class="s2">&quot;--additional-con&quot;</span><span class="p">,</span>
</span><span data-line="1035">    <span class="nb">type</span><span class="o">=</span><span class="p">(</span>
</span><span data-line="1036">        <span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
</span><span data-line="1037">        <span class="nb">str</span><span class="p">,</span>
</span><span data-line="1038">    <span class="p">),</span>  <span class="c1"># Takes (Path, Label)</span>
</span><span data-line="1039">    <span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1040">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1041">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path(s) to additional .con file(s) and the &quot;</span>
</span><span data-line="1042">    <span class="s2">&quot;label to highlight, use an empty string to default to the file name.&quot;</span><span class="p">,</span>
</span><span data-line="1043"><span class="p">)</span>
</span><span data-line="1044"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1045">    <span class="s2">&quot;--plot-type&quot;</span><span class="p">,</span>
</span><span data-line="1046">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">PlotType</span><span class="p">]),</span>
</span><span data-line="1047">    <span class="n">default</span><span class="o">=</span><span class="n">PlotType</span><span class="o">.</span><span class="n">PROFILE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="1048">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Type of plot to generate: &#39;profile&#39; (1D path) or &#39;landscape&#39; (2D RMSD plot).&quot;</span><span class="p">,</span>
</span><span data-line="1049"><span class="p">)</span>
</span><span data-line="1050"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1051">    <span class="s2">&quot;--rbf-smoothing&quot;</span><span class="p">,</span>
</span><span data-line="1052">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="1053">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1054">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1055">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Smoothing term for 2D RBF, defaults to 10</span><span class="si">% o</span><span class="s2">f the minimum RMSD range.&quot;</span><span class="p">,</span>
</span><span data-line="1056"><span class="p">)</span>
</span><span data-line="1057"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1058">    <span class="s2">&quot;--rounding&quot;</span><span class="p">,</span>
</span><span data-line="1059">    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span data-line="1060">    <span class="n">default</span><span class="o">=</span><span class="n">ROUNDING_DF</span><span class="p">,</span>
</span><span data-line="1061">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1062">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Data rounding term for 2D plots.&quot;</span><span class="p">,</span>
</span><span data-line="1063"><span class="p">)</span>
</span><span data-line="1064"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1065">    <span class="s2">&quot;--landscape-mode&quot;</span><span class="p">,</span>
</span><span data-line="1066">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;surface&quot;</span><span class="p">]),</span>
</span><span data-line="1067">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;surface&quot;</span><span class="p">,</span>
</span><span data-line="1068">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;For landscape plot: &#39;path&#39; (only 1D path) or &#39;surface&#39; (interpolated 2D surface).&quot;</span><span class="p">,</span>
</span><span data-line="1069"><span class="p">)</span>
</span><span data-line="1070"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1071">    <span class="s2">&quot;--landscape-path&quot;</span><span class="p">,</span>
</span><span data-line="1072">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]),</span>
</span><span data-line="1073">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span data-line="1074">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Last uses an interpolation only on the last path, otherwise use all points.&quot;</span><span class="p">,</span>
</span><span data-line="1075"><span class="p">)</span>
</span><span data-line="1076"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1077">    <span class="s2">&quot;--rc-mode&quot;</span><span class="p">,</span>
</span><span data-line="1078">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">RCMode</span><span class="p">]),</span>
</span><span data-line="1079">    <span class="n">default</span><span class="o">=</span><span class="n">RCMode</span><span class="o">.</span><span class="n">PATH</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="1080">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Reaction coordinate for profile plot: &#39;path&#39; (file&#39;s RC) or &#39;rmsd&#39; (RMSD from reactant).&quot;</span><span class="p">,</span>
</span><span data-line="1081"><span class="p">)</span>
</span><span data-line="1082"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1083">    <span class="s2">&quot;--plot-structures&quot;</span><span class="p">,</span>
</span><span data-line="1084">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;crit_points&quot;</span><span class="p">]),</span>
</span><span data-line="1085">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span data-line="1086">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Structures to render on the path. Requires --con-file.&quot;</span><span class="p">,</span>
</span><span data-line="1087"><span class="p">)</span>
</span><span data-line="1088"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1089">    <span class="s2">&quot;--surface-type&quot;</span><span class="p">,</span>
</span><span data-line="1090">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;grid&quot;</span><span class="p">,</span> <span class="s2">&quot;rbf&quot;</span><span class="p">]),</span>
</span><span data-line="1091">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;rbf&quot;</span><span class="p">,</span>
</span><span data-line="1092">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Interpolation method for the 2D surface.&quot;</span><span class="p">,</span>
</span><span data-line="1093"><span class="p">)</span>
</span><span data-line="1094"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1095">    <span class="s2">&quot;--show-pts/--no-show-pts&quot;</span><span class="p">,</span>
</span><span data-line="1096">    <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1097">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show all paths from the optimization on the RMSD 2D plot.&quot;</span><span class="p">,</span>
</span><span data-line="1098"><span class="p">)</span>
</span><span data-line="1099"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1100">    <span class="s2">&quot;--plot-mode&quot;</span><span class="p">,</span>
</span><span data-line="1101">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">PlotMode</span><span class="p">]),</span>
</span><span data-line="1102">    <span class="n">default</span><span class="o">=</span><span class="n">PlotMode</span><span class="o">.</span><span class="n">ENERGY</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="1103">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Quantity to plot on y-axis (profile) or color (landscape): &#39;energy&#39; or &#39;eigenvalue&#39;.&quot;</span><span class="p">,</span>
</span><span data-line="1104"><span class="p">)</span>
</span><span data-line="1105"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1106">    <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span data-line="1107">    <span class="s2">&quot;--output-file&quot;</span><span class="p">,</span>
</span><span data-line="1108">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
</span><span data-line="1109">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1110">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output image filename. If not provided, plot is shown interactively.&quot;</span><span class="p">,</span>
</span><span data-line="1111"><span class="p">)</span>
</span><span data-line="1112"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1113">    <span class="s2">&quot;--start&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Start file index for profile plot.&quot;</span>
</span><span data-line="1114"><span class="p">)</span>
</span><span data-line="1115"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--end&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;End file index for profile plot.&quot;</span><span class="p">)</span>
</span><span data-line="1116"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1117">    <span class="s2">&quot;--normalize-rc&quot;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Normalize reaction coordinate.&quot;</span>
</span><span data-line="1118"><span class="p">)</span>
</span><span data-line="1119"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--title&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;NEB Path&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot title.&quot;</span><span class="p">)</span>
</span><span data-line="1120"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--xlabel&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;X-axis label (overrides default).&quot;</span><span class="p">)</span>
</span><span data-line="1121"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--ylabel&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Y-axis label (overrides default).&quot;</span><span class="p">)</span>
</span><span data-line="1122"><span class="c1"># --- Theme and Override Options ---</span>
</span><span data-line="1123"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1124">    <span class="s2">&quot;--theme&quot;</span><span class="p">,</span>
</span><span data-line="1125">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span><span class="n">THEMES</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">case_sensitive</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
</span><span data-line="1126">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;ruhi&quot;</span><span class="p">,</span>
</span><span data-line="1127">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The plotting theme to use.&quot;</span><span class="p">,</span>
</span><span data-line="1128"><span class="p">)</span>
</span><span data-line="1129"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1130">    <span class="s2">&quot;--cmap-profile&quot;</span><span class="p">,</span>
</span><span data-line="1131">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1132">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Colormap for profile plot (overrides theme default).&quot;</span><span class="p">,</span>
</span><span data-line="1133"><span class="p">)</span>
</span><span data-line="1134"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1135">    <span class="s2">&quot;--cmap-landscape&quot;</span><span class="p">,</span>
</span><span data-line="1136">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1137">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Colormap for landscape plot (overrides theme default).&quot;</span><span class="p">,</span>
</span><span data-line="1138"><span class="p">)</span>
</span><span data-line="1139"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1140">    <span class="s2">&quot;--facecolor&quot;</span><span class="p">,</span>
</span><span data-line="1141">    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span data-line="1142">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1143">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Background color (overrides theme default).&quot;</span><span class="p">,</span>
</span><span data-line="1144"><span class="p">)</span>
</span><span data-line="1145"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1146">    <span class="s2">&quot;--fontsize-base&quot;</span><span class="p">,</span>
</span><span data-line="1147">    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span data-line="1148">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1149">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Base font size (overrides theme default).&quot;</span><span class="p">,</span>
</span><span data-line="1150"><span class="p">)</span>
</span><span data-line="1151"><span class="c1"># --- Figure and Inset Options ---</span>
</span><span data-line="1152"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1153">    <span class="s2">&quot;--figsize&quot;</span><span class="p">,</span>
</span><span data-line="1154">    <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span data-line="1155">    <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span><span data-line="1156">    <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span>
</span><span data-line="1157">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1158">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Figure width, height in inches.&quot;</span><span class="p">,</span>
</span><span data-line="1159"><span class="p">)</span>
</span><span data-line="1160"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1161">    <span class="s2">&quot;--fig-height&quot;</span><span class="p">,</span>
</span><span data-line="1162">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="1163">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1164">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Figure height in inches. Must be used *with* --aspect-ratio.&quot;</span><span class="p">,</span>
</span><span data-line="1165"><span class="p">)</span>
</span><span data-line="1166"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1167">    <span class="s2">&quot;--aspect-ratio&quot;</span><span class="p">,</span>
</span><span data-line="1168">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="1169">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="1170">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Figure aspect ratio (width/height). Must be used *with* --fig-height.&quot;</span><span class="p">,</span>
</span><span data-line="1171"><span class="p">)</span>
</span><span data-line="1172"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1173">    <span class="s2">&quot;--dpi&quot;</span><span class="p">,</span>
</span><span data-line="1174">    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span data-line="1175">    <span class="n">default</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span><span data-line="1176">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1177">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Resolution in Dots Per Inch.&quot;</span><span class="p">,</span>
</span><span data-line="1178"><span class="p">)</span>
</span><span data-line="1179"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1180">    <span class="s2">&quot;--zoom-ratio&quot;</span><span class="p">,</span>
</span><span data-line="1181">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="1182">    <span class="n">default</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
</span><span data-line="1183">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1184">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Scale the inset image.&quot;</span><span class="p">,</span>
</span><span data-line="1185"><span class="p">)</span>
</span><span data-line="1186"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1187">    <span class="s2">&quot;--ase-rotation&quot;</span><span class="p">,</span>
</span><span data-line="1188">    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span data-line="1189">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;0x, 90y, 0z&quot;</span><span class="p">,</span>
</span><span data-line="1190">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1191">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;ASE rotation string for structure insets (e.g., &#39;45x,30y,0z&#39;).&quot;</span><span class="p">,</span>
</span><span data-line="1192"><span class="p">)</span>
</span><span data-line="1193"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1194">    <span class="s2">&quot;--arrow-head-length&quot;</span><span class="p">,</span>
</span><span data-line="1195">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="1196">    <span class="n">default</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span data-line="1197">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1198">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Arrow head length for insets (points).&quot;</span><span class="p">,</span>
</span><span data-line="1199"><span class="p">)</span>
</span><span data-line="1200"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1201">    <span class="s2">&quot;--arrow-head-width&quot;</span><span class="p">,</span>
</span><span data-line="1202">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="1203">    <span class="n">default</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span data-line="1204">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1205">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Arrow head width for insets (points).&quot;</span><span class="p">,</span>
</span><span data-line="1206"><span class="p">)</span>
</span><span data-line="1207"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1208">    <span class="s2">&quot;--arrow-tail-width&quot;</span><span class="p">,</span>
</span><span data-line="1209">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="1210">    <span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span data-line="1211">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1212">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Arrow tail width for insets (points).&quot;</span><span class="p">,</span>
</span><span data-line="1213"><span class="p">)</span>
</span><span data-line="1214"><span class="c1"># --- Path/Spline Options ---</span>
</span><span data-line="1215"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1216">    <span class="s2">&quot;--highlight-last/--no-highlight-last&quot;</span><span class="p">,</span>
</span><span data-line="1217">    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1218">    <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1219">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Highlight last path (uses theme&#39;s &#39;highlight_color&#39;).&quot;</span><span class="p">,</span>
</span><span data-line="1220"><span class="p">)</span>
</span><span data-line="1221"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1222">    <span class="s2">&quot;--spline-method&quot;</span><span class="p">,</span>
</span><span data-line="1223">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="n">e</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">SplineMethod</span><span class="p">]),</span>
</span><span data-line="1224">    <span class="n">default</span><span class="o">=</span><span class="n">SplineMethod</span><span class="o">.</span><span class="n">HERMITE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
</span><span data-line="1225">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Spline interpolation method for energy profiles.&quot;</span><span class="p">,</span>
</span><span data-line="1226"><span class="p">)</span>
</span><span data-line="1227"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1228">    <span class="s2">&quot;--savgol-window&quot;</span><span class="p">,</span>
</span><span data-line="1229">    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span data-line="1230">    <span class="n">default</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
</span><span data-line="1231">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Savitzky-Golay filter window length (for Hermite spline).&quot;</span><span class="p">,</span>
</span><span data-line="1232"><span class="p">)</span>
</span><span data-line="1233"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1234">    <span class="s2">&quot;--savgol-order&quot;</span><span class="p">,</span>
</span><span data-line="1235">    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span data-line="1236">    <span class="n">default</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span data-line="1237">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Savitzky-Golay filter polynomial order (for Hermite spline).&quot;</span><span class="p">,</span>
</span><span data-line="1238"><span class="p">)</span>
</span><span data-line="1239"><span class="c1"># --- Inset Position Options ---</span>
</span><span data-line="1240"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1241">    <span class="s2">&quot;--draw-reactant&quot;</span><span class="p">,</span>
</span><span data-line="1242">    <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span><span data-line="1243">    <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="1244">    <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
</span><span data-line="1245">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1246">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Positioning for the reactant inset (x, y, rad).&quot;</span><span class="p">,</span>
</span><span data-line="1247"><span class="p">)</span>
</span><span data-line="1248"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1249">    <span class="s2">&quot;--draw-saddle&quot;</span><span class="p">,</span>
</span><span data-line="1250">    <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span><span data-line="1251">    <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="1252">    <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
</span><span data-line="1253">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1254">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Positioning for the saddle inset (x, y, rad).&quot;</span><span class="p">,</span>
</span><span data-line="1255"><span class="p">)</span>
</span><span data-line="1256"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1257">    <span class="s2">&quot;--draw-product&quot;</span><span class="p">,</span>
</span><span data-line="1258">    <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span><span data-line="1259">    <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="1260">    <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
</span><span data-line="1261">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1262">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Positioning for the product inset (x, y, rad).&quot;</span><span class="p">,</span>
</span><span data-line="1263"><span class="p">)</span>
</span><span data-line="1264"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1265">    <span class="s2">&quot;--cache-file&quot;</span><span class="p">,</span>
</span><span data-line="1266">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
</span><span data-line="1267">    <span class="n">default</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.neb_landscape.parquet&quot;</span><span class="p">),</span>
</span><span data-line="1268">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Parquet file to cache RMSD calculations (speeds up re-runs).&quot;</span><span class="p">,</span>
</span><span data-line="1269"><span class="p">)</span>
</span><span data-line="1270"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1271">    <span class="s2">&quot;--force-recompute&quot;</span><span class="p">,</span>
</span><span data-line="1272">    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1273">    <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="1274">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Ignore cache and force re-calculation of RMSD.&quot;</span><span class="p">,</span>
</span><span data-line="1275"><span class="p">)</span>
</span><span data-line="1276"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="1277">    <span class="s2">&quot;--show-legend&quot;</span><span class="p">,</span>
</span><span data-line="1278">    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="1279">    <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="1280">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show the legends for additional con.&quot;</span><span class="p">,</span>
</span><span data-line="1281"><span class="p">)</span>
</span><span data-line="1282"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.main">[docs]</a>
</span><span data-line="1283">    <span class="s2">&quot;--ira-kmax&quot;</span><span class="p">,</span>
</span><span data-line="1284">    <span class="n">default</span><span class="o">=</span><span class="n">IRA_KMAX_DEFAULT</span><span class="p">,</span>
</span><span data-line="1285">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;kmax factor for IRA.&quot;</span><span class="p">,</span>
</span><span data-line="1286"><span class="p">)</span>
</span><span data-line="1287"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span>
</span><span data-line="1288">    <span class="c1"># --- Input Files ---</span>
</span><span data-line="1289">    <span class="n">input_dat_pattern</span><span class="p">,</span>
</span><span data-line="1290">    <span class="n">input_path_pattern</span><span class="p">,</span>
</span><span data-line="1291">    <span class="n">con_file</span><span class="p">,</span>
</span><span data-line="1292">    <span class="n">additional_con</span><span class="p">,</span>
</span><span data-line="1293">    <span class="c1"># --- Plot Behavior ---</span>
</span><span data-line="1294">    <span class="n">plot_type</span><span class="p">,</span>
</span><span data-line="1295">    <span class="n">landscape_mode</span><span class="p">,</span>
</span><span data-line="1296">    <span class="n">landscape_path</span><span class="p">,</span>
</span><span data-line="1297">    <span class="n">rc_mode</span><span class="p">,</span>
</span><span data-line="1298">    <span class="n">plot_structures</span><span class="p">,</span>
</span><span data-line="1299">    <span class="n">rbf_smoothing</span><span class="p">,</span>
</span><span data-line="1300">    <span class="n">rounding</span><span class="p">,</span>
</span><span data-line="1301">    <span class="n">show_pts</span><span class="p">,</span>
</span><span data-line="1302">    <span class="n">plot_mode</span><span class="p">,</span>
</span><span data-line="1303">    <span class="n">surface_type</span><span class="p">,</span>
</span><span data-line="1304">    <span class="c1"># --- Output &amp; Slicing ---</span>
</span><span data-line="1305">    <span class="n">output_file</span><span class="p">,</span>
</span><span data-line="1306">    <span class="n">start</span><span class="p">,</span>
</span><span data-line="1307">    <span class="n">end</span><span class="p">,</span>
</span><span data-line="1308">    <span class="c1"># --- Plot Aesthetics ---</span>
</span><span data-line="1309">    <span class="n">normalize_rc</span><span class="p">,</span>
</span><span data-line="1310">    <span class="n">title</span><span class="p">,</span>
</span><span data-line="1311">    <span class="n">xlabel</span><span class="p">,</span>
</span><span data-line="1312">    <span class="n">ylabel</span><span class="p">,</span>
</span><span data-line="1313">    <span class="n">highlight_last</span><span class="p">,</span>
</span><span data-line="1314">    <span class="c1"># --- Theme ---</span>
</span><span data-line="1315">    <span class="n">theme</span><span class="p">,</span>
</span><span data-line="1316">    <span class="n">cmap_profile</span><span class="p">,</span>
</span><span data-line="1317">    <span class="n">cmap_landscape</span><span class="p">,</span>
</span><span data-line="1318">    <span class="n">facecolor</span><span class="p">,</span>
</span><span data-line="1319">    <span class="n">fontsize_base</span><span class="p">,</span>
</span><span data-line="1320">    <span class="c1"># --- Figure &amp; Inset ---</span>
</span><span data-line="1321">    <span class="n">figsize</span><span class="p">,</span>
</span><span data-line="1322">    <span class="n">fig_height</span><span class="p">,</span>
</span><span data-line="1323">    <span class="n">aspect_ratio</span><span class="p">,</span>
</span><span data-line="1324">    <span class="n">dpi</span><span class="p">,</span>
</span><span data-line="1325">    <span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="1326">    <span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="1327">    <span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="1328">    <span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="1329">    <span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="1330">    <span class="c1"># --- Spline ---</span>
</span><span data-line="1331">    <span class="n">spline_method</span><span class="p">,</span>
</span><span data-line="1332">    <span class="n">savgol_window</span><span class="p">,</span>
</span><span data-line="1333">    <span class="n">savgol_order</span><span class="p">,</span>
</span><span data-line="1334">    <span class="c1"># --- Inset Positions ---</span>
</span><span data-line="1335">    <span class="n">draw_reactant</span><span class="p">,</span>
</span><span data-line="1336">    <span class="n">draw_saddle</span><span class="p">,</span>
</span><span data-line="1337">    <span class="n">draw_product</span><span class="p">,</span>
</span><span data-line="1338">    <span class="n">show_legend</span><span class="p">,</span>
</span><span data-line="1339">    <span class="c1"># Caching</span>
</span><span data-line="1340">    <span class="n">cache_file</span><span class="p">,</span>
</span><span data-line="1341">    <span class="n">force_recompute</span><span class="p">,</span>
</span><span data-line="1342">    <span class="n">ira_kmax</span><span class="p">,</span>
</span><span data-line="1343"><span class="p">):</span>
</span><span data-line="1344"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point for NEB plot script.&quot;&quot;&quot;</span>
</span><span data-line="1345">
</span><span data-line="1346">    <span class="c1"># --- Setup Theme ---</span>
</span><span data-line="1347">    <span class="n">selected_theme</span> <span class="o">=</span> <span class="n">_setup_theme</span><span class="p">(</span>
</span><span data-line="1348">        <span class="n">theme</span><span class="p">,</span> <span class="n">cmap_profile</span><span class="p">,</span> <span class="n">cmap_landscape</span><span class="p">,</span> <span class="n">fontsize_base</span><span class="p">,</span> <span class="n">facecolor</span>
</span><span data-line="1349">    <span class="p">)</span>
</span><span data-line="1350">    <span class="n">setup_global_theme</span><span class="p">(</span><span class="n">selected_theme</span><span class="p">)</span>
</span><span data-line="1351">
</span><span data-line="1352">    <span class="c1"># --- Dependency Checks ---</span>
</span><span data-line="1353">    <span class="n">_run_dependency_checks</span><span class="p">(</span>
</span><span data-line="1354">        <span class="n">plot_type</span><span class="p">,</span>
</span><span data-line="1355">        <span class="n">rc_mode</span><span class="p">,</span>
</span><span data-line="1356">        <span class="n">additional_con</span><span class="p">,</span>
</span><span data-line="1357">        <span class="n">plot_structures</span><span class="p">,</span>
</span><span data-line="1358">        <span class="n">con_file</span><span class="p">,</span>
</span><span data-line="1359">    <span class="p">)</span>
</span><span data-line="1360">
</span><span data-line="1361">    <span class="c1"># --- Setup Figure ---</span>
</span><span data-line="1362">    <span class="n">final_figsize</span> <span class="o">=</span> <span class="n">_determine_figsize</span><span class="p">(</span><span class="n">figsize</span><span class="p">,</span> <span class="n">fig_height</span><span class="p">,</span> <span class="n">aspect_ratio</span><span class="p">)</span>
</span><span data-line="1363">
</span><span data-line="1364">    <span class="c1"># Initialize Figure</span>
</span><span data-line="1365">    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">final_figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
</span><span data-line="1366">
</span><span data-line="1367">    <span class="c1"># Determine Layout</span>
</span><span data-line="1368">    <span class="n">has_strip</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1369">        <span class="n">plot_structures</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;crit_points&quot;</span><span class="p">]</span>
</span><span data-line="1370">        <span class="ow">and</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="n">PlotType</span><span class="o">.</span><span class="n">LANDSCAPE</span><span class="o">.</span><span class="n">value</span>
</span><span data-line="1371">    <span class="p">)</span>
</span><span data-line="1372">    <span class="k">if</span> <span class="n">has_strip</span><span class="p">:</span>
</span><span data-line="1373">        <span class="c1"># Calculate expected rows to adjust hspace</span>
</span><span data-line="1374">        <span class="c1"># We need to know how many structures are being plotted</span>
</span><span data-line="1375">        <span class="c1"># (Heuristic: start with critical points = 3 + additional structures)</span>
</span><span data-line="1376">        <span class="n">n_expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">==</span> <span class="s2">&quot;crit_points&quot;</span> <span class="k">else</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span>
</span><span data-line="1377">            <span class="n">additional_con</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="1378">        <span class="p">)</span>
</span><span data-line="1379">        <span class="n">max_cols</span> <span class="o">=</span> <span class="mi">6</span>
</span><span data-line="1380">        <span class="n">n_rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_expected</span> <span class="o">+</span> <span class="n">max_cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">max_cols</span>
</span><span data-line="1381">
</span><span data-line="1382">        <span class="c1"># Adjust hspace: 0.8 for multiple rows, 0.3 (or low value) for single</span>
</span><span data-line="1383">        <span class="n">calc_hspace</span> <span class="o">=</span> <span class="mf">0.8</span> <span class="k">if</span> <span class="n">n_rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.3</span>
</span><span data-line="1384">
</span><span data-line="1385">        <span class="c1"># Create 2 rows: Main Plot (Top), Strip (Bottom)</span>
</span><span data-line="1386">        <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span> <span class="n">hspace</span><span class="o">=</span><span class="n">calc_hspace</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
</span><span data-line="1387">        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span data-line="1388">        <span class="c1"># IMPORTANT: Do NOT share x-axis. The strip uses integer spacing (0,1,2).</span>
</span><span data-line="1389">        <span class="n">ax_strip</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span data-line="1390">        <span class="n">apply_plot_theme</span><span class="p">(</span><span class="n">ax_strip</span><span class="p">,</span> <span class="n">selected_theme</span><span class="p">)</span>
</span><span data-line="1391">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="1392">        <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
</span><span data-line="1393">        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span data-line="1394">        <span class="n">ax_strip</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1395">
</span><span data-line="1396">    <span class="n">apply_plot_theme</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">selected_theme</span><span class="p">)</span>
</span><span data-line="1397">
</span><span data-line="1398">    <span class="c1"># --- Load Structures ---</span>
</span><span data-line="1399">    <span class="n">atoms_list</span><span class="p">,</span> <span class="n">additional_atoms_data</span> <span class="o">=</span> <span class="n">_load_structures</span><span class="p">(</span>
</span><span data-line="1400">        <span class="n">con_file</span><span class="p">,</span> <span class="n">additional_con</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">rc_mode</span><span class="p">,</span> <span class="n">ira_kmax</span>
</span><span data-line="1401">    <span class="p">)</span>
</span><span data-line="1402">
</span><span data-line="1403">    <span class="c1"># --- Delegate to Plotting Function ---</span>
</span><span data-line="1404">    <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="n">PlotType</span><span class="o">.</span><span class="n">LANDSCAPE</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span data-line="1405">        <span class="n">final_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;RMSD from Reactant ($\AA$)&quot;</span>
</span><span data-line="1406">        <span class="n">final_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;RMSD from Product ($\AA$)&quot;</span>
</span><span data-line="1407">        <span class="n">final_title</span> <span class="o">=</span> <span class="s2">&quot;RMSD(R,P) projection&quot;</span> <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;NEB Path&quot;</span> <span class="k">else</span> <span class="n">title</span>
</span><span data-line="1408">
</span><span data-line="1409">        <span class="n">_plot_landscape</span><span class="p">(</span>
</span><span data-line="1410">            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
</span><span data-line="1411">            <span class="n">ax_strip</span><span class="o">=</span><span class="n">ax_strip</span><span class="p">,</span>
</span><span data-line="1412">            <span class="n">atoms_list</span><span class="o">=</span><span class="n">atoms_list</span><span class="p">,</span>
</span><span data-line="1413">            <span class="n">input_dat_pattern</span><span class="o">=</span><span class="n">input_dat_pattern</span><span class="p">,</span>
</span><span data-line="1414">            <span class="n">input_path_pattern</span><span class="o">=</span><span class="n">input_path_pattern</span><span class="p">,</span>
</span><span data-line="1415">            <span class="n">con_file</span><span class="o">=</span><span class="n">con_file</span><span class="p">,</span>
</span><span data-line="1416">            <span class="n">additional_atoms_data</span><span class="o">=</span><span class="n">additional_atoms_data</span><span class="p">,</span>
</span><span data-line="1417">            <span class="n">landscape_path</span><span class="o">=</span><span class="n">landscape_path</span><span class="p">,</span>
</span><span data-line="1418">            <span class="n">landscape_mode</span><span class="o">=</span><span class="n">landscape_mode</span><span class="p">,</span>
</span><span data-line="1419">            <span class="n">plot_mode</span><span class="o">=</span><span class="n">plot_mode</span><span class="p">,</span>
</span><span data-line="1420">            <span class="n">surface_type</span><span class="o">=</span><span class="n">surface_type</span><span class="p">,</span>
</span><span data-line="1421">            <span class="n">plot_structures</span><span class="o">=</span><span class="n">plot_structures</span><span class="p">,</span>
</span><span data-line="1422">            <span class="n">rbf_smoothing</span><span class="o">=</span><span class="n">rbf_smoothing</span><span class="p">,</span>
</span><span data-line="1423">            <span class="n">rounding</span><span class="o">=</span><span class="n">rounding</span><span class="p">,</span>
</span><span data-line="1424">            <span class="n">show_pts</span><span class="o">=</span><span class="n">show_pts</span><span class="p">,</span>
</span><span data-line="1425">            <span class="n">selected_theme</span><span class="o">=</span><span class="n">selected_theme</span><span class="p">,</span>
</span><span data-line="1426">            <span class="n">draw_reactant</span><span class="o">=</span><span class="n">draw_reactant</span><span class="p">,</span>
</span><span data-line="1427">            <span class="n">draw_saddle</span><span class="o">=</span><span class="n">draw_saddle</span><span class="p">,</span>
</span><span data-line="1428">            <span class="n">draw_product</span><span class="o">=</span><span class="n">draw_product</span><span class="p">,</span>
</span><span data-line="1429">            <span class="n">zoom_ratio</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="1430">            <span class="n">ase_rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="1431">            <span class="n">arrow_head_length</span><span class="o">=</span><span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="1432">            <span class="n">arrow_head_width</span><span class="o">=</span><span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="1433">            <span class="n">arrow_tail_width</span><span class="o">=</span><span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="1434">            <span class="n">cache_file</span><span class="o">=</span><span class="n">cache_file</span><span class="p">,</span>
</span><span data-line="1435">            <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
</span><span data-line="1436">            <span class="n">ira_kmax</span><span class="o">=</span><span class="n">ira_kmax</span><span class="p">,</span>
</span><span data-line="1437">            <span class="n">show_legend</span><span class="o">=</span><span class="n">show_legend</span><span class="p">,</span>
</span><span data-line="1438">        <span class="p">)</span>
</span><span data-line="1439">        <span class="n">setup_plot_aesthetics</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">final_title</span><span class="p">,</span> <span class="n">final_xlabel</span><span class="p">,</span> <span class="n">final_ylabel</span><span class="p">)</span>
</span><span data-line="1440">
</span><span data-line="1441">    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Profile Plot</span>
</span><span data-line="1442">        <span class="n">final_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span data-line="1443">        <span class="n">final_xlabel</span><span class="p">,</span> <span class="n">final_ylabel</span> <span class="o">=</span> <span class="n">_get_profile_labels</span><span class="p">(</span>
</span><span data-line="1444">            <span class="n">rc_mode</span><span class="p">,</span> <span class="n">plot_mode</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">atoms_list</span>
</span><span data-line="1445">        <span class="p">)</span>
</span><span data-line="1446">
</span><span data-line="1447">        <span class="n">_plot_profile</span><span class="p">(</span>
</span><span data-line="1448">            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
</span><span data-line="1449">            <span class="n">ax_strip</span><span class="o">=</span><span class="n">ax_strip</span><span class="p">,</span>
</span><span data-line="1450">            <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span>
</span><span data-line="1451">            <span class="n">input_dat_pattern</span><span class="o">=</span><span class="n">input_dat_pattern</span><span class="p">,</span>
</span><span data-line="1452">            <span class="n">atoms_list</span><span class="o">=</span><span class="n">atoms_list</span><span class="p">,</span>
</span><span data-line="1453">            <span class="n">additional_atoms_data</span><span class="o">=</span><span class="n">additional_atoms_data</span><span class="p">,</span>
</span><span data-line="1454">            <span class="n">rc_mode</span><span class="o">=</span><span class="n">rc_mode</span><span class="p">,</span>
</span><span data-line="1455">            <span class="n">plot_mode</span><span class="o">=</span><span class="n">plot_mode</span><span class="p">,</span>
</span><span data-line="1456">            <span class="n">plot_structures</span><span class="o">=</span><span class="n">plot_structures</span><span class="p">,</span>
</span><span data-line="1457">            <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span>
</span><span data-line="1458">            <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span>
</span><span data-line="1459">            <span class="n">normalize_rc</span><span class="o">=</span><span class="n">normalize_rc</span><span class="p">,</span>
</span><span data-line="1460">            <span class="n">highlight_last</span><span class="o">=</span><span class="n">highlight_last</span><span class="p">,</span>
</span><span data-line="1461">            <span class="n">selected_theme</span><span class="o">=</span><span class="n">selected_theme</span><span class="p">,</span>
</span><span data-line="1462">            <span class="n">spline_method</span><span class="o">=</span><span class="n">spline_method</span><span class="p">,</span>
</span><span data-line="1463">            <span class="n">savgol_window</span><span class="o">=</span><span class="n">savgol_window</span><span class="p">,</span>
</span><span data-line="1464">            <span class="n">savgol_order</span><span class="o">=</span><span class="n">savgol_order</span><span class="p">,</span>
</span><span data-line="1465">            <span class="n">draw_reactant</span><span class="o">=</span><span class="n">draw_reactant</span><span class="p">,</span>
</span><span data-line="1466">            <span class="n">draw_saddle</span><span class="o">=</span><span class="n">draw_saddle</span><span class="p">,</span>
</span><span data-line="1467">            <span class="n">draw_product</span><span class="o">=</span><span class="n">draw_product</span><span class="p">,</span>
</span><span data-line="1468">            <span class="n">zoom_ratio</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="1469">            <span class="n">ase_rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="1470">            <span class="n">arrow_head_length</span><span class="o">=</span><span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="1471">            <span class="n">arrow_head_width</span><span class="o">=</span><span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="1472">            <span class="n">arrow_tail_width</span><span class="o">=</span><span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="1473">            <span class="n">cache_file</span><span class="o">=</span><span class="n">cache_file</span><span class="p">,</span>
</span><span data-line="1474">            <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
</span><span data-line="1475">            <span class="n">ira_kmax</span><span class="o">=</span><span class="n">ira_kmax</span><span class="p">,</span>
</span><span data-line="1476">        <span class="p">)</span>
</span><span data-line="1477">        <span class="n">setup_plot_aesthetics</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">final_title</span><span class="p">,</span> <span class="n">final_xlabel</span><span class="p">,</span> <span class="n">final_ylabel</span><span class="p">)</span>
</span><span data-line="1478">        <span class="k">if</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="n">RCMode</span><span class="o">.</span><span class="n">PATH</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">normalize_rc</span><span class="p">:</span>
</span><span data-line="1479">            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span data-line="1480">
</span><span data-line="1481">    <span class="c1"># --- Finalize ---</span>
</span><span data-line="1482">    <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
</span><span data-line="1483">        <span class="k">if</span> <span class="ow">not</span> <span class="n">output_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span data-line="1484">            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating output directory: [cyan]</span><span class="si">{</span><span class="n">output_file</span><span class="o">.</span><span class="n">parent</span><span class="si">}</span><span class="s2">[/cyan]&quot;</span><span class="p">)</span>
</span><span data-line="1485">            <span class="n">output_file</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="1486">
</span><span data-line="1487">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving plot to [green]</span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">[/green]&quot;</span><span class="p">)</span>
</span><span data-line="1488">        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
</span><span data-line="1489">            <span class="n">output_file</span><span class="p">,</span>
</span><span data-line="1490">            <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="1491">            <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span>
</span><span data-line="1492">            <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
</span><span data-line="1493">        <span class="p">)</span>
</span><span data-line="1494">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="1495">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Displaying plot interactively.&quot;</span><span class="p">)</span>
</span><span data-line="1496">        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

</span><span data-line="1497">
</span><span data-line="1498">
</span><span data-line="1499"><span class="c1"># --- Helper Functions ---</span>
</span><span data-line="1500">
</span><span data-line="1501">
<div class="viewcode-block" id="_setup_theme">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb._setup_theme">[docs]</a>
</span><span data-line="1502"><span class="k">def</span><span class="w"> </span><span class="nf">_setup_theme</span><span class="p">(</span><span class="n">theme</span><span class="p">,</span> <span class="n">cmap_profile</span><span class="p">,</span> <span class="n">cmap_landscape</span><span class="p">,</span> <span class="n">fontsize_base</span><span class="p">,</span> <span class="n">facecolor</span><span class="p">):</span>
</span><span data-line="1503"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads the selected theme and applies any user overrides.&quot;&quot;&quot;</span>
</span><span data-line="1504">    <span class="n">selected_theme</span> <span class="o">=</span> <span class="n">THEMES</span><span class="p">[</span><span class="n">theme</span><span class="p">]</span>
</span><span data-line="1505">    <span class="k">if</span> <span class="n">cmap_profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1506">        <span class="n">selected_theme</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">selected_theme</span><span class="p">,</span> <span class="n">cmap_profile</span><span class="o">=</span><span class="n">cmap_profile</span><span class="p">)</span>
</span><span data-line="1507">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1508">            <span class="sa">f</span><span class="s2">&quot;Overriding theme profile colormap with [bold magenta]</span><span class="si">{</span><span class="n">cmap_profile</span><span class="si">}</span><span class="s2">[/bold magenta]&quot;</span>
</span><span data-line="1509">        <span class="p">)</span>
</span><span data-line="1510">    <span class="k">if</span> <span class="n">cmap_landscape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1511">        <span class="n">selected_theme</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">selected_theme</span><span class="p">,</span> <span class="n">cmap_landscape</span><span class="o">=</span><span class="n">cmap_landscape</span><span class="p">)</span>
</span><span data-line="1512">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1513">            <span class="sa">f</span><span class="s2">&quot;Overriding theme landscape colormap with [bold magenta]</span><span class="si">{</span><span class="n">cmap_landscape</span><span class="si">}</span><span class="s2">[/bold magenta]&quot;</span>
</span><span data-line="1514">        <span class="p">)</span>
</span><span data-line="1515">    <span class="k">if</span> <span class="n">fontsize_base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1516">        <span class="n">selected_theme</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">selected_theme</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="n">fontsize_base</span><span class="p">)</span>
</span><span data-line="1517">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1518">            <span class="sa">f</span><span class="s2">&quot;Overriding theme font size with [bold magenta]</span><span class="si">{</span><span class="n">fontsize_base</span><span class="si">}</span><span class="s2">[/bold magenta]&quot;</span>
</span><span data-line="1519">        <span class="p">)</span>
</span><span data-line="1520">    <span class="k">if</span> <span class="n">facecolor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1521">        <span class="n">selected_theme</span> <span class="o">=</span> <span class="n">replace</span><span class="p">(</span><span class="n">selected_theme</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">)</span>
</span><span data-line="1522">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1523">            <span class="sa">f</span><span class="s2">&quot;Overriding theme facecolor with [bold magenta]</span><span class="si">{</span><span class="n">facecolor</span><span class="si">}</span><span class="s2">[/bold magenta]&quot;</span>
</span><span data-line="1524">        <span class="p">)</span>
</span><span data-line="1525">    <span class="k">return</span> <span class="n">selected_theme</span></div>

</span><span data-line="1526">
</span><span data-line="1527">
<div class="viewcode-block" id="_run_dependency_checks">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb._run_dependency_checks">[docs]</a>
</span><span data-line="1528"><span class="k">def</span><span class="w"> </span><span class="nf">_run_dependency_checks</span><span class="p">(</span>
</span><span data-line="1529">    <span class="n">plot_type</span><span class="p">,</span>
</span><span data-line="1530">    <span class="n">rc_mode</span><span class="p">,</span>
</span><span data-line="1531">    <span class="n">additional_con</span><span class="p">,</span>
</span><span data-line="1532">    <span class="n">plot_structures</span><span class="p">,</span>
</span><span data-line="1533">    <span class="n">con_file</span><span class="p">,</span>
</span><span data-line="1534"><span class="p">):</span>
</span><span data-line="1535"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates dependencies and option combinations.&quot;&quot;&quot;</span>
</span><span data-line="1536">    <span class="k">if</span> <span class="n">ira_mod</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
</span><span data-line="1537">        <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;landscape&quot;</span> <span class="ow">or</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="s2">&quot;rmsd&quot;</span> <span class="ow">or</span> <span class="n">additional_con</span>
</span><span data-line="1538">    <span class="p">):</span>
</span><span data-line="1539">        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
</span><span data-line="1540">            <span class="s2">&quot;The &#39;ira_mod&#39; library is required for landscape, rmsd, or additional-con features.&quot;</span>
</span><span data-line="1541">        <span class="p">)</span>
</span><span data-line="1542">        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Please install it to use these options. Exiting.&quot;</span><span class="p">)</span>
</span><span data-line="1543">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="1544">
</span><span data-line="1545">    <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">con_file</span><span class="p">:</span>
</span><span data-line="1546">        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;--plot-structures requires a --con-file to be provided. Exiting.&quot;</span><span class="p">)</span>
</span><span data-line="1547">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

</span><span data-line="1548">
</span><span data-line="1549">
<div class="viewcode-block" id="_determine_figsize">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb._determine_figsize">[docs]</a>
</span><span data-line="1550"><span class="k">def</span><span class="w"> </span><span class="nf">_determine_figsize</span><span class="p">(</span><span class="n">figsize</span><span class="p">,</span> <span class="n">fig_height</span><span class="p">,</span> <span class="n">aspect_ratio</span><span class="p">):</span>
</span><span data-line="1551"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines the final figure size based on user inputs.&quot;&quot;&quot;</span>
</span><span data-line="1552">    <span class="k">if</span> <span class="n">fig_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">aspect_ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1553">        <span class="n">width_in</span> <span class="o">=</span> <span class="n">fig_height</span> <span class="o">*</span> <span class="n">aspect_ratio</span>
</span><span data-line="1554">        <span class="n">final_figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">width_in</span><span class="p">,</span> <span class="n">fig_height</span><span class="p">)</span>
</span><span data-line="1555">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1556">            <span class="sa">f</span><span class="s1">&#39;Using aspect ratio: height=[bold cyan]</span><span class="si">{</span><span class="n">fig_height</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&quot;[/bold cyan], &#39;</span>
</span><span data-line="1557">            <span class="sa">f</span><span class="s2">&quot;aspect=[bold cyan]</span><span class="si">{</span><span class="n">aspect_ratio</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">[/bold cyan] &quot;</span>
</span><span data-line="1558">            <span class="sa">f</span><span class="s1">&#39;-&gt; width=[bold cyan]</span><span class="si">{</span><span class="n">width_in</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&quot;[/bold cyan]&#39;</span>
</span><span data-line="1559">        <span class="p">)</span>
</span><span data-line="1560">    <span class="k">elif</span> <span class="n">fig_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">aspect_ratio</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1561">        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span data-line="1562">            <span class="s2">&quot;[bold red]Error:[/bold red] --fig-height and --aspect-ratio must be used together.&quot;</span>
</span><span data-line="1563">        <span class="p">)</span>
</span><span data-line="1564">        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Falling back to default figsize: </span><span class="si">{</span><span class="n">figsize</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1565">        <span class="n">final_figsize</span> <span class="o">=</span> <span class="n">figsize</span>
</span><span data-line="1566">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="1567">        <span class="n">final_figsize</span> <span class="o">=</span> <span class="n">figsize</span>
</span><span data-line="1568">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1569">            <span class="sa">f</span><span class="s1">&#39;Using figsize: width=[bold cyan]</span><span class="si">{</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&quot;[/bold cyan], &#39;</span>
</span><span data-line="1570">            <span class="sa">f</span><span class="s1">&#39;height=[bold cyan]</span><span class="si">{</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&quot;[/bold cyan]&#39;</span>
</span><span data-line="1571">        <span class="p">)</span>
</span><span data-line="1572">    <span class="k">return</span> <span class="n">final_figsize</span></div>

</span><span data-line="1573">
</span><span data-line="1574">
<div class="viewcode-block" id="_load_structures">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb._load_structures">[docs]</a>
</span><span data-line="1575"><span class="k">def</span><span class="w"> </span><span class="nf">_load_structures</span><span class="p">(</span><span class="n">con_file</span><span class="p">,</span> <span class="n">additional_con</span><span class="p">,</span> <span class="n">plot_type</span><span class="p">,</span> <span class="n">rc_mode</span><span class="p">,</span> <span class="n">ira_kmax</span><span class="p">):</span>
</span><span data-line="1576"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Loads atoms from .con files and calcs RMSD for additional structure.&quot;&quot;&quot;</span>
</span><span data-line="1577">    <span class="n">atoms_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1578">    <span class="k">if</span> <span class="n">con_file</span><span class="p">:</span>
</span><span data-line="1579">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1580">            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reading structures from [cyan]</span><span class="si">{</span><span class="n">con_file</span><span class="si">}</span><span class="s2">[/cyan]&quot;</span><span class="p">)</span>
</span><span data-line="1581">            <span class="n">atoms_list</span> <span class="o">=</span> <span class="n">ase_read</span><span class="p">(</span><span class="n">con_file</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span data-line="1582">            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> structures.&quot;</span><span class="p">)</span>
</span><span data-line="1583">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="1584">            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read .con file: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1585">            <span class="n">atoms_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1586">            <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;landscape&quot;</span> <span class="ow">or</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="s2">&quot;rmsd&quot;</span><span class="p">:</span>
</span><span data-line="1587">                <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Cannot proceed without structures. Exiting.&quot;</span><span class="p">)</span>
</span><span data-line="1588">                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="1589">
</span><span data-line="1590">    <span class="n">additional_atoms_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="1591">    <span class="k">if</span> <span class="n">additional_con</span> <span class="ow">and</span> <span class="n">atoms_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1592">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="1593">            <span class="n">ira_instance</span> <span class="o">=</span> <span class="n">ira_mod</span><span class="o">.</span><span class="n">IRA</span><span class="p">()</span>
</span><span data-line="1594">            <span class="k">for</span> <span class="n">add_file</span><span class="p">,</span> <span class="n">add_label</span> <span class="ow">in</span> <span class="n">additional_con</span><span class="p">:</span>
</span><span data-line="1595">                <span class="c1"># LOGIC: If user passed &quot;&quot; string, use filename stem</span>
</span><span data-line="1596">                <span class="k">if</span> <span class="ow">not</span> <span class="n">add_label</span> <span class="ow">or</span> <span class="n">add_label</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
</span><span data-line="1597">                    <span class="n">label</span> <span class="o">=</span> <span class="n">add_file</span><span class="o">.</span><span class="n">stem</span>
</span><span data-line="1598">                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1599">                        <span class="sa">f</span><span class="s2">&quot;Label empty for </span><span class="si">{</span><span class="n">add_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">,&quot;</span>
</span><span data-line="1600">                        <span class="sa">f</span><span class="s2">&quot; defaulting to: [yellow]</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">[/yellow]&quot;</span>
</span><span data-line="1601">                    <span class="p">)</span>
</span><span data-line="1602">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="1603">                    <span class="n">label</span> <span class="o">=</span> <span class="n">add_label</span>
</span><span data-line="1604">                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1605">                    <span class="sa">f</span><span class="s2">&quot;Reading additional structure from [cyan]</span><span class="si">{</span><span class="n">add_file</span><span class="si">}</span><span class="s2">[/cyan]&quot;</span>
</span><span data-line="1606">                    <span class="sa">f</span><span class="s2">&quot; with label &#39;[yellow]</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">[/yellow]&#39;&quot;</span>
</span><span data-line="1607">                <span class="p">)</span>
</span><span data-line="1608">
</span><span data-line="1609">                <span class="n">additional_atoms</span> <span class="o">=</span> <span class="n">ase_read</span><span class="p">(</span><span class="n">add_file</span><span class="p">)</span>
</span><span data-line="1610">
</span><span data-line="1611">                <span class="n">add_rmsd_r</span> <span class="o">=</span> <span class="n">calculate_rmsd_from_ref</span><span class="p">(</span>
</span><span data-line="1612">                    <span class="p">[</span><span class="n">additional_atoms</span><span class="p">],</span>
</span><span data-line="1613">                    <span class="n">ira_instance</span><span class="p">,</span>
</span><span data-line="1614">                    <span class="n">ref_atom</span><span class="o">=</span><span class="n">atoms_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
</span><span data-line="1615">                    <span class="n">ira_kmax</span><span class="o">=</span><span class="n">ira_kmax</span><span class="p">,</span>
</span><span data-line="1616">                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="1617">                <span class="n">add_rmsd_p</span> <span class="o">=</span> <span class="n">calculate_rmsd_from_ref</span><span class="p">(</span>
</span><span data-line="1618">                    <span class="p">[</span><span class="n">additional_atoms</span><span class="p">],</span>
</span><span data-line="1619">                    <span class="n">ira_instance</span><span class="p">,</span>
</span><span data-line="1620">                    <span class="n">ref_atom</span><span class="o">=</span><span class="n">atoms_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span data-line="1621">                    <span class="n">ira_kmax</span><span class="o">=</span><span class="n">ira_kmax</span><span class="p">,</span>
</span><span data-line="1622">                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="1623">
</span><span data-line="1624">                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1625">                    <span class="sa">f</span><span class="s2">&quot;  -&gt; </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">: RMSD_R=</span><span class="si">{</span><span class="n">add_rmsd_r</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, RMSD_P=</span><span class="si">{</span><span class="n">add_rmsd_p</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="1626">                <span class="p">)</span>
</span><span data-line="1627">
</span><span data-line="1628">                <span class="c1"># Store tuple: (Atoms, RMSD_R, RMSD_P, Label)</span>
</span><span data-line="1629">                <span class="n">additional_atoms_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="1630">                    <span class="p">(</span><span class="n">additional_atoms</span><span class="p">,</span> <span class="n">add_rmsd_r</span><span class="p">,</span> <span class="n">add_rmsd_p</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
</span><span data-line="1631">                <span class="p">)</span>
</span><span data-line="1632">
</span><span data-line="1633">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="1634">            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read or process additional structures: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1635">
</span><span data-line="1636">    <span class="k">return</span> <span class="n">atoms_list</span><span class="p">,</span> <span class="n">additional_atoms_data</span></div>

</span><span data-line="1637">
</span><span data-line="1638">
<div class="viewcode-block" id="_validate_data_atoms_match">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb._validate_data_atoms_match">[docs]</a>
</span><span data-line="1639"><span class="k">def</span><span class="w"> </span><span class="nf">_validate_data_atoms_match</span><span class="p">(</span><span class="n">z_data</span><span class="p">,</span> <span class="n">atoms</span><span class="p">,</span> <span class="n">dat_file_name</span><span class="p">):</span>
</span><span data-line="1640"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks if data points count matches structure count, exits on mismatch.&quot;&quot;&quot;</span>
</span><span data-line="1641">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_data</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">):</span>
</span><span data-line="1642">        <span class="n">errmsg</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1643">            <span class="sa">f</span><span class="s2">&quot;Structure count (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms</span><span class="p">)</span><span class="si">}</span><span class="s2">) != data point count &quot;</span>
</span><span data-line="1644">            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">z_data</span><span class="p">)</span><span class="si">}</span><span class="s2">) in </span><span class="si">{</span><span class="n">dat_file_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="1645">        <span class="p">)</span>
</span><span data-line="1646">        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span>
</span><span data-line="1647">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">errmsg</span><span class="p">)</span></div>

</span><span data-line="1648">
</span><span data-line="1649">
<div class="viewcode-block" id="_get_profile_labels">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb._get_profile_labels">[docs]</a>
</span><span data-line="1650"><span class="k">def</span><span class="w"> </span><span class="nf">_get_profile_labels</span><span class="p">(</span><span class="n">rc_mode</span><span class="p">,</span> <span class="n">plot_mode</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">atoms_list</span><span class="p">):</span>
</span><span data-line="1651"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determines default labels for profile plots.&quot;&quot;&quot;</span>
</span><span data-line="1652">    <span class="n">default_xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;Reaction Coordinate ($\AA$)&quot;</span>
</span><span data-line="1653">
</span><span data-line="1654">    <span class="k">if</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="n">RCMode</span><span class="o">.</span><span class="n">RMSD</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">atoms_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1655">        <span class="n">default_xlabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;RMSD from Reactant ($\AA$)&quot;</span>
</span><span data-line="1656">    <span class="k">elif</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="n">RCMode</span><span class="o">.</span><span class="n">INDEX</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span data-line="1657">        <span class="n">default_xlabel</span> <span class="o">=</span> <span class="s2">&quot;Image Index&quot;</span>
</span><span data-line="1658">
</span><span data-line="1659">    <span class="n">final_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span> <span class="ow">or</span> <span class="n">default_xlabel</span>
</span><span data-line="1660">
</span><span data-line="1661">    <span class="n">default_ylabel</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1662">        <span class="s2">&quot;Relative Energy (eV)&quot;</span>
</span><span data-line="1663">        <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="n">PlotMode</span><span class="o">.</span><span class="n">ENERGY</span><span class="o">.</span><span class="n">value</span>
</span><span data-line="1664">        <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;Lowest EigenValue (eV/$\AA^2$)&quot;</span>
</span><span data-line="1665">    <span class="p">)</span>
</span><span data-line="1666">    <span class="n">final_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span> <span class="ow">or</span> <span class="n">default_ylabel</span>
</span><span data-line="1667">
</span><span data-line="1668">    <span class="k">return</span> <span class="n">final_xlabel</span><span class="p">,</span> <span class="n">final_ylabel</span></div>

</span><span data-line="1669">
</span><span data-line="1670">
<div class="viewcode-block" id="_aggregate_all_paths">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb._aggregate_all_paths">[docs]</a>
</span><span data-line="1671"><span class="k">def</span><span class="w"> </span><span class="nf">_aggregate_all_paths</span><span class="p">(</span>
</span><span data-line="1672">    <span class="n">all_dat_paths</span><span class="p">,</span>
</span><span data-line="1673">    <span class="n">all_con_paths</span><span class="p">,</span>
</span><span data-line="1674">    <span class="n">y_data_column</span><span class="p">,</span>
</span><span data-line="1675">    <span class="n">ira_instance</span><span class="p">,</span>
</span><span data-line="1676">    <span class="n">cache_file</span><span class="p">:</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="1677">    <span class="n">force_recompute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="1678">    <span class="n">ira_kmax</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">IRA_KMAX_DEFAULT</span><span class="p">,</span>
</span><span data-line="1679"><span class="p">):</span>
</span><span data-line="1680"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1681"><span class="sd">    Loads and aggregates data from all .dat and .con files for 2D surface using</span>
</span><span data-line="1682"><span class="sd">    Polars and averaging points within each bin. Optionally, a cache file is</span>
</span><span data-line="1683"><span class="sd">    used.</span>
</span><span data-line="1684">
</span><span data-line="1685"><span class="sd">    Returns:</span>
</span><span data-line="1686"><span class="sd">      df_raw</span>
</span><span data-line="1687"><span class="sd">    where df_raw is a Polars DataFrame with columns: [r, p, z, step]</span>
</span><span data-line="1688"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="1689">
</span><span data-line="1690">    <span class="k">def</span><span class="w"> </span><span class="nf">validate_landscape_cache</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span data-line="1691">        <span class="k">if</span> <span class="s2">&quot;p&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span data-line="1692">            <span class="n">verr</span> <span class="o">=</span> <span class="s2">&quot;Cache missing &#39;p&#39; column (looks like profile data).&quot;</span>
</span><span data-line="1693">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">verr</span><span class="p">)</span>
</span><span data-line="1694">
</span><span data-line="1695">    <span class="k">def</span><span class="w"> </span><span class="nf">compute_landscape_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span data-line="1696">        <span class="n">all_dfs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="1697">
</span><span data-line="1698">        <span class="c1"># Synchronization check</span>
</span><span data-line="1699">        <span class="n">paths_dat</span> <span class="o">=</span> <span class="n">all_dat_paths</span>
</span><span data-line="1700">        <span class="n">paths_con</span> <span class="o">=</span> <span class="n">all_con_paths</span>
</span><span data-line="1701">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths_dat</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths_con</span><span class="p">):</span>
</span><span data-line="1702">            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mismatch: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">paths_dat</span><span class="p">)</span><span class="si">}</span><span class="s2"> dat vs </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">paths_con</span><span class="p">)</span><span class="si">}</span><span class="s2"> con.&quot;</span><span class="p">)</span>
</span><span data-line="1703">            <span class="n">min_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">paths_dat</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">paths_con</span><span class="p">))</span>
</span><span data-line="1704">            <span class="n">paths_dat</span> <span class="o">=</span> <span class="n">paths_dat</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
</span><span data-line="1705">            <span class="n">paths_con</span> <span class="o">=</span> <span class="n">paths_con</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
</span><span data-line="1706">
</span><span data-line="1707">        <span class="k">for</span> <span class="n">step_idx</span><span class="p">,</span> <span class="p">(</span><span class="n">dat_file</span><span class="p">,</span> <span class="n">con_file_step</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
</span><span data-line="1708">            <span class="nb">zip</span><span class="p">(</span><span class="n">paths_dat</span><span class="p">,</span> <span class="n">paths_con</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span data-line="1709">        <span class="p">):</span>
</span><span data-line="1710">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="1711">                <span class="n">path_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">dat_file</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span data-line="1712">                <span class="n">z_data_step</span> <span class="o">=</span> <span class="n">path_data</span><span class="p">[</span><span class="n">y_data_column</span><span class="p">]</span>
</span><span data-line="1713">                <span class="n">atoms_list_step</span> <span class="o">=</span> <span class="n">ase_read</span><span class="p">(</span><span class="n">con_file_step</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
</span><span data-line="1714">                <span class="n">_validate_data_atoms_match</span><span class="p">(</span><span class="n">z_data_step</span><span class="p">,</span> <span class="n">atoms_list_step</span><span class="p">,</span> <span class="n">dat_file</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span data-line="1715">
</span><span data-line="1716">                <span class="n">rmsd_r</span><span class="p">,</span> <span class="n">rmsd_p</span> <span class="o">=</span> <span class="n">calculate_landscape_coords</span><span class="p">(</span>
</span><span data-line="1717">                    <span class="n">atoms_list_step</span><span class="p">,</span> <span class="n">ira_instance</span><span class="p">,</span> <span class="n">ira_kmax</span>
</span><span data-line="1718">                <span class="p">)</span>
</span><span data-line="1719">
</span><span data-line="1720">                <span class="n">all_dfs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="1721">                    <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span data-line="1722">                        <span class="p">{</span>
</span><span data-line="1723">                            <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="n">rmsd_r</span><span class="p">,</span>
</span><span data-line="1724">                            <span class="s2">&quot;p&quot;</span><span class="p">:</span> <span class="n">rmsd_p</span><span class="p">,</span>
</span><span data-line="1725">                            <span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="n">z_data_step</span><span class="p">,</span>
</span><span data-line="1726">                            <span class="s2">&quot;step&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">step_idx</span><span class="p">),</span>
</span><span data-line="1727">                        <span class="p">}</span>
</span><span data-line="1728">                    <span class="p">)</span>
</span><span data-line="1729">                <span class="p">)</span>
</span><span data-line="1730">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="1731">                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process step </span><span class="si">{</span><span class="n">step_idx</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">dat_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1732">                <span class="k">continue</span>
</span><span data-line="1733">
</span><span data-line="1734">        <span class="k">if</span> <span class="ow">not</span> <span class="n">all_dfs</span><span class="p">:</span>
</span><span data-line="1735">            <span class="n">rerr</span> <span class="o">=</span> <span class="s2">&quot;No data could be aggregated from files.&quot;</span>
</span><span data-line="1736">            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="n">rerr</span><span class="p">)</span>
</span><span data-line="1737">
</span><span data-line="1738">        <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_dfs</span><span class="p">)</span>
</span><span data-line="1739">
</span><span data-line="1740">    <span class="c1"># Execute via Handler</span>
</span><span data-line="1741">    <span class="k">return</span> <span class="n">_load_or_compute_data</span><span class="p">(</span>
</span><span data-line="1742">        <span class="n">cache_file</span><span class="o">=</span><span class="n">cache_file</span><span class="p">,</span>
</span><span data-line="1743">        <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
</span><span data-line="1744">        <span class="n">validation_check</span><span class="o">=</span><span class="n">validate_landscape_cache</span><span class="p">,</span>
</span><span data-line="1745">        <span class="n">computation_callback</span><span class="o">=</span><span class="n">compute_landscape_data</span><span class="p">,</span>
</span><span data-line="1746">        <span class="n">context_name</span><span class="o">=</span><span class="s2">&quot;Landscape&quot;</span><span class="p">,</span>
</span><span data-line="1747">    <span class="p">)</span></div>

</span><span data-line="1748">
</span><span data-line="1749">
</span><span data-line="1750"><span class="c1"># --- Main Plotting Functions ---</span>
</span><span data-line="1751">
</span><span data-line="1752">
<div class="viewcode-block" id="_plot_landscape">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb._plot_landscape">[docs]</a>
</span><span data-line="1753"><span class="k">def</span><span class="w"> </span><span class="nf">_plot_landscape</span><span class="p">(</span>
</span><span data-line="1754">    <span class="n">ax</span><span class="p">,</span>
</span><span data-line="1755">    <span class="n">ax_strip</span><span class="p">,</span>
</span><span data-line="1756">    <span class="n">atoms_list</span><span class="p">,</span>
</span><span data-line="1757">    <span class="n">input_dat_pattern</span><span class="p">,</span>
</span><span data-line="1758">    <span class="n">input_path_pattern</span><span class="p">,</span>
</span><span data-line="1759">    <span class="n">con_file</span><span class="p">,</span>
</span><span data-line="1760">    <span class="n">additional_atoms_data</span><span class="p">,</span>
</span><span data-line="1761">    <span class="n">landscape_path</span><span class="p">,</span>
</span><span data-line="1762">    <span class="n">landscape_mode</span><span class="p">,</span>
</span><span data-line="1763">    <span class="n">plot_mode</span><span class="p">,</span>
</span><span data-line="1764">    <span class="n">surface_type</span><span class="p">,</span>
</span><span data-line="1765">    <span class="n">plot_structures</span><span class="p">,</span>
</span><span data-line="1766">    <span class="n">show_pts</span><span class="p">,</span>
</span><span data-line="1767">    <span class="n">rbf_smoothing</span><span class="p">,</span>
</span><span data-line="1768">    <span class="n">rounding</span><span class="p">,</span>
</span><span data-line="1769">    <span class="n">selected_theme</span><span class="p">,</span>
</span><span data-line="1770">    <span class="n">cache_file</span><span class="p">,</span>
</span><span data-line="1771">    <span class="n">force_recompute</span><span class="p">,</span>
</span><span data-line="1772">    <span class="n">ira_kmax</span><span class="p">,</span>
</span><span data-line="1773">    <span class="c1"># Inset args</span>
</span><span data-line="1774">    <span class="n">draw_reactant</span><span class="p">,</span>
</span><span data-line="1775">    <span class="n">draw_saddle</span><span class="p">,</span>
</span><span data-line="1776">    <span class="n">draw_product</span><span class="p">,</span>
</span><span data-line="1777">    <span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="1778">    <span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="1779">    <span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="1780">    <span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="1781">    <span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="1782">    <span class="n">show_legend</span><span class="p">,</span>
</span><span data-line="1783"><span class="p">):</span>
</span><span data-line="1784"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles all logic for drawing 2D landscape plots.&quot;&quot;&quot;</span>
</span><span data-line="1785">    <span class="n">ira_instance</span> <span class="o">=</span> <span class="n">ira_mod</span><span class="o">.</span><span class="n">IRA</span><span class="p">()</span>
</span><span data-line="1786">    <span class="c1"># --- Efficient index-based pairing &amp; truncation (fast; no Path.resolve) ---</span>
</span><span data-line="1787">    <span class="c1"># discover .dat and .con step files</span>
</span><span data-line="1788">    <span class="n">all_dat_paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">input_dat_pattern</span><span class="p">))</span>
</span><span data-line="1789">    <span class="n">con_pattern</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_path_pattern</span><span class="p">)</span>
</span><span data-line="1790">    <span class="n">all_con_paths</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">con_pattern</span><span class="p">))</span>
</span><span data-line="1791">
</span><span data-line="1792">    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_dat_paths</span><span class="p">:</span>
</span><span data-line="1793">        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
</span><span data-line="1794">            <span class="sa">f</span><span class="s2">&quot;No .dat files found matching pattern: </span><span class="si">{</span><span class="n">input_dat_pattern</span><span class="si">}</span><span class="s2">. Exiting.&quot;</span>
</span><span data-line="1795">        <span class="p">)</span>
</span><span data-line="1796">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="1797">
</span><span data-line="1798">    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_con_paths</span><span class="p">:</span>
</span><span data-line="1799">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="1800">            <span class="sa">f</span><span class="s2">&quot;No .con files found matching pattern: </span><span class="si">{</span><span class="n">con_pattern</span><span class="si">}</span><span class="s2">. Falling back to single --con-file: </span><span class="si">{</span><span class="n">con_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="1801">        <span class="p">)</span>
</span><span data-line="1802">        <span class="n">all_con_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">con_file</span><span class="p">]</span>
</span><span data-line="1803">
</span><span data-line="1804">    <span class="c1"># fast helper: extract numeric index from filename (returns None if none found)</span>
</span><span data-line="1805">    <span class="n">_num_re</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(\d{1,6})&quot;</span><span class="p">)</span>
</span><span data-line="1806">
</span><span data-line="1807">    <span class="k">def</span><span class="w"> </span><span class="nf">_index_from_name</span><span class="p">(</span><span class="n">p</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1808">        <span class="n">m</span> <span class="o">=</span> <span class="n">_num_re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span data-line="1809">        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
</span><span data-line="1810">            <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="1811">        <span class="c1"># preserve numeric value (leading zeros ignored)</span>
</span><span data-line="1812">        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span><span data-line="1813">
</span><span data-line="1814">    <span class="c1"># build dicts index -&gt; path for dat and con (only keep entries with numeric indices)</span>
</span><span data-line="1815">    <span class="n">dat_index_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="1816">    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_dat_paths</span><span class="p">:</span>
</span><span data-line="1817">        <span class="n">idx</span> <span class="o">=</span> <span class="n">_index_from_name</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span data-line="1818">        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1819">            <span class="n">dat_index_map</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span data-line="1820">
</span><span data-line="1821">    <span class="n">con_index_map</span> <span class="o">=</span> <span class="p">{}</span>
</span><span data-line="1822">    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_con_paths</span><span class="p">:</span>
</span><span data-line="1823">        <span class="n">idx</span> <span class="o">=</span> <span class="n">_index_from_name</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span data-line="1824">        <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1825">            <span class="n">con_index_map</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span>
</span><span data-line="1826">
</span><span data-line="1827">    <span class="c1"># If both maps have numeric indices, build sorted matched index list</span>
</span><span data-line="1828">    <span class="n">common_indices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">dat_index_map</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">con_index_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span data-line="1829">    <span class="k">if</span> <span class="n">common_indices</span><span class="p">:</span>
</span><span data-line="1830">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1831">            <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">common_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> numerically-matched dat/con step indices.&quot;</span>
</span><span data-line="1832">        <span class="p">)</span>
</span><span data-line="1833">        <span class="c1"># If user supplied a specific --con-file and it has a numeric index,</span>
</span><span data-line="1834">        <span class="c1"># truncate at that index</span>
</span><span data-line="1835">        <span class="n">supplied_idx</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1836">            <span class="n">_index_from_name</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">con_file</span><span class="p">))</span> <span class="k">if</span> <span class="n">con_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
</span><span data-line="1837">        <span class="p">)</span>
</span><span data-line="1838">        <span class="k">if</span> <span class="n">supplied_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1839">            <span class="c1"># find the last index &lt;= supplied_idx that exists in the common set</span>
</span><span data-line="1840">            <span class="c1"># (if supplied index not present, use the largest common index &lt; supplied_idx)</span>
</span><span data-line="1841">            <span class="n">allowed</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">common_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">supplied_idx</span><span class="p">]</span>
</span><span data-line="1842">            <span class="k">if</span> <span class="ow">not</span> <span class="n">allowed</span><span class="p">:</span>
</span><span data-line="1843">                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="1844">                    <span class="sa">f</span><span class="s2">&quot;Supplied --con-file index </span><span class="si">{</span><span class="n">supplied_idx</span><span class="si">}</span><span class="s2"> not found&quot;</span>
</span><span data-line="1845">                    <span class="s2">&quot;among step files. Using full range of available indices.&quot;</span>
</span><span data-line="1846">                <span class="p">)</span>
</span><span data-line="1847">                <span class="n">use_indices</span> <span class="o">=</span> <span class="n">common_indices</span>
</span><span data-line="1848">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1849">                <span class="n">max_allowed</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">allowed</span><span class="p">)</span>
</span><span data-line="1850">                <span class="n">use_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">common_indices</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">max_allowed</span><span class="p">]</span>
</span><span data-line="1851">                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1852">                    <span class="sa">f</span><span class="s2">&quot;Truncating to indices &lt;= </span><span class="si">{</span><span class="n">max_allowed</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="1853">                    <span class="sa">f</span><span class="s2">&quot; (user requested </span><span class="si">{</span><span class="n">supplied_idx</span><span class="si">}</span><span class="s2">).&quot;</span>
</span><span data-line="1854">                    <span class="sa">f</span><span class="s2">&quot;Using </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">use_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> steps.&quot;</span>
</span><span data-line="1855">                <span class="p">)</span>
</span><span data-line="1856">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1857">            <span class="c1"># no numeric index in supplied con_file or not provided: use all</span>
</span><span data-line="1858">            <span class="c1"># common indices</span>
</span><span data-line="1859">            <span class="n">use_indices</span> <span class="o">=</span> <span class="n">common_indices</span>
</span><span data-line="1860">
</span><span data-line="1861">        <span class="c1"># Build ordered lists of matched dat and con paths by index</span>
</span><span data-line="1862">        <span class="n">all_dat_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">dat_index_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">use_indices</span><span class="p">]</span>
</span><span data-line="1863">        <span class="n">all_con_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">con_index_map</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">use_indices</span><span class="p">]</span>
</span><span data-line="1864">
</span><span data-line="1865">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="1866">        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span data-line="1867">            <span class="s2">&quot;No numeric indices found in filenames,&quot;</span>
</span><span data-line="1868">            <span class="s2">&quot; falling back to positional truncation behavior.&quot;</span>
</span><span data-line="1869">        <span class="p">)</span>
</span><span data-line="1870">        <span class="k">if</span> <span class="n">con_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1871">            <span class="n">supplied_name</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">con_file</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span data-line="1872">            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">all_con_paths</span><span class="p">]</span>
</span><span data-line="1873">            <span class="k">if</span> <span class="n">supplied_name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
</span><span data-line="1874">                <span class="n">idx</span> <span class="o">=</span> <span class="n">names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">supplied_name</span><span class="p">)</span>
</span><span data-line="1875">                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1876">                    <span class="s2">&quot;Truncating step .con list to&quot;</span>
</span><span data-line="1877">                    <span class="sa">f</span><span class="s2">&quot; user-provided file: </span><span class="si">{</span><span class="n">all_con_paths</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (index </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span data-line="1878">                <span class="p">)</span>
</span><span data-line="1879">                <span class="n">all_con_paths</span> <span class="o">=</span> <span class="n">all_con_paths</span><span class="p">[:</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span data-line="1880">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="1881">                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span data-line="1882">                    <span class="s2">&quot;Provided --con-file not found among discovered step .con files by&quot;</span>
</span><span data-line="1883">                    <span class="s2">&quot; name; proceeding with discovered step files.&quot;</span>
</span><span data-line="1884">                <span class="p">)</span>
</span><span data-line="1885">        <span class="c1"># Finally truncate to min length to pair dat/con by order</span>
</span><span data-line="1886">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_dat_paths</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_con_paths</span><span class="p">):</span>
</span><span data-line="1887">            <span class="n">min_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_dat_paths</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_con_paths</span><span class="p">))</span>
</span><span data-line="1888">            <span class="k">if</span> <span class="n">min_len</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="1889">                <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
</span><span data-line="1890">                    <span class="s2">&quot;No matching .dat or .con files&quot;</span>
</span><span data-line="1891">                    <span class="s2">&quot; available after fallback truncation. Exiting.&quot;</span>
</span><span data-line="1892">                <span class="p">)</span>
</span><span data-line="1893">                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="1894">            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1895">                <span class="sa">f</span><span class="s2">&quot;Truncating lists to common length </span><span class="si">{</span><span class="n">min_len</span><span class="si">}</span><span class="s2">: &quot;</span>
</span><span data-line="1896">                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_dat_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> .dat files and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_con_paths</span><span class="p">)</span><span class="si">}</span><span class="s2"> .con files.&quot;</span>
</span><span data-line="1897">            <span class="p">)</span>
</span><span data-line="1898">            <span class="n">all_dat_paths</span> <span class="o">=</span> <span class="n">all_dat_paths</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
</span><span data-line="1899">            <span class="n">all_con_paths</span> <span class="o">=</span> <span class="n">all_con_paths</span><span class="p">[:</span><span class="n">min_len</span><span class="p">]</span>
</span><span data-line="1900">
</span><span data-line="1901">    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_dat_paths</span><span class="p">:</span>
</span><span data-line="1902">        <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
</span><span data-line="1903">            <span class="sa">f</span><span class="s2">&quot;No .dat files found matching pattern: </span><span class="si">{</span><span class="n">input_dat_pattern</span><span class="si">}</span><span class="s2">. Exiting.&quot;</span>
</span><span data-line="1904">        <span class="p">)</span>
</span><span data-line="1905">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="1906">    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_con_paths</span><span class="p">:</span>
</span><span data-line="1907">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No .con files found matching pattern: </span><span class="si">{</span><span class="n">con_pattern</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span data-line="1908">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Falling back to single --con-file: </span><span class="si">{</span><span class="n">con_file</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1909">        <span class="n">all_con_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">con_file</span><span class="p">]</span>
</span><span data-line="1910">
</span><span data-line="1911">    <span class="n">y_data_column</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="n">PlotMode</span><span class="o">.</span><span class="n">ENERGY</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="mi">4</span>
</span><span data-line="1912">    <span class="n">z_label</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1913">        <span class="s2">&quot;Relative Energy (eV)&quot;</span>
</span><span data-line="1914">        <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="n">PlotMode</span><span class="o">.</span><span class="n">ENERGY</span><span class="o">.</span><span class="n">value</span>
</span><span data-line="1915">        <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;Lowest Eigenvalue (eV/$\AA^2$)&quot;</span>
</span><span data-line="1916">    <span class="p">)</span>
</span><span data-line="1917">
</span><span data-line="1918">    <span class="c1"># --- Load Data (With Cache) ---</span>
</span><span data-line="1919">    <span class="c1"># We now get a RAW dataframe with a &#39;step&#39; column</span>
</span><span data-line="1920">    <span class="n">df_raw</span> <span class="o">=</span> <span class="n">_aggregate_all_paths</span><span class="p">(</span>
</span><span data-line="1921">        <span class="n">all_dat_paths</span><span class="p">,</span>
</span><span data-line="1922">        <span class="n">all_con_paths</span><span class="p">,</span>
</span><span data-line="1923">        <span class="n">y_data_column</span><span class="p">,</span>
</span><span data-line="1924">        <span class="n">ira_instance</span><span class="p">,</span>
</span><span data-line="1925">        <span class="n">cache_file</span><span class="o">=</span><span class="n">cache_file</span><span class="p">,</span>
</span><span data-line="1926">        <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
</span><span data-line="1927">        <span class="n">ira_kmax</span><span class="o">=</span><span class="n">ira_kmax</span><span class="p">,</span>
</span><span data-line="1928">    <span class="p">)</span>
</span><span data-line="1929">
</span><span data-line="1930">    <span class="c1"># --- Prepare Data for Surface Interpolation ---</span>
</span><span data-line="1931">    <span class="c1"># We group and mean-aggregate for the surface generation to handle dense spots</span>
</span><span data-line="1932">    <span class="k">if</span> <span class="n">landscape_path</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
</span><span data-line="1933">        <span class="c1"># Only use the final step for the surface</span>
</span><span data-line="1934">        <span class="n">max_step</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span data-line="1935">        <span class="n">df_surface_source</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_step</span><span class="p">)</span>
</span><span data-line="1936">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="1937">        <span class="c1"># Use all steps</span>
</span><span data-line="1938">        <span class="n">df_surface_source</span> <span class="o">=</span> <span class="n">df_raw</span>
</span><span data-line="1939">
</span><span data-line="1940">    <span class="c1"># Rounding and Grouping for Surface Grid</span>
</span><span data-line="1941">    <span class="n">df_binned</span> <span class="o">=</span> <span class="n">df_surface_source</span><span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span data-line="1942">        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rounding</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;r_rnd&quot;</span><span class="p">),</span>
</span><span data-line="1943">        <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rounding</span><span class="p">)</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;p_rnd&quot;</span><span class="p">),</span>
</span><span data-line="1944">    <span class="p">)</span>
</span><span data-line="1945">    <span class="n">df_grouped</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1946">        <span class="n">df_binned</span><span class="o">.</span><span class="n">group_by</span><span class="p">([</span><span class="s2">&quot;r_rnd&quot;</span><span class="p">,</span> <span class="s2">&quot;p_rnd&quot;</span><span class="p">])</span>
</span><span data-line="1947">        <span class="o">.</span><span class="n">agg</span><span class="p">(</span>
</span><span data-line="1948">            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;r_mean&quot;</span><span class="p">),</span>
</span><span data-line="1949">            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;p_mean&quot;</span><span class="p">),</span>
</span><span data-line="1950">            <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">alias</span><span class="p">(</span><span class="s2">&quot;z_mean&quot;</span><span class="p">),</span>
</span><span data-line="1951">        <span class="p">)</span>
</span><span data-line="1952">        <span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s2">&quot;r_mean&quot;</span><span class="p">,</span> <span class="s2">&quot;p_mean&quot;</span><span class="p">])</span>
</span><span data-line="1953">    <span class="p">)</span>
</span><span data-line="1954">
</span><span data-line="1955">    <span class="n">rmsd_r</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;r_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="1956">    <span class="n">rmsd_p</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;p_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="1957">    <span class="n">z_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="s2">&quot;z_mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="1958">    <span class="n">all_pts_r</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="1959">    <span class="n">all_pts_p</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="1960">
</span><span data-line="1961">    <span class="c1"># --- Plot Surface ---</span>
</span><span data-line="1962">    <span class="k">if</span> <span class="n">landscape_mode</span> <span class="o">==</span> <span class="s2">&quot;surface&quot;</span><span class="p">:</span>
</span><span data-line="1963">        <span class="k">if</span> <span class="n">surface_type</span> <span class="o">==</span> <span class="s2">&quot;grid&quot;</span><span class="p">:</span>
</span><span data-line="1964">            <span class="n">plot_interpolated_grid</span><span class="p">(</span>
</span><span data-line="1965">                <span class="n">ax</span><span class="p">,</span>
</span><span data-line="1966">                <span class="n">rmsd_r</span><span class="p">,</span>
</span><span data-line="1967">                <span class="n">rmsd_p</span><span class="p">,</span>
</span><span data-line="1968">                <span class="n">z_data</span><span class="p">,</span>
</span><span data-line="1969">                <span class="n">show_pts</span><span class="p">,</span>
</span><span data-line="1970">                <span class="n">selected_theme</span><span class="o">.</span><span class="n">cmap_landscape</span><span class="p">,</span>
</span><span data-line="1971">                <span class="n">scatter_r</span><span class="o">=</span><span class="n">all_pts_r</span><span class="p">,</span>
</span><span data-line="1972">                <span class="n">scatter_p</span><span class="o">=</span><span class="n">all_pts_p</span><span class="p">,</span>
</span><span data-line="1973">            <span class="p">)</span>
</span><span data-line="1974">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="1975">            <span class="k">if</span> <span class="n">rbf_smoothing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1976">                <span class="c1"># Shift and subtract to calculate distances between sequential</span>
</span><span data-line="1977">                <span class="c1"># images within each step grouping by &#39;step&#39; to ensure we only</span>
</span><span data-line="1978">                <span class="c1"># calculate distances between images in the same path</span>
</span><span data-line="1979">                <span class="n">df_dist</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1980">                    <span class="n">df_raw</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s2">&quot;step&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">])</span>
</span><span data-line="1981">                    <span class="o">.</span><span class="n">with_columns</span><span class="p">(</span>
</span><span data-line="1982">                        <span class="n">dr</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">),</span>
</span><span data-line="1983">                        <span class="n">dp</span><span class="o">=</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">over</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">),</span>
</span><span data-line="1984">                    <span class="p">)</span>
</span><span data-line="1985">                    <span class="o">.</span><span class="n">with_columns</span><span class="p">(</span><span class="n">dist</span><span class="o">=</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;dr&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;dp&quot;</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">())</span>
</span><span data-line="1986">                    <span class="o">.</span><span class="n">drop_nulls</span><span class="p">()</span>
</span><span data-line="1987">                <span class="p">)</span>
</span><span data-line="1988">
</span><span data-line="1989">                <span class="c1"># Aggregate all distances across the entire optimization history</span>
</span><span data-line="1990">                <span class="n">global_median_step</span> <span class="o">=</span> <span class="n">df_dist</span><span class="p">[</span><span class="s2">&quot;dist&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</span><span data-line="1991">
</span><span data-line="1992">                <span class="c1"># Apply the 0.1 multiplier to the global median for a tighter ridge</span>
</span><span data-line="1993">                <span class="n">rbf_smoothing</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">global_median_step</span>
</span><span data-line="1994">
</span><span data-line="1995">                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span data-line="1996">                    <span class="s2">&quot;Global path-resolution smoothing applied &quot;</span>
</span><span data-line="1997">                    <span class="sa">f</span><span class="s2">&quot;(median of all steps): [bold cyan]</span><span class="si">{</span><span class="n">rbf_smoothing</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">[/bold cyan]&quot;</span>
</span><span data-line="1998">                <span class="p">)</span>
</span><span data-line="1999">            <span class="n">plot_interpolated_rbf</span><span class="p">(</span>
</span><span data-line="2000">                <span class="n">ax</span><span class="p">,</span>
</span><span data-line="2001">                <span class="n">rmsd_r</span><span class="p">,</span>
</span><span data-line="2002">                <span class="n">rmsd_p</span><span class="p">,</span>
</span><span data-line="2003">                <span class="n">z_data</span><span class="p">,</span>
</span><span data-line="2004">                <span class="n">show_pts</span><span class="p">,</span>
</span><span data-line="2005">                <span class="n">rbf_smoothing</span><span class="p">,</span>
</span><span data-line="2006">                <span class="n">selected_theme</span><span class="o">.</span><span class="n">cmap_landscape</span><span class="p">,</span>
</span><span data-line="2007">                <span class="n">scatter_r</span><span class="o">=</span><span class="n">all_pts_r</span><span class="p">,</span>
</span><span data-line="2008">                <span class="n">scatter_p</span><span class="o">=</span><span class="n">all_pts_p</span><span class="p">,</span>
</span><span data-line="2009">            <span class="p">)</span>
</span><span data-line="2010">
</span><span data-line="2011">    <span class="c1"># --- Plot Final Path Overlay ---</span>
</span><span data-line="2012">    <span class="c1"># We can get this from the DF or the final file. Using the DF guarantees consistency.</span>
</span><span data-line="2013">    <span class="n">max_step</span> <span class="o">=</span> <span class="n">df_raw</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span data-line="2014">    <span class="n">df_final</span> <span class="o">=</span> <span class="n">df_raw</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_step</span><span class="p">)</span>
</span><span data-line="2015">    <span class="n">final_rmsd_r</span> <span class="o">=</span> <span class="n">df_final</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="2016">    <span class="n">final_rmsd_p</span> <span class="o">=</span> <span class="n">df_final</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="2017">    <span class="n">final_z_data</span> <span class="o">=</span> <span class="n">df_final</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="2018">
</span><span data-line="2019">    <span class="n">plot_landscape_path</span><span class="p">(</span>
</span><span data-line="2020">        <span class="n">ax</span><span class="p">,</span>
</span><span data-line="2021">        <span class="n">final_rmsd_r</span><span class="p">,</span>
</span><span data-line="2022">        <span class="n">final_rmsd_p</span><span class="p">,</span>
</span><span data-line="2023">        <span class="n">final_z_data</span><span class="p">,</span>
</span><span data-line="2024">        <span class="n">selected_theme</span><span class="o">.</span><span class="n">cmap_landscape</span><span class="p">,</span>
</span><span data-line="2025">        <span class="n">z_label</span><span class="p">,</span>
</span><span data-line="2026">    <span class="p">)</span>
</span><span data-line="2027">    <span class="c1"># Consistent logic with insets: Max energy (excluding endpoints) or Min eigenvalue</span>
</span><span data-line="2028">    <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span>
</span><span data-line="2029">        <span class="c1"># argmax of the interior points, then shift index by +1 to account for slicing</span>
</span><span data-line="2030">        <span class="n">saddle_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">final_z_data</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
</span><span data-line="2031">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="2032">        <span class="n">saddle_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">final_z_data</span><span class="p">)</span>
</span><span data-line="2033">
</span><span data-line="2034">    <span class="c1"># Plot the Saddle Point with a distinct style (White square)</span>
</span><span data-line="2035">    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span data-line="2036">        <span class="n">final_rmsd_r</span><span class="p">[</span><span class="n">saddle_idx</span><span class="p">],</span>
</span><span data-line="2037">        <span class="n">final_rmsd_p</span><span class="p">[</span><span class="n">saddle_idx</span><span class="p">],</span>
</span><span data-line="2038">        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
</span><span data-line="2039">        <span class="n">s</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">selected_theme</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
</span><span data-line="2040">        <span class="n">c</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span data-line="2041">        <span class="n">edgecolors</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="2042">        <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span data-line="2043">        <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span data-line="2044">        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SP&quot;</span><span class="p">,</span>
</span><span data-line="2045">    <span class="p">)</span>
</span><span data-line="2046">
</span><span data-line="2047">    <span class="c1"># --- Inset Positioning (Defined Early) ---</span>
</span><span data-line="2048">    <span class="n">image_pos_reactant</span> <span class="o">=</span> <span class="n">InsetImagePos</span><span class="p">(</span><span class="o">*</span><span class="n">draw_reactant</span><span class="p">)</span>
</span><span data-line="2049">    <span class="n">image_pos_saddle</span> <span class="o">=</span> <span class="n">InsetImagePos</span><span class="p">(</span><span class="o">*</span><span class="n">draw_saddle</span><span class="p">)</span>
</span><span data-line="2050">    <span class="n">image_pos_product</span> <span class="o">=</span> <span class="n">InsetImagePos</span><span class="p">(</span><span class="o">*</span><span class="n">draw_product</span><span class="p">)</span>
</span><span data-line="2051">
</span><span data-line="2052">    <span class="c1"># --- Plot Structures (Strip or Insets) ---</span>
</span><span data-line="2053">    <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span data-line="2054">        <span class="k">if</span> <span class="n">ax_strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2055">            <span class="c1"># --- STRIP MODE ---</span>
</span><span data-line="2056">            <span class="n">strip_payload</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="2057">
</span><span data-line="2058">            <span class="c1"># 1. Path Structures</span>
</span><span data-line="2059">            <span class="k">if</span> <span class="n">atoms_list</span><span class="p">:</span>
</span><span data-line="2060">                <span class="n">indices_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="2061">                <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span data-line="2062">                    <span class="n">indices_to_plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)))</span>
</span><span data-line="2063">                <span class="k">elif</span> <span class="n">plot_structures</span> <span class="o">==</span> <span class="s2">&quot;crit_points&quot;</span><span class="p">:</span>
</span><span data-line="2064">                    <span class="n">indices_to_plot</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span> <span class="n">saddle_idx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}))</span>
</span><span data-line="2065">
</span><span data-line="2066">                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices_to_plot</span><span class="p">:</span>
</span><span data-line="2067">                    <span class="c1"># Define labels: R, SP, P, or numeric index</span>
</span><span data-line="2068">                    <span class="n">lbl</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span data-line="2069">                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="2070">                        <span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;R&quot;</span>
</span><span data-line="2071">                    <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">saddle_idx</span><span class="p">:</span>
</span><span data-line="2072">                        <span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;SP&quot;</span>
</span><span data-line="2073">                    <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="2074">                        <span class="n">lbl</span> <span class="o">=</span> <span class="s2">&quot;P&quot;</span>
</span><span data-line="2075">
</span><span data-line="2076">                    <span class="n">strip_payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="2077">                        <span class="p">{</span>
</span><span data-line="2078">                            <span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">atoms_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span data-line="2079">                            <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">final_rmsd_r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span data-line="2080">                            <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">final_rmsd_p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span data-line="2081">                            <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">lbl</span><span class="p">,</span>
</span><span data-line="2082">                        <span class="p">}</span>
</span><span data-line="2083">                    <span class="p">)</span>
</span><span data-line="2084">
</span><span data-line="2085">            <span class="c1"># 2. Additional Structures</span>
</span><span data-line="2086">            <span class="k">if</span> <span class="n">additional_atoms_data</span><span class="p">:</span>
</span><span data-line="2087">                <span class="k">for</span> <span class="n">add_atoms</span><span class="p">,</span> <span class="n">add_r</span><span class="p">,</span> <span class="n">add_p</span><span class="p">,</span> <span class="n">add_label</span> <span class="ow">in</span> <span class="n">additional_atoms_data</span><span class="p">:</span>
</span><span data-line="2088">                    <span class="n">strip_payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="2089">                        <span class="p">{</span><span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">add_atoms</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">add_r</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">add_p</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">add_label</span><span class="p">}</span>
</span><span data-line="2090">                    <span class="p">)</span>
</span><span data-line="2091">
</span><span data-line="2092">            <span class="c1"># Render Strip</span>
</span><span data-line="2093">            <span class="k">if</span> <span class="n">strip_payload</span><span class="p">:</span>
</span><span data-line="2094">                <span class="c1"># Sort by X-coordinate so the strip order flows logically left-to-right</span>
</span><span data-line="2095">                <span class="n">strip_payload</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
</span><span data-line="2096">
</span><span data-line="2097">                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting structure strip with </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">strip_payload</span><span class="p">)</span><span class="si">}</span><span class="s2"> images.&quot;</span><span class="p">)</span>
</span><span data-line="2098">
</span><span data-line="2099">                <span class="c1"># A. Plot Equidistant Strip</span>
</span><span data-line="2100">                <span class="n">plot_structure_strip</span><span class="p">(</span>
</span><span data-line="2101">                    <span class="n">ax_strip</span><span class="p">,</span>
</span><span data-line="2102">                    <span class="n">atoms_list</span><span class="o">=</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">strip_payload</span><span class="p">],</span>
</span><span data-line="2103">                    <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">strip_payload</span><span class="p">],</span>
</span><span data-line="2104">                    <span class="n">zoom</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="2105">                    <span class="n">ase_rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="2106">                    <span class="n">theme_color</span><span class="o">=</span><span class="n">selected_theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">,</span>
</span><span data-line="2107">                <span class="p">)</span>
</span><span data-line="2108">
</span><span data-line="2109">                <span class="c1"># B. Annotate Main Plot (Link points to strip labels)</span>
</span><span data-line="2110">                <span class="n">main_plot_texts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="2111">                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">strip_payload</span><span class="p">:</span>
</span><span data-line="2112">                    <span class="c1"># Use White text with Black outline for maximum contrast against contour</span>
</span><span data-line="2113">                    <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span data-line="2114">                        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
</span><span data-line="2115">                        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
</span><span data-line="2116">                        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
</span><span data-line="2117">                        <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
</span><span data-line="2118">                        <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
</span><span data-line="2119">                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span data-line="2120">                        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span data-line="2121">                        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
</span><span data-line="2122">                        <span class="n">zorder</span><span class="o">=</span><span class="mi">102</span><span class="p">,</span>
</span><span data-line="2123">                    <span class="p">)</span>
</span><span data-line="2124">                    <span class="n">t</span><span class="o">.</span><span class="n">set_path_effects</span><span class="p">(</span>
</span><span data-line="2125">                        <span class="p">[</span><span class="n">mpl</span><span class="o">.</span><span class="n">patheffects</span><span class="o">.</span><span class="n">withStroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)]</span>
</span><span data-line="2126">                    <span class="p">)</span>
</span><span data-line="2127">                    <span class="n">main_plot_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span data-line="2128">
</span><span data-line="2129">                <span class="c1"># Prevent label overlap on the main plot</span>
</span><span data-line="2130">                <span class="k">if</span> <span class="n">adjust_text</span> <span class="ow">and</span> <span class="n">main_plot_texts</span><span class="p">:</span>
</span><span data-line="2131">                    <span class="n">adjust_text</span><span class="p">(</span>
</span><span data-line="2132">                        <span class="n">main_plot_texts</span><span class="p">,</span>
</span><span data-line="2133">                        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
</span><span data-line="2134">                        <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">arrowstyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">8.5</span><span class="p">),</span>
</span><span data-line="2135">                        <span class="n">expand_points</span><span class="o">=</span><span class="p">(</span>
</span><span data-line="2136">                            <span class="mf">1.5</span><span class="p">,</span>
</span><span data-line="2137">                            <span class="mf">1.5</span><span class="p">,</span>
</span><span data-line="2138">                        <span class="p">),</span>  <span class="c1"># Push labels slightly away from the points</span>
</span><span data-line="2139">                        <span class="n">force_text</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span data-line="2140">                    <span class="p">)</span>
</span><span data-line="2141">
</span><span data-line="2142">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2143">            <span class="c1"># --- FALLBACK INSET MODE ---</span>
</span><span data-line="2144">            <span class="k">if</span> <span class="n">atoms_list</span><span class="p">:</span>
</span><span data-line="2145">                <span class="n">plot_structure_insets</span><span class="p">(</span>
</span><span data-line="2146">                    <span class="n">ax</span><span class="p">,</span>
</span><span data-line="2147">                    <span class="n">atoms_list</span><span class="p">,</span>
</span><span data-line="2148">                    <span class="n">final_rmsd_r</span><span class="p">,</span>
</span><span data-line="2149">                    <span class="n">final_rmsd_p</span><span class="p">,</span>
</span><span data-line="2150">                    <span class="n">final_z_data</span><span class="p">,</span>
</span><span data-line="2151">                    <span class="n">plot_structures</span><span class="p">,</span>
</span><span data-line="2152">                    <span class="n">plot_mode</span><span class="p">,</span>
</span><span data-line="2153">                    <span class="n">draw_reactant</span><span class="o">=</span><span class="n">image_pos_reactant</span><span class="p">,</span>
</span><span data-line="2154">                    <span class="n">draw_saddle</span><span class="o">=</span><span class="n">image_pos_saddle</span><span class="p">,</span>
</span><span data-line="2155">                    <span class="n">draw_product</span><span class="o">=</span><span class="n">image_pos_product</span><span class="p">,</span>
</span><span data-line="2156">                    <span class="n">zoom_ratio</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="2157">                    <span class="n">ase_rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="2158">                    <span class="n">arrow_head_length</span><span class="o">=</span><span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="2159">                    <span class="n">arrow_head_width</span><span class="o">=</span><span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="2160">                    <span class="n">arrow_tail_width</span><span class="o">=</span><span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="2161">                <span class="p">)</span>
</span><span data-line="2162">
</span><span data-line="2163">            <span class="k">if</span> <span class="n">additional_atoms_data</span><span class="p">:</span>
</span><span data-line="2164">                <span class="c1"># Fallback additional atoms visualization</span>
</span><span data-line="2165">                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">add_atoms</span><span class="p">,</span> <span class="n">add_r</span><span class="p">,</span> <span class="n">add_p</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">additional_atoms_data</span><span class="p">):</span>
</span><span data-line="2166">                    <span class="n">flip</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">additional_atoms_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span>
</span><span data-line="2167">                    <span class="n">stagger_x</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">15</span>
</span><span data-line="2168">                    <span class="n">offset_x</span> <span class="o">=</span> <span class="n">image_pos_saddle</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">stagger_x</span>
</span><span data-line="2169">                    <span class="n">offset_y</span> <span class="o">=</span> <span class="n">image_pos_saddle</span><span class="o">.</span><span class="n">y</span> <span class="o">*</span> <span class="n">flip</span>
</span><span data-line="2170">                    <span class="n">current_rad</span> <span class="o">=</span> <span class="n">image_pos_saddle</span><span class="o">.</span><span class="n">rad</span> <span class="o">*</span> <span class="n">flip</span>
</span><span data-line="2171">                    <span class="n">plot_single_inset</span><span class="p">(</span>
</span><span data-line="2172">                        <span class="n">ax</span><span class="p">,</span>
</span><span data-line="2173">                        <span class="n">add_atoms</span><span class="p">,</span>
</span><span data-line="2174">                        <span class="n">add_r</span><span class="p">,</span>
</span><span data-line="2175">                        <span class="n">add_p</span><span class="p">,</span>
</span><span data-line="2176">                        <span class="n">xybox</span><span class="o">=</span><span class="p">(</span><span class="n">offset_x</span><span class="p">,</span> <span class="n">offset_y</span><span class="p">),</span>
</span><span data-line="2177">                        <span class="n">rad</span><span class="o">=</span><span class="n">current_rad</span><span class="p">,</span>
</span><span data-line="2178">                        <span class="n">zoom</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="2179">                        <span class="n">ase_rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="2180">                        <span class="n">arrow_head_length</span><span class="o">=</span><span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="2181">                        <span class="n">arrow_head_width</span><span class="o">=</span><span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="2182">                        <span class="n">arrow_tail_width</span><span class="o">=</span><span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="2183">                    <span class="p">)</span>
</span><span data-line="2184">
</span><span data-line="2185">    <span class="c1"># --- Plot Markers for Additional Structures ---</span>
</span><span data-line="2186">    <span class="k">if</span> <span class="n">additional_atoms_data</span><span class="p">:</span>
</span><span data-line="2187">        <span class="n">marker_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
</span><span data-line="2188">        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">add_r</span><span class="p">,</span> <span class="n">add_p</span><span class="p">,</span> <span class="n">add_label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">additional_atoms_data</span><span class="p">):</span>
</span><span data-line="2189">            <span class="n">color</span> <span class="o">=</span> <span class="n">marker_cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span>
</span><span data-line="2190">            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span data-line="2191">                <span class="n">add_r</span><span class="p">,</span>
</span><span data-line="2192">                <span class="n">add_p</span><span class="p">,</span>
</span><span data-line="2193">                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span data-line="2194">                <span class="n">markersize</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">selected_theme</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mf">1.2</span><span class="p">),</span>
</span><span data-line="2195">                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span data-line="2196">                <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span data-line="2197">                <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span data-line="2198">                <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span data-line="2199">                <span class="n">zorder</span><span class="o">=</span><span class="mi">98</span><span class="p">,</span>
</span><span data-line="2200">                <span class="n">label</span><span class="o">=</span><span class="n">add_label</span><span class="p">,</span>
</span><span data-line="2201">            <span class="p">)</span>
</span><span data-line="2202">
</span><span data-line="2203">    <span class="c1"># --- Legend ---</span>
</span><span data-line="2204">    <span class="c1"># Ensure legend is drawn if requested, covering SP and Additional Structures</span>
</span><span data-line="2205">    <span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
</span><span data-line="2206">        <span class="n">legend</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
</span><span data-line="2207">            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">,</span>
</span><span data-line="2208">            <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span data-line="2209">            <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="2210">            <span class="n">framealpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span data-line="2211">            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span data-line="2212">            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="2213">            <span class="n">fontsize</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">selected_theme</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">),</span>
</span><span data-line="2214">        <span class="p">)</span>
</span><span data-line="2215">        <span class="n">legend</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
</span><span data-line="2216">
</span><span data-line="2217">    <span class="k">if</span> <span class="n">ax_strip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2218">        <span class="c1"># Get position of main plot (which might have shrunk due to colorbar)</span>
</span><span data-line="2219">        <span class="n">pos_main</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
</span><span data-line="2220">        <span class="n">pos_strip</span> <span class="o">=</span> <span class="n">ax_strip</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
</span><span data-line="2221">
</span><span data-line="2222">        <span class="c1"># Force strip to match the main plot&#39;s Left and Width</span>
</span><span data-line="2223">        <span class="n">ax_strip</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span>
</span><span data-line="2224">            <span class="p">[</span><span class="n">pos_main</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">pos_strip</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">pos_main</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">pos_strip</span><span class="o">.</span><span class="n">height</span><span class="p">]</span>
</span><span data-line="2225">        <span class="p">)</span></div>

</span><span data-line="2226">
</span><span data-line="2227">
<div class="viewcode-block" id="_plot_profile">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb._plot_profile">[docs]</a>
</span><span data-line="2228"><span class="k">def</span><span class="w"> </span><span class="nf">_plot_profile</span><span class="p">(</span>
</span><span data-line="2229">    <span class="n">ax</span><span class="p">,</span>
</span><span data-line="2230">    <span class="n">ax_strip</span><span class="p">,</span>
</span><span data-line="2231">    <span class="n">fig</span><span class="p">,</span>
</span><span data-line="2232">    <span class="n">input_dat_pattern</span><span class="p">,</span>
</span><span data-line="2233">    <span class="n">atoms_list</span><span class="p">,</span>
</span><span data-line="2234">    <span class="n">additional_atoms_data</span><span class="p">,</span>
</span><span data-line="2235">    <span class="n">rc_mode</span><span class="p">,</span>
</span><span data-line="2236">    <span class="n">plot_mode</span><span class="p">,</span>
</span><span data-line="2237">    <span class="n">plot_structures</span><span class="p">,</span>
</span><span data-line="2238">    <span class="n">start</span><span class="p">,</span>
</span><span data-line="2239">    <span class="n">end</span><span class="p">,</span>
</span><span data-line="2240">    <span class="n">normalize_rc</span><span class="p">,</span>
</span><span data-line="2241">    <span class="n">highlight_last</span><span class="p">,</span>
</span><span data-line="2242">    <span class="n">selected_theme</span><span class="p">,</span>
</span><span data-line="2243">    <span class="c1"># Spline args</span>
</span><span data-line="2244">    <span class="n">spline_method</span><span class="p">,</span>
</span><span data-line="2245">    <span class="n">savgol_window</span><span class="p">,</span>
</span><span data-line="2246">    <span class="n">savgol_order</span><span class="p">,</span>
</span><span data-line="2247">    <span class="c1"># Inset args</span>
</span><span data-line="2248">    <span class="n">draw_reactant</span><span class="p">,</span>
</span><span data-line="2249">    <span class="n">draw_saddle</span><span class="p">,</span>
</span><span data-line="2250">    <span class="n">draw_product</span><span class="p">,</span>
</span><span data-line="2251">    <span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="2252">    <span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="2253">    <span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="2254">    <span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="2255">    <span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="2256">    <span class="n">cache_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="2257">    <span class="n">force_recompute</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="2258">    <span class="n">ira_kmax</span><span class="o">=</span><span class="n">IRA_KMAX_DEFAULT</span><span class="p">,</span>
</span><span data-line="2259"><span class="p">):</span>
</span><span data-line="2260"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handles all logic for drawing 1D profile plots.&quot;&quot;&quot;</span>
</span><span data-line="2261">    <span class="n">rmsd_rc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2262">    <span class="k">if</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="n">RCMode</span><span class="o">.</span><span class="n">RMSD</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">atoms_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2263">
</span><span data-line="2264">        <span class="k">def</span><span class="w"> </span><span class="nf">validate_profile_cache</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span data-line="2265">            <span class="k">if</span> <span class="s2">&quot;p&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
</span><span data-line="2266">                <span class="n">verr</span> <span class="o">=</span> <span class="s2">&quot;Cache contains &#39;p&#39; column (looks like landscape data).&quot;</span>
</span><span data-line="2267">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">verr</span><span class="p">)</span>
</span><span data-line="2268">            <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">height</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">):</span>
</span><span data-line="2269">                <span class="n">verr</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Size mismatch: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">height</span><span class="si">}</span><span class="s2"> vs </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> structures.&quot;</span>
</span><span data-line="2270">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">verr</span><span class="p">)</span>
</span><span data-line="2271">
</span><span data-line="2272">        <span class="k">def</span><span class="w"> </span><span class="nf">compute_profile_data</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span data-line="2273">            <span class="n">ira_instance</span> <span class="o">=</span> <span class="n">ira_mod</span><span class="o">.</span><span class="n">IRA</span><span class="p">()</span>
</span><span data-line="2274">            <span class="n">r_vals</span> <span class="o">=</span> <span class="n">calculate_rmsd_from_ref</span><span class="p">(</span>
</span><span data-line="2275">                <span class="n">atoms_list</span><span class="p">,</span> <span class="n">ira_instance</span><span class="p">,</span> <span class="n">ref_atom</span><span class="o">=</span><span class="n">atoms_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ira_kmax</span><span class="o">=</span><span class="n">ira_kmax</span>
</span><span data-line="2276">            <span class="p">)</span>
</span><span data-line="2277">            <span class="k">return</span> <span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="n">r_vals</span><span class="p">})</span>
</span><span data-line="2278">
</span><span data-line="2279">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="2280">            <span class="n">df_rmsd</span> <span class="o">=</span> <span class="n">_load_or_compute_data</span><span class="p">(</span>
</span><span data-line="2281">                <span class="n">cache_file</span><span class="o">=</span><span class="n">cache_file</span><span class="p">,</span>
</span><span data-line="2282">                <span class="n">force_recompute</span><span class="o">=</span><span class="n">force_recompute</span><span class="p">,</span>
</span><span data-line="2283">                <span class="n">validation_check</span><span class="o">=</span><span class="n">validate_profile_cache</span><span class="p">,</span>
</span><span data-line="2284">                <span class="n">computation_callback</span><span class="o">=</span><span class="n">compute_profile_data</span><span class="p">,</span>
</span><span data-line="2285">                <span class="n">context_name</span><span class="o">=</span><span class="s2">&quot;Profile RMSD&quot;</span><span class="p">,</span>
</span><span data-line="2286">            <span class="p">)</span>
</span><span data-line="2287">            <span class="n">rmsd_rc</span> <span class="o">=</span> <span class="n">df_rmsd</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="2288">            <span class="n">normalize_rc</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="2289">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="2290">            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not secure RMSD data: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="2291">            <span class="c1"># Fallback or exit depending on strictness; here we proceed without RMSD</span>
</span><span data-line="2292">            <span class="n">rmsd_rc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="2293">
</span><span data-line="2294">    <span class="n">all_file_paths</span> <span class="o">=</span> <span class="n">load_paths</span><span class="p">(</span><span class="n">input_dat_pattern</span><span class="p">)</span>
</span><span data-line="2295">    <span class="n">file_paths_to_plot</span> <span class="o">=</span> <span class="n">all_file_paths</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span><span data-line="2296">    <span class="n">num_files</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths_to_plot</span><span class="p">)</span>
</span><span data-line="2297">    <span class="k">if</span> <span class="n">num_files</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="2298">        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The specified start/end range resulted in zero files. Exiting.&quot;</span><span class="p">)</span>
</span><span data-line="2299">        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="2300">
</span><span data-line="2301">    <span class="k">try</span><span class="p">:</span>
</span><span data-line="2302">        <span class="n">colormap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">selected_theme</span><span class="o">.</span><span class="n">cmap_profile</span><span class="p">)</span>
</span><span data-line="2303">    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span data-line="2304">        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="2305">            <span class="sa">f</span><span class="s2">&quot;Colormap &#39;</span><span class="si">{</span><span class="n">selected_theme</span><span class="o">.</span><span class="n">cmap_profile</span><span class="si">}</span><span class="s2">&#39; not in registry.&quot;</span>
</span><span data-line="2306">            <span class="s2">&quot; Falling back to &#39;batlow&#39;.&quot;</span>
</span><span data-line="2307">        <span class="p">)</span>
</span><span data-line="2308">        <span class="n">colormap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;cmc.batlow&quot;</span><span class="p">)</span>
</span><span data-line="2309">
</span><span data-line="2310">    <span class="n">color_divisor</span> <span class="o">=</span> <span class="p">(</span><span class="n">num_files</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">num_files</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">1.0</span>
</span><span data-line="2311">
</span><span data-line="2312">    <span class="c1"># Hermite spline requires dE/dx. The files contain dE/ds (force w.r.t path).</span>
</span><span data-line="2313">    <span class="c1"># If x is RMSD or Index, dE/dx != dE/ds, so Hermite construction fails.</span>
</span><span data-line="2314">    <span class="k">if</span> <span class="n">rc_mode</span> <span class="ow">in</span> <span class="p">[</span><span class="n">RCMode</span><span class="o">.</span><span class="n">RMSD</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">RCMode</span><span class="o">.</span><span class="n">INDEX</span><span class="o">.</span><span class="n">value</span><span class="p">]:</span>
</span><span data-line="2315">        <span class="k">if</span> <span class="n">spline_method</span> <span class="o">==</span> <span class="n">SplineMethod</span><span class="o">.</span><span class="n">HERMITE</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span data-line="2316">            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="2317">                <span class="sa">f</span><span class="s2">&quot;Hermite spline invalid for rc-mode=&#39;</span><span class="si">{</span><span class="n">rc_mode</span><span class="si">}</span><span class="s2">&#39; &quot;</span>
</span><span data-line="2318">                <span class="s2">&quot;(forces are w.r.t path length). Switching to standard cubic spline.&quot;</span>
</span><span data-line="2319">            <span class="p">)</span>
</span><span data-line="2320">            <span class="n">spline_method</span> <span class="o">=</span> <span class="n">SplineMethod</span><span class="o">.</span><span class="n">SPLINE</span><span class="o">.</span><span class="n">value</span>
</span><span data-line="2321">
</span><span data-line="2322">    <span class="n">smoothing_params</span> <span class="o">=</span> <span class="n">SmoothingParams</span><span class="p">(</span>
</span><span data-line="2323">        <span class="n">window_length</span><span class="o">=</span><span class="n">savgol_window</span><span class="p">,</span> <span class="n">polyorder</span><span class="o">=</span><span class="n">savgol_order</span>
</span><span data-line="2324">    <span class="p">)</span>
</span><span data-line="2325">
</span><span data-line="2326">    <span class="n">plot_function</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="2327">        <span class="k">lambda</span> <span class="n">ax</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">plot_energy_path</span><span class="p">(</span>
</span><span data-line="2328">            <span class="n">ax</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">spline_method</span><span class="p">,</span> <span class="n">smoothing</span><span class="o">=</span><span class="n">smoothing_params</span>
</span><span data-line="2329">        <span class="p">)</span>
</span><span data-line="2330">        <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="n">PlotMode</span><span class="o">.</span><span class="n">ENERGY</span><span class="o">.</span><span class="n">value</span>
</span><span data-line="2331">        <span class="k">else</span> <span class="k">lambda</span> <span class="n">ax</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">plot_eigenvalue_path</span><span class="p">(</span>
</span><span data-line="2332">            <span class="n">ax</span><span class="p">,</span> <span class="n">pd</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">grid_color</span><span class="o">=</span><span class="n">selected_theme</span><span class="o">.</span><span class="n">gridcolor</span>
</span><span data-line="2333">        <span class="p">)</span>
</span><span data-line="2334">    <span class="p">)</span>
</span><span data-line="2335">    <span class="n">y_data_column</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="n">PlotMode</span><span class="o">.</span><span class="n">ENERGY</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="mi">4</span>
</span><span data-line="2336">
</span><span data-line="2337">    <span class="n">image_pos_reactant</span> <span class="o">=</span> <span class="n">InsetImagePos</span><span class="p">(</span><span class="o">*</span><span class="n">draw_reactant</span><span class="p">)</span>
</span><span data-line="2338">    <span class="n">image_pos_saddle</span> <span class="o">=</span> <span class="n">InsetImagePos</span><span class="p">(</span><span class="o">*</span><span class="n">draw_saddle</span><span class="p">)</span>
</span><span data-line="2339">    <span class="n">image_pos_product</span> <span class="o">=</span> <span class="n">InsetImagePos</span><span class="p">(</span><span class="o">*</span><span class="n">draw_product</span><span class="p">)</span>
</span><span data-line="2340">
</span><span data-line="2341">    <span class="c1"># --- Plotting Loop ---</span>
</span><span data-line="2342">    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths_to_plot</span><span class="p">):</span>
</span><span data-line="2343">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="2344">            <span class="n">path_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span data-line="2345">        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="2346">            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span data-line="2347">                <span class="sa">f</span><span class="s2">&quot;Skipping invalid or empty file [yellow]</span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">[/yellow]: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="2348">            <span class="p">)</span>
</span><span data-line="2349">            <span class="k">continue</span>
</span><span data-line="2350">
</span><span data-line="2351">        <span class="k">if</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="n">RCMode</span><span class="o">.</span><span class="n">RMSD</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">rmsd_rc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="2352">            <span class="c1"># Check dimensions first</span>
</span><span data-line="2353">            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmsd_rc</span><span class="p">)</span> <span class="o">!=</span> <span class="n">path_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span data-line="2354">                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="n">file_path</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Dimension mismatch.&quot;</span><span class="p">)</span>
</span><span data-line="2355">                <span class="k">continue</span>
</span><span data-line="2356">            <span class="n">path_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmsd_rc</span>
</span><span data-line="2357">
</span><span data-line="2358">        <span class="k">elif</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="n">RCMode</span><span class="o">.</span><span class="n">INDEX</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span data-line="2359">            <span class="c1"># Replace X with integer indices: 0, 1, 2...</span>
</span><span data-line="2360">            <span class="n">num_images</span> <span class="o">=</span> <span class="n">path_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="2361">            <span class="n">path_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_images</span><span class="p">)</span>
</span><span data-line="2362">
</span><span data-line="2363">        <span class="k">elif</span> <span class="n">normalize_rc</span> <span class="ow">and</span> <span class="n">rc_mode</span> <span class="o">!=</span> <span class="n">RCMode</span><span class="o">.</span><span class="n">INDEX</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span data-line="2364">            <span class="n">rc</span> <span class="o">=</span> <span class="n">path_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="2365">            <span class="k">if</span> <span class="n">rc</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="2366">                <span class="n">path_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rc</span> <span class="o">/</span> <span class="n">rc</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span data-line="2367">
</span><span data-line="2368">        <span class="n">rc_for_insets</span> <span class="o">=</span> <span class="n">path_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="2369">        <span class="n">y_for_insets</span> <span class="o">=</span> <span class="n">path_data</span><span class="p">[</span><span class="n">y_data_column</span><span class="p">]</span>
</span><span data-line="2370">
</span><span data-line="2371">        <span class="n">is_last_file</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">num_files</span> <span class="o">-</span> <span class="mi">1</span>
</span><span data-line="2372">        <span class="n">is_first_file</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span>
</span><span data-line="2373">
</span><span data-line="2374">        <span class="k">if</span> <span class="n">highlight_last</span> <span class="ow">and</span> <span class="n">is_last_file</span><span class="p">:</span>
</span><span data-line="2375">            <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="n">selected_theme</span><span class="o">.</span><span class="n">highlight_color</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">20</span>
</span><span data-line="2376">            <span class="n">plot_function</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="p">)</span>
</span><span data-line="2377">
</span><span data-line="2378">            <span class="k">if</span> <span class="n">atoms_list</span> <span class="ow">and</span> <span class="n">plot_structures</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span data-line="2379">                <span class="c1"># Determine which indices to plot</span>
</span><span data-line="2380">                <span class="n">indices_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="2381">                <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span data-line="2382">                    <span class="n">indices_to_plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)))</span>
</span><span data-line="2383">                <span class="k">elif</span> <span class="n">plot_structures</span> <span class="o">==</span> <span class="s2">&quot;crit_points&quot;</span><span class="p">:</span>
</span><span data-line="2384">                    <span class="c1"># Simple heuristic for critical points based on Energy</span>
</span><span data-line="2385">                    <span class="n">e_vals</span> <span class="o">=</span> <span class="n">y_for_insets</span>
</span><span data-line="2386">                    <span class="n">saddle_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">e_vals</span><span class="p">)</span>
</span><span data-line="2387">                    <span class="n">indices_to_plot</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">({</span><span class="mi">0</span><span class="p">,</span> <span class="n">saddle_idx</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">}))</span>
</span><span data-line="2388">                <span class="c1"># Fallback to old Inset method (if ax_strip failed for some reason)</span>
</span><span data-line="2389">                <span class="n">plot_structure_insets</span><span class="p">(</span>
</span><span data-line="2390">                    <span class="n">ax</span><span class="p">,</span>
</span><span data-line="2391">                    <span class="n">atoms_list</span><span class="p">,</span>
</span><span data-line="2392">                    <span class="n">rc_for_insets</span><span class="p">,</span>
</span><span data-line="2393">                    <span class="n">y_for_insets</span><span class="p">,</span>
</span><span data-line="2394">                    <span class="n">y_for_insets</span><span class="p">,</span>
</span><span data-line="2395">                    <span class="n">plot_structures</span><span class="p">,</span>
</span><span data-line="2396">                    <span class="n">plot_mode</span><span class="p">,</span>
</span><span data-line="2397">                    <span class="n">draw_reactant</span><span class="o">=</span><span class="n">image_pos_reactant</span><span class="p">,</span>
</span><span data-line="2398">                    <span class="n">draw_saddle</span><span class="o">=</span><span class="n">image_pos_saddle</span><span class="p">,</span>
</span><span data-line="2399">                    <span class="n">draw_product</span><span class="o">=</span><span class="n">image_pos_product</span><span class="p">,</span>
</span><span data-line="2400">                    <span class="n">zoom_ratio</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="2401">                    <span class="n">ase_rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="2402">                    <span class="n">arrow_head_length</span><span class="o">=</span><span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="2403">                    <span class="n">arrow_head_width</span><span class="o">=</span><span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="2404">                    <span class="n">arrow_tail_width</span><span class="o">=</span><span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="2405">                <span class="p">)</span>
</span><span data-line="2406">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="2407">            <span class="n">color</span> <span class="o">=</span> <span class="n">colormap</span><span class="p">(</span><span class="n">idx</span> <span class="o">/</span> <span class="n">color_divisor</span><span class="p">)</span>
</span><span data-line="2408">            <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">is_first_file</span> <span class="k">else</span> <span class="mf">0.5</span>
</span><span data-line="2409">            <span class="n">zorder</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">is_first_file</span> <span class="k">else</span> <span class="mi">5</span>
</span><span data-line="2410">            <span class="n">plot_function</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">path_data</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="p">)</span>
</span><span data-line="2411">
</span><span data-line="2412">    <span class="c1"># --- Add Colorbar ---</span>
</span><span data-line="2413">    <span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span>
</span><span data-line="2414">        <span class="n">cmap</span><span class="o">=</span><span class="n">colormap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_files</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span><span data-line="2415">    <span class="p">)</span>
</span><span data-line="2416">    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Optimization Step&quot;</span><span class="p">)</span>
</span><span data-line="2417">    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_tick_params</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">selected_theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">)</span>
</span><span data-line="2418">    <span class="n">cbar</span><span class="o">.</span><span class="n">outline</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="n">selected_theme</span><span class="o">.</span><span class="n">edgecolor</span><span class="p">)</span>
</span><span data-line="2419">    <span class="k">if</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="n">RCMode</span><span class="o">.</span><span class="n">INDEX</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span data-line="2420">        <span class="c1"># Force a major tick for every single image</span>
</span><span data-line="2421">        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_images</span><span class="p">))</span>
</span><span data-line="2422">        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="2423">
</span><span data-line="2424">    <span class="c1"># --- Add Additional Structure ---</span>
</span><span data-line="2425">    <span class="k">if</span> <span class="n">additional_atoms_data</span> <span class="ow">and</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="n">RCMode</span><span class="o">.</span><span class="n">RMSD</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span data-line="2426">        <span class="n">additional_atoms</span><span class="p">,</span> <span class="n">add_rmsd_r</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">additional_atoms_data</span>
</span><span data-line="2427">        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Highlighting additional structure at RMSD_R = </span><span class="si">{</span><span class="n">add_rmsd_r</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>
</span><span data-line="2428">        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
</span><span data-line="2429">            <span class="n">add_rmsd_r</span><span class="p">,</span>
</span><span data-line="2430">            <span class="n">color</span><span class="o">=</span><span class="n">selected_theme</span><span class="o">.</span><span class="n">gridcolor</span><span class="p">,</span>
</span><span data-line="2431">            <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span>
</span><span data-line="2432">            <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span data-line="2433">            <span class="n">zorder</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
</span><span data-line="2434">        <span class="p">)</span>
</span><span data-line="2435">        <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span data-line="2436">            <span class="n">y_span</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="2437">            <span class="n">y_pos</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">y_span</span>
</span><span data-line="2438">            <span class="n">plot_single_inset</span><span class="p">(</span>
</span><span data-line="2439">                <span class="n">ax</span><span class="p">,</span>
</span><span data-line="2440">                <span class="n">additional_atoms</span><span class="p">,</span>
</span><span data-line="2441">                <span class="n">add_rmsd_r</span><span class="p">,</span>
</span><span data-line="2442">                <span class="n">y_pos</span><span class="p">,</span>
</span><span data-line="2443">                <span class="n">xybox</span><span class="o">=</span><span class="p">(</span><span class="n">image_pos_saddle</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">image_pos_saddle</span><span class="o">.</span><span class="n">y</span><span class="p">),</span>
</span><span data-line="2444">                <span class="n">rad</span><span class="o">=</span><span class="n">image_pos_saddle</span><span class="o">.</span><span class="n">rad</span><span class="p">,</span>
</span><span data-line="2445">                <span class="n">zoom</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="2446">                <span class="n">ase_rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="2447">                <span class="n">arrow_head_length</span><span class="o">=</span><span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="2448">                <span class="n">arrow_head_width</span><span class="o">=</span><span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="2449">                <span class="n">arrow_tail_width</span><span class="o">=</span><span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="2450">            <span class="p">)</span></div>

</span><span data-line="2451">
</span><span data-line="2452">
</span><span data-line="2453"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span data-line="2454">    <span class="n">main</span><span class="p">()</span>
</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div
      style="
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        color: var(--sy-c-text-weak);
        font-size: 0.9em;
      "
    >
      <div
        style="
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 1rem;
          align-items: center;
        "
      >
        
        <span style="display: inline-flex; align-items: center; gap: 0.3em">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="1em"
            height="1em"
            viewBox="0 0 24 24"
            fill="currentColor"
            aria-hidden="true"
          >
            <path
              d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96z"
            ></path>
          </svg>
          <span
            >Hosted by
            <a
              href="https://www.netlify.com/"
              target="_blank"
              rel="noopener noreferrer"
              style="color: inherit; text-decoration: underline"
              >Netlify</a
            ></span
          >
        </span>

        
        <span style="display: inline-flex; align-items: center; gap: 0.3em">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="1em"
            height="1em"
            viewBox="0 0 24 24"
            fill="currentColor"
            aria-hidden="true"
          >
            <path d="M7,20H4V4h3V20z M14,20h-3V12h3V20z M21,20h-3V8h3V20z" />
          </svg>
          <span
            >Analytics by
            <a
              href="https://plausible.io/"
              target="_blank"
              rel="noopener noreferrer"
              style="color: inherit; text-decoration: underline"
              >Plausible</a
            ></span
          >
        </span>

        
        <span style="display: inline-flex; align-items: center; gap: 0.3em">
          <span>provided by</span>
          <span style="display: inline-flex; align-items: center; gap: 0.3em">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="1.2em"
              height="1.2em"
              viewBox="0 0 64 64"
              aria-hidden="true"
            >
              <g fill-rule="evenodd">
                <ellipse cx="32" cy="11" fill="#80D25B" rx="7" ry="9" />
                <path
                  fill="#80D25B"
                  d="M20.302104,46 C20.302104,46 17.1330329,55.8812548 20.6828149,59.7817355 C24.232597,63.6822162 26.8008673,63.215359 26.8008673,53.7414927 C26.8008673,44.2676263 20.302104,46 20.302104,46 Z"
                />
                <path
                  fill="#80D25B"
                  d="M38.302104,46 C38.302104,46 35.1330329,55.8812548 38.6828149,59.7817355 C42.232597,63.6822162 44.8008673,63.215359 44.8008673,53.7414927 C44.8008673,44.2676263 38.302104,46 38.302104,46 Z"
                  transform="matrix(-1 0 0 1 81.8 0)"
                />
                <path
                  fill="#80D25B"
                  d="M20.6227767,21.2218684 C20.6227767,21.2218684 13.956214,15.3844007 10.091955,16.0534044 C6.22769598,16.722408 6,22.2124633 6,23.9992899 C6,25.7861165 7.78917398,37.3159836 9.78726488,36.4967476 C11.7853558,35.6775115 13.7411938,27.959322 13.7411938,27.959322 15.6510232,30.2287702 18.609193,30.4630388"
                />
                <path
                  fill="#80D25B"
                  d="M57.6227767,21.2218684 C57.6227767,21.2218684 50.956214,15.3844007 47.091955,16.0534044 C43.227696,16.722408 43,22.2124633 43,23.9992899 C43,25.7861165 44.789174,37.3159836 46.7872649,36.4967476 C48.7853558,35.6775115 50.7411938,27.959322 50.7411938,27.959322 52.6510232,30.2287702 55.609193,30.4630388"
                  transform="matrix(-1 0 0 1 100.623 0)"
                />
                <path
                  fill="#BD7575"
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M32,53 C40.836556,53 48,44.4934102 48,34 C48,23.5065898 46.6814044,17 32,17 C17.3185956,17 16,23.5065898 16,34 C16,44.4934102 23.163444,53 32,53 Z"
                />
                <polygon
                  fill="#BD7575"
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  points="32 22 38.928 26 38.928 34 32 38 25.072 34 25.072 26"
                />
                <path
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M30,8 C28.8954305,8 28,8.8954305 28,10"
                />
                <path
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M36,8 C34.8954305,8 34,8.8954305 34,10"
                  transform="matrix(-1 0 0 1 70 0)"
                />
                <path
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M32.1194396 38.1881507L32.1194396 52.4125899M32.0164956 21.7467197L32.0164956 17M25.2141026 26.0041506L17.737148 23.0721126M25.1254173 34.1534318L16.7659494 38.8876521"
                />
                <path
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M46.2141026,26.0041506 L38.737148,23.0721126"
                  transform="matrix(-1 0 0 1 84.951 0)"
                />
                <path
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M47.1254173,34.1534318 L38.7659494,38.8876521"
                  transform="matrix(-1 0 0 1 85.891 0)"
                />
              </g>
            </svg>
            <a
              href="https://turtletech.us/"
              target="_blank"
              rel="noopener noreferrer"
              style="color: inherit; text-decoration: underline"
              >TurtleTech ehf</a
            >
          </span>
        </span>
      </div>
    </div>

    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Rohit Goswami</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div> <div class="sy-foot-socials">
<a href="https://github.com/Haozeke/rgpycrumbs" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../../../_static/shibuya.js?v=cac61aee"></script></body>
</html>