<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>rgpycrumbs.eon.plt_neb - rgpycrumbs documentation</title><link rel="index" title="Index" href="../../../genindex.html" /><link rel="search" title="Search" href="../../../search.html" />
      <link rel="canonical" href="rgpycrumbs.rgoswami.me/_modules/rgpycrumbs/eon/plt_neb.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../../../_static/shibuya.css?v=a318c5d4" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../../../_static/autodoc_pydantic.css" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
  <meta property="og:url" content="rgpycrumbs.rgoswami.me/_modules/rgpycrumbs/eon/plt_neb.html"/>
  <meta property="og:title" content="rgpycrumbs.eon.plt_neb"/>
    <meta name="twitter:card" content="summary"/>
  <!-- Manual favicon handling with favicon.io -->
<!-- since sphinx-favicon doesn't work with shibuya -->
<link rel="icon" type="image/png" sizes="16x16" href="../../../_static/favicons/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../../_static/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="192x192" href="../../../_static/favicons/android-chrome-192x192.png">
<link rel="icon" type="image/png" sizes="512x512" href="../../../_static/favicons/android-chrome-512x512.png">
<link rel="apple-touch-icon" sizes="180x180" href="../../../_static/favicons/apple-touch-icon.png">
<link rel="shortcut icon" href="../../../_static/favicons/favicon.ico">
<link rel="manifest" href="../../../_static/favicons/site.webmanifest">
<!-- Plausible injection -->
<script
  defer
  data-domain="rgpycrumbs.rgoswami.me"
  src="https://analytics.turtletech.us/js/script.hash.outbound-links.js"
></script>
<script>
  window.plausible =
    window.plausible ||
    function () {
      (window.plausible.q = window.plausible.q || []).push(arguments);
    };
</script></head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../../index.html">
      <img class="light-logo" src="../../../_static/pycrumbs_notext.svg" alt="rgpycrumbs" height="28" loading="lazy" />
      <img class="dark-logo" src="../../../_static/pycrumbs_notext.svg" alt="rgpycrumbs" height="28" loading="lazy" />
      <strong>rgpycrumbs</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/Haozeke/rgpycrumbs" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6">
        <div class="globaltoc" data-expand-depth="0"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Tools</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/eon/index.html">eOn Helpers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/eon/con_splitter.html">Splitting <code class="docutils literal notranslate"><span class="pre">con</span></code> files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/eon/generate_nwchem_input.html">Generators for NWChem</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/eon/mlflow.html">MLFlow Logging for eOn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/eon/plt_neb.html">Plotting NEB paths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/eon/ptmdisp.html">Polyhedral Template Matcher</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/orca/index.html">ORCA Tools</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/orca/generate_orca_input.html">ORCA Input Generator</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/geom/index.html">Geometry Helpers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/geom/alignment.html">Robust Structural Alignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/geom/detect_fragments.html">Fragment Detection</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/surfaces.html">Surface Fitting with Kernel Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/utils/index.html">General Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/utils/jupyter.html">Jupyter Notebook Helpers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../tools/prefix/index.html">Prefix Helpers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../tools/prefix/delete_packages.html">Prefix Channel Package Deletion</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../used_by.html">Used By</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../devnotes.html"><code class="docutils literal notranslate"><span class="pre">rgpycrumbs</span></code> Design &amp; Architecture Notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing/index.html">Contributing to <code class="docutils literal notranslate"><span class="pre">rgpycrumbs</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/doc_builds.html">Documentation Standards &amp; Authoring</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/test_requirements.html">Testing &amp; Environment Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../code_of_conduct.html">Code of Conduct</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../contributing/release.html">Release Management</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../autoapi/index.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/helpers/index.html">helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/rgpycrumbs/index.html">rgpycrumbs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/_aux/index.html">rgpycrumbs._aux</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/basetypes/index.html">rgpycrumbs.basetypes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/cli/index.html">rgpycrumbs.cli</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/index.html">rgpycrumbs.eon</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/_mlflow/index.html">rgpycrumbs.eon._mlflow</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/con_splitter/index.html">rgpycrumbs.eon.con_splitter</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/generate_nwchem_input/index.html">rgpycrumbs.eon.generate_nwchem_input</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/helpers/index.html">rgpycrumbs.eon.helpers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html">rgpycrumbs.eon.plt_neb</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/ptmdisp/index.html">rgpycrumbs.eon.ptmdisp</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/eon/to_mlflow/index.html">rgpycrumbs.eon.to_mlflow</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/func/index.html">rgpycrumbs.func</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/func/muller_brown/index.html">rgpycrumbs.func.muller_brown</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/geom/index.html">rgpycrumbs.geom</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/geom/analysis/index.html">rgpycrumbs.geom.analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/geom/api/index.html">rgpycrumbs.geom.api</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/geom/detect_fragments/index.html">rgpycrumbs.geom.detect_fragments</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/geom/ira/index.html">rgpycrumbs.geom.ira</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/interpolation/index.html">rgpycrumbs.interpolation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/parsers/index.html">rgpycrumbs.parsers</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/parsers/bless/index.html">rgpycrumbs.parsers.bless</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/parsers/common/index.html">rgpycrumbs.parsers.common</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/plumed/index.html">rgpycrumbs.plumed</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/plumed/direct_reconstruction/index.html">rgpycrumbs.plumed.direct_reconstruction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/prefix/index.html">rgpycrumbs.prefix</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/prefix/delete_packages/index.html">rgpycrumbs.prefix.delete_packages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/run/index.html">rgpycrumbs.run</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/run/jupyter/index.html">rgpycrumbs.run.jupyter</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/surfaces/index.html">rgpycrumbs.surfaces</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/surfaces/_base/index.html">rgpycrumbs.surfaces._base</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/surfaces/_kernels/index.html">rgpycrumbs.surfaces._kernels</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/surfaces/gradient/index.html">rgpycrumbs.surfaces.gradient</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/surfaces/standard/index.html">rgpycrumbs.surfaces.standard</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../../autoapi/rgpycrumbs/xts/index.html">rgpycrumbs.xts</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/xts/cuh2/index.html">rgpycrumbs.xts.cuh2</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../../autoapi/rgpycrumbs/xts/saddle/index.html">rgpycrumbs.xts.saddle</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../autoapi/generate_orca_input/index.html">generate_orca_input</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../index.html"><span itemprop="name">rgpycrumbs</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../rgpycrumbs.html"><span itemprop="name">rgpycrumbs</span></a>
        <span>/</span>
        <meta itemprop="position" content="3" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">rgpycrumbs.eon.plt_neb</strong>
        <meta itemprop="position" content="4" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <article class="yue" role="main">
          <h1>Source code for rgpycrumbs.eon.plt_neb</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="ch">#!/usr/bin/env python3</span>
</span><span data-line="2"><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="3"><span class="sd">Plots Nudged Elastic Band (NEB) reaction paths and landscapes.</span>
</span><span data-line="4">
</span><span data-line="5"><span class="sd">This script provides a command-line interface (CLI) to visualize data</span>
</span><span data-line="6"><span class="sd">generated from NEB calculations. It can plot:</span>
</span><span data-line="7">
</span><span data-line="8"><span class="sd">1.  **Energy/Eigenvalue Profiles:** Shows the evolution of the energy or</span>
</span><span data-line="9"><span class="sd">    lowest eigenvalue along the reaction coordinate. It can overlay multiple</span>
</span><span data-line="10"><span class="sd">    paths (e.g., from different optimization steps) and use a</span>
</span><span data-line="11"><span class="sd">    physically-motivated Hermite spline interpolation using force data.</span>
</span><span data-line="12">
</span><span data-line="13"><span class="sd">2.  **2D Reaction Landscapes:** Plots the path on a 2D coordinate system</span>
</span><span data-line="14"><span class="sd">    defined by the Root Mean Square Deviation (RMSD) from the reactant</span>
</span><span data-line="15"><span class="sd">    and product structures. This requires the &#39;ira_mod&#39; library.</span>
</span><span data-line="16"><span class="sd">    It can also interpolate and display the 2D energy/eigenvalue surface.</span>
</span><span data-line="17">
</span><span data-line="18"><span class="sd">The script can also render atomic structures from a .con file as insets</span>
</span><span data-line="19"><span class="sd">on the plots for key points (reactant, saddle, product).</span>
</span><span data-line="20">
</span><span data-line="21"><span class="sd">This script follows the guidelines laid out here:</span>
</span><span data-line="22"><span class="sd">https://realpython.com/python-script-structure/</span>
</span><span data-line="23"><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="24">
</span><span data-line="25"><span class="c1"># /// script</span>
</span><span data-line="26"><span class="c1"># requires-python = &quot;&gt;=3.11&quot;</span>
</span><span data-line="27"><span class="c1"># dependencies = [</span>
</span><span data-line="28"><span class="c1">#   &quot;click&quot;,</span>
</span><span data-line="29"><span class="c1">#   &quot;matplotlib&quot;,</span>
</span><span data-line="30"><span class="c1">#   &quot;numpy&quot;,</span>
</span><span data-line="31"><span class="c1">#   &quot;scipy&quot;,</span>
</span><span data-line="32"><span class="c1">#   &quot;jax&quot;,</span>
</span><span data-line="33"><span class="c1">#   &quot;adjustText&quot;,</span>
</span><span data-line="34"><span class="c1">#   &quot;cmcrameri&quot;,</span>
</span><span data-line="35"><span class="c1">#   &quot;rich&quot;,</span>
</span><span data-line="36"><span class="c1">#   &quot;ase&quot;,</span>
</span><span data-line="37"><span class="c1">#   &quot;polars&quot;,</span>
</span><span data-line="38"><span class="c1">#   &quot;chemparseplot&quot;,</span>
</span><span data-line="39"><span class="c1">#   &quot;rgpycrumbs&quot;,</span>
</span><span data-line="40"><span class="c1"># ]</span>
</span><span data-line="41"><span class="c1"># ///</span>
</span><span data-line="42">
</span><span data-line="43"><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span data-line="44"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span data-line="45"><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
</span><span data-line="46">
</span><span data-line="47"><span class="kn">import</span><span class="w"> </span><span class="nn">click</span>
</span><span data-line="48"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
</span><span data-line="49"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patheffects</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">path_effects</span>
</span><span data-line="50"><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</span><span data-line="51"><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
</span><span data-line="52"><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
</span><span data-line="53"><span class="kn">from</span><span class="w"> </span><span class="nn">adjustText</span><span class="w"> </span><span class="kn">import</span> <span class="n">adjust_text</span>
</span><span data-line="54"><span class="kn">from</span><span class="w"> </span><span class="nn">chemparseplot.parse.eon.neb</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="55">    <span class="n">aggregate_neb_landscape_data</span><span class="p">,</span>
</span><span data-line="56">    <span class="n">compute_profile_rmsd</span><span class="p">,</span>
</span><span data-line="57">    <span class="n">estimate_rbf_smoothing</span><span class="p">,</span>
</span><span data-line="58">    <span class="n">load_structures_and_calculate_additional_rmsd</span><span class="p">,</span>
</span><span data-line="59"><span class="p">)</span>
</span><span data-line="60">
</span><span data-line="61"><span class="c1"># --- Library Imports ---</span>
</span><span data-line="62"><span class="kn">from</span><span class="w"> </span><span class="nn">chemparseplot.parse.file_</span><span class="w"> </span><span class="kn">import</span> <span class="n">find_file_paths</span>
</span><span data-line="63"><span class="kn">from</span><span class="w"> </span><span class="nn">chemparseplot.plot.neb</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="64">    <span class="n">plot_energy_path</span><span class="p">,</span>
</span><span data-line="65">    <span class="n">plot_landscape_path_overlay</span><span class="p">,</span>
</span><span data-line="66">    <span class="n">plot_landscape_surface</span><span class="p">,</span>
</span><span data-line="67">    <span class="n">plot_structure_inset</span><span class="p">,</span>
</span><span data-line="68">    <span class="n">plot_structure_strip</span><span class="p">,</span>
</span><span data-line="69"><span class="p">)</span>
</span><span data-line="70"><span class="kn">from</span><span class="w"> </span><span class="nn">chemparseplot.plot.theme</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="71">    <span class="n">apply_axis_theme</span><span class="p">,</span>
</span><span data-line="72">    <span class="n">get_theme</span><span class="p">,</span>
</span><span data-line="73">    <span class="n">setup_global_theme</span><span class="p">,</span>
</span><span data-line="74"><span class="p">)</span>
</span><span data-line="75"><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.gridspec</span><span class="w"> </span><span class="kn">import</span> <span class="n">GridSpec</span>
</span><span data-line="76"><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">ArrowStyle</span>
</span><span data-line="77"><span class="kn">from</span><span class="w"> </span><span class="nn">rich.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">RichHandler</span>
</span><span data-line="78">
</span><span data-line="79"><span class="c1"># --- Logging Setup ---</span>
</span><span data-line="80"><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
</span><span data-line="81">    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
</span><span data-line="82">    <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%(levelname)s</span><span class="s2"> - </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span data-line="83">    <span class="n">handlers</span><span class="o">=</span><span class="p">[</span><span class="n">RichHandler</span><span class="p">(</span><span class="n">rich_tracebacks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_path</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">markup</span><span class="o">=</span><span class="kc">True</span><span class="p">)],</span>
</span><span data-line="84"><span class="p">)</span>
<div class="viewcode-block" id="log">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.log">[docs]</a>
</span><span data-line="85"><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;rich&quot;</span><span class="p">)</span></div>

</span><span data-line="86">
</span><span data-line="87">
</span><span data-line="88"><span class="c1"># --- Constants ---</span>
<div class="viewcode-block" id="DEFAULT_INPUT_PATTERN">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.DEFAULT_INPUT_PATTERN">[docs]</a>
</span><span data-line="89"><span class="n">DEFAULT_INPUT_PATTERN</span> <span class="o">=</span> <span class="s2">&quot;neb_*.dat&quot;</span></div>

<div class="viewcode-block" id="DEFAULT_PATH_PATTERN">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.DEFAULT_PATH_PATTERN">[docs]</a>
</span><span data-line="90"><span class="n">DEFAULT_PATH_PATTERN</span> <span class="o">=</span> <span class="s2">&quot;neb_path_*.con&quot;</span></div>

<div class="viewcode-block" id="IRA_KMAX_DEFAULT">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.IRA_KMAX_DEFAULT">[docs]</a>
</span><span data-line="91"><span class="n">IRA_KMAX_DEFAULT</span> <span class="o">=</span> <span class="mf">1.8</span></div>

</span><span data-line="92">
</span><span data-line="93">
</span><span data-line="94"><span class="c1"># --- CLI ---</span>
</span><span data-line="95"><span class="nd">@click</span><span class="o">.</span><span class="n">command</span><span class="p">()</span>
</span><span data-line="96"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="97">    <span class="s2">&quot;--input-dat-pattern&quot;</span><span class="p">,</span>
</span><span data-line="98">    <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_INPUT_PATTERN</span><span class="p">,</span>
</span><span data-line="99">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Glob pattern for input data files.&quot;</span><span class="p">,</span>
</span><span data-line="100"><span class="p">)</span>
</span><span data-line="101"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="102">    <span class="s2">&quot;--input-path-pattern&quot;</span><span class="p">,</span>
</span><span data-line="103">    <span class="n">default</span><span class="o">=</span><span class="n">DEFAULT_PATH_PATTERN</span><span class="p">,</span>
</span><span data-line="104">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Glob pattern for input path files.&quot;</span><span class="p">,</span>
</span><span data-line="105"><span class="p">)</span>
</span><span data-line="106"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="107">    <span class="s2">&quot;--con-file&quot;</span><span class="p">,</span>
</span><span data-line="108">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
</span><span data-line="109">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="110">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to .con trajectory file.&quot;</span><span class="p">,</span>
</span><span data-line="111"><span class="p">)</span>
</span><span data-line="112"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="113">    <span class="s2">&quot;--additional-con&quot;</span><span class="p">,</span>
</span><span data-line="114">    <span class="nb">type</span><span class="o">=</span><span class="p">(</span>
</span><span data-line="115">        <span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
</span><span data-line="116">        <span class="nb">str</span><span class="p">,</span>
</span><span data-line="117">    <span class="p">),</span>  <span class="c1"># Takes (Path, Label)</span>
</span><span data-line="118">    <span class="n">multiple</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="119">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="120">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path(s) to additional .con file(s) and label.&quot;</span><span class="p">,</span>
</span><span data-line="121"><span class="p">)</span>
</span><span data-line="122"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="123">    <span class="s2">&quot;--augment-dat&quot;</span><span class="p">,</span>
</span><span data-line="124">    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span data-line="125">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="126">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Glob pattern for extra .dat files for surface fitting.&quot;</span><span class="p">,</span>
</span><span data-line="127"><span class="p">)</span>
</span><span data-line="128"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="129">    <span class="s2">&quot;--augment-con&quot;</span><span class="p">,</span>
</span><span data-line="130">    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span data-line="131">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="132">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Glob pattern for extra .con files for surface fitting.&quot;</span><span class="p">,</span>
</span><span data-line="133"><span class="p">)</span>
</span><span data-line="134"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="135">    <span class="s2">&quot;--sp-file&quot;</span><span class="p">,</span>
</span><span data-line="136">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">exists</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dir_okay</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
</span><span data-line="137">    <span class="n">default</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;sp.con&quot;</span><span class="p">),</span>
</span><span data-line="138">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Path to explicit saddle point file (eOn sp.con).&quot;</span><span class="p">,</span>
</span><span data-line="139"><span class="p">)</span>
</span><span data-line="140"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="141">    <span class="s2">&quot;--plot-type&quot;</span><span class="p">,</span>
</span><span data-line="142">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;profile&quot;</span><span class="p">,</span> <span class="s2">&quot;landscape&quot;</span><span class="p">]),</span>
</span><span data-line="143">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;profile&quot;</span><span class="p">,</span>
</span><span data-line="144">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Type of plot to generate.&quot;</span><span class="p">,</span>
</span><span data-line="145"><span class="p">)</span>
</span><span data-line="146"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="147">    <span class="s2">&quot;--rbf-smoothing&quot;</span><span class="p">,</span>
</span><span data-line="148">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="149">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="150">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="151">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Smoothing term for 2D RBF.&quot;</span><span class="p">,</span>
</span><span data-line="152"><span class="p">)</span>
</span><span data-line="153"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="154">    <span class="s2">&quot;--landscape-mode&quot;</span><span class="p">,</span>
</span><span data-line="155">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;surface&quot;</span><span class="p">]),</span>
</span><span data-line="156">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;surface&quot;</span><span class="p">,</span>
</span><span data-line="157">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;For landscape plot: &#39;path&#39; or &#39;surface&#39;.&quot;</span><span class="p">,</span>
</span><span data-line="158"><span class="p">)</span>
</span><span data-line="159"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="160">    <span class="s2">&quot;--landscape-path&quot;</span><span class="p">,</span>
</span><span data-line="161">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;last&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">]),</span>
</span><span data-line="162">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
</span><span data-line="163">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Last uses an interpolation only on the last path, otherwise use all points.&quot;</span><span class="p">,</span>
</span><span data-line="164"><span class="p">)</span>
</span><span data-line="165"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="166">    <span class="s2">&quot;--project-path/--no-project-path&quot;</span><span class="p">,</span>
</span><span data-line="167">    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="168">    <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="169">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Project landscape coordinates into the reaction valley (s, d).&quot;</span><span class="p">,</span>
</span><span data-line="170"><span class="p">)</span>
</span><span data-line="171"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="172">    <span class="s2">&quot;--rc-mode&quot;</span><span class="p">,</span>
</span><span data-line="173">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;path&quot;</span><span class="p">,</span> <span class="s2">&quot;rmsd&quot;</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">]),</span>
</span><span data-line="174">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;path&quot;</span><span class="p">,</span>
</span><span data-line="175">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Reaction coordinate for profile plot.&quot;</span><span class="p">,</span>
</span><span data-line="176"><span class="p">)</span>
</span><span data-line="177"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="178">    <span class="s2">&quot;--plot-structures&quot;</span><span class="p">,</span>
</span><span data-line="179">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;crit_points&quot;</span><span class="p">]),</span>
</span><span data-line="180">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
</span><span data-line="181">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Structures to render on the path. Requires --con-file.&quot;</span><span class="p">,</span>
</span><span data-line="182"><span class="p">)</span>
</span><span data-line="183"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="184">    <span class="s2">&quot;--surface-type&quot;</span><span class="p">,</span>
</span><span data-line="185">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">(</span>
</span><span data-line="186">        <span class="p">[</span>
</span><span data-line="187">            <span class="s2">&quot;grid&quot;</span><span class="p">,</span>
</span><span data-line="188">            <span class="s2">&quot;rbf&quot;</span><span class="p">,</span>
</span><span data-line="189">            <span class="s2">&quot;grad_matern&quot;</span><span class="p">,</span>
</span><span data-line="190">            <span class="s2">&quot;grad_imq&quot;</span><span class="p">,</span>
</span><span data-line="191">            <span class="s2">&quot;grad_imq_ny&quot;</span><span class="p">,</span>
</span><span data-line="192">            <span class="s2">&quot;matern&quot;</span><span class="p">,</span>
</span><span data-line="193">            <span class="s2">&quot;imq&quot;</span><span class="p">,</span>
</span><span data-line="194">            <span class="s2">&quot;grad_rq&quot;</span><span class="p">,</span>
</span><span data-line="195">            <span class="s2">&quot;grad_se&quot;</span><span class="p">,</span>
</span><span data-line="196">        <span class="p">]</span>
</span><span data-line="197">    <span class="p">),</span>
</span><span data-line="198">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;rbf&quot;</span><span class="p">,</span>
</span><span data-line="199">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Interpolation method for the 2D surface.&quot;</span><span class="p">,</span>
</span><span data-line="200"><span class="p">)</span>
</span><span data-line="201"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="202">    <span class="s2">&quot;--show-pts/--no-show-pts&quot;</span><span class="p">,</span>
</span><span data-line="203">    <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="204">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show all paths from the optimization on the RMSD 2D plot.&quot;</span><span class="p">,</span>
</span><span data-line="205"><span class="p">)</span>
</span><span data-line="206"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="207">    <span class="s2">&quot;--plot-mode&quot;</span><span class="p">,</span>
</span><span data-line="208">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span> <span class="s2">&quot;eigenvalue&quot;</span><span class="p">]),</span>
</span><span data-line="209">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;energy&quot;</span><span class="p">,</span>
</span><span data-line="210">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Quantity to plot.&quot;</span><span class="p">,</span>
</span><span data-line="211"><span class="p">)</span>
</span><span data-line="212"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="213">    <span class="s2">&quot;-o&quot;</span><span class="p">,</span>
</span><span data-line="214">    <span class="s2">&quot;--output-file&quot;</span><span class="p">,</span>
</span><span data-line="215">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
</span><span data-line="216">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="217">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Output image filename.&quot;</span><span class="p">,</span>
</span><span data-line="218"><span class="p">)</span>
</span><span data-line="219"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="220">    <span class="s2">&quot;--start&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Start file index for profile plot.&quot;</span>
</span><span data-line="221"><span class="p">)</span>
</span><span data-line="222"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--end&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;End file index for profile plot.&quot;</span><span class="p">)</span>
</span><span data-line="223"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="224">    <span class="s2">&quot;--normalize-rc&quot;</span><span class="p">,</span> <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Normalize reaction coordinate.&quot;</span>
</span><span data-line="225"><span class="p">)</span>
</span><span data-line="226"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--title&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;NEB Path&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Plot title.&quot;</span><span class="p">)</span>
</span><span data-line="227"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--xlabel&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;X-axis label.&quot;</span><span class="p">)</span>
</span><span data-line="228"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--ylabel&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Y-axis label.&quot;</span><span class="p">)</span>
</span><span data-line="229"><span class="c1"># --- Theme and Override Options ---</span>
</span><span data-line="230"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="231">    <span class="s2">&quot;--theme&quot;</span><span class="p">,</span>
</span><span data-line="232">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;ruhi&quot;</span><span class="p">,</span>
</span><span data-line="233">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;The plotting theme to use.&quot;</span><span class="p">,</span>
</span><span data-line="234"><span class="p">)</span>
</span><span data-line="235"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--cmap-profile&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Colormap for profile plot.&quot;</span><span class="p">)</span>
</span><span data-line="236"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--cmap-landscape&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Colormap for landscape plot.&quot;</span><span class="p">)</span>
</span><span data-line="237"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--facecolor&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Background color.&quot;</span><span class="p">)</span>
</span><span data-line="238"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;--fontsize-base&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Base font size.&quot;</span><span class="p">)</span>
</span><span data-line="239"><span class="c1"># --- Figure and Inset Options ---</span>
</span><span data-line="240"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="241">    <span class="s2">&quot;--figsize&quot;</span><span class="p">,</span>
</span><span data-line="242">    <span class="n">nargs</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span data-line="243">    <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span><span data-line="244">    <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mf">5.37</span><span class="p">,</span> <span class="mf">5.37</span><span class="p">),</span>
</span><span data-line="245">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="246">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Figure width, height in inches.&quot;</span><span class="p">,</span>
</span><span data-line="247"><span class="p">)</span>
</span><span data-line="248"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="249">    <span class="s2">&quot;--fig-height&quot;</span><span class="p">,</span>
</span><span data-line="250">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="251">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="252">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Figure height in inches.&quot;</span><span class="p">,</span>
</span><span data-line="253"><span class="p">)</span>
</span><span data-line="254"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="255">    <span class="s2">&quot;--aspect-ratio&quot;</span><span class="p">,</span>
</span><span data-line="256">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="257">    <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span data-line="258">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Figure aspect ratio.&quot;</span><span class="p">,</span>
</span><span data-line="259"><span class="p">)</span>
</span><span data-line="260"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="261">    <span class="s2">&quot;--dpi&quot;</span><span class="p">,</span>
</span><span data-line="262">    <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
</span><span data-line="263">    <span class="n">default</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
</span><span data-line="264">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="265">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Resolution in Dots Per Inch.&quot;</span><span class="p">,</span>
</span><span data-line="266"><span class="p">)</span>
</span><span data-line="267"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="268">    <span class="s2">&quot;--zoom-ratio&quot;</span><span class="p">,</span>
</span><span data-line="269">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="270">    <span class="n">default</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
</span><span data-line="271">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="272">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Scale the inset image.&quot;</span><span class="p">,</span>
</span><span data-line="273"><span class="p">)</span>
</span><span data-line="274"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="275">    <span class="s2">&quot;--ase-rotation&quot;</span><span class="p">,</span>
</span><span data-line="276">    <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
</span><span data-line="277">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;0x, 90y, 0z&quot;</span><span class="p">,</span>
</span><span data-line="278">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="279">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;ASE rotation string.&quot;</span><span class="p">,</span>
</span><span data-line="280"><span class="p">)</span>
</span><span data-line="281"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="282">    <span class="s2">&quot;--arrow-head-length&quot;</span><span class="p">,</span>
</span><span data-line="283">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="284">    <span class="n">default</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span data-line="285">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="286">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Arrow head length.&quot;</span><span class="p">,</span>
</span><span data-line="287"><span class="p">)</span>
</span><span data-line="288"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="289">    <span class="s2">&quot;--arrow-head-width&quot;</span><span class="p">,</span>
</span><span data-line="290">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="291">    <span class="n">default</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span data-line="292">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="293">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Arrow head width.&quot;</span><span class="p">,</span>
</span><span data-line="294"><span class="p">)</span>
</span><span data-line="295"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="296">    <span class="s2">&quot;--arrow-tail-width&quot;</span><span class="p">,</span>
</span><span data-line="297">    <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
</span><span data-line="298">    <span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
</span><span data-line="299">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="300">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Arrow tail width.&quot;</span><span class="p">,</span>
</span><span data-line="301"><span class="p">)</span>
</span><span data-line="302"><span class="c1"># --- Path/Spline Options ---</span>
</span><span data-line="303"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="304">    <span class="s2">&quot;--highlight-last/--no-highlight-last&quot;</span><span class="p">,</span>
</span><span data-line="305">    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="306">    <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="307">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Highlight last path.&quot;</span><span class="p">,</span>
</span><span data-line="308"><span class="p">)</span>
</span><span data-line="309"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="310">    <span class="s2">&quot;--spline-method&quot;</span><span class="p">,</span>
</span><span data-line="311">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Choice</span><span class="p">([</span><span class="s2">&quot;hermite&quot;</span><span class="p">,</span> <span class="s2">&quot;spline&quot;</span><span class="p">]),</span>
</span><span data-line="312">    <span class="n">default</span><span class="o">=</span><span class="s2">&quot;hermite&quot;</span><span class="p">,</span>
</span><span data-line="313">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Spline interpolation method.&quot;</span><span class="p">,</span>
</span><span data-line="314"><span class="p">)</span>
</span><span data-line="315"><span class="c1"># --- Inset Position Options ---</span>
</span><span data-line="316"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="317">    <span class="s2">&quot;--draw-reactant&quot;</span><span class="p">,</span>
</span><span data-line="318">    <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span><span data-line="319">    <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="320">    <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
</span><span data-line="321">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="322">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Reactant inset pos (x, y, rad).&quot;</span><span class="p">,</span>
</span><span data-line="323"><span class="p">)</span>
</span><span data-line="324"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="325">    <span class="s2">&quot;--draw-saddle&quot;</span><span class="p">,</span>
</span><span data-line="326">    <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span><span data-line="327">    <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="328">    <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
</span><span data-line="329">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="330">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Saddle inset pos (x, y, rad).&quot;</span><span class="p">,</span>
</span><span data-line="331"><span class="p">)</span>
</span><span data-line="332"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="333">    <span class="s2">&quot;--draw-product&quot;</span><span class="p">,</span>
</span><span data-line="334">    <span class="nb">type</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
</span><span data-line="335">    <span class="n">nargs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
</span><span data-line="336">    <span class="n">default</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">),</span>
</span><span data-line="337">    <span class="n">show_default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="338">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Product inset pos (x, y, rad).&quot;</span><span class="p">,</span>
</span><span data-line="339"><span class="p">)</span>
</span><span data-line="340"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="341">    <span class="s2">&quot;--cache-file&quot;</span><span class="p">,</span>
</span><span data-line="342">    <span class="nb">type</span><span class="o">=</span><span class="n">click</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">path_type</span><span class="o">=</span><span class="n">Path</span><span class="p">),</span>
</span><span data-line="343">    <span class="n">default</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.neb_landscape.parquet&quot;</span><span class="p">),</span>
</span><span data-line="344">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Parquet cache file.&quot;</span><span class="p">,</span>
</span><span data-line="345"><span class="p">)</span>
</span><span data-line="346"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="347">    <span class="s2">&quot;--force-recompute&quot;</span><span class="p">,</span>
</span><span data-line="348">    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="349">    <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="350">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Force re-calculation of RMSD.&quot;</span><span class="p">,</span>
</span><span data-line="351"><span class="p">)</span>
</span><span data-line="352"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
</span><span data-line="353">    <span class="s2">&quot;--show-legend&quot;</span><span class="p">,</span>
</span><span data-line="354">    <span class="n">is_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="355">    <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span data-line="356">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Show the legends.&quot;</span><span class="p">,</span>
</span><span data-line="357"><span class="p">)</span>
</span><span data-line="358"><span class="nd">@click</span><span class="o">.</span><span class="n">option</span><span class="p">(</span>
<div class="viewcode-block" id="main">
<a class="viewcode-back" href="../../../autoapi/rgpycrumbs/eon/plt_neb/index.html#rgpycrumbs.eon.plt_neb.main">[docs]</a>
</span><span data-line="359">    <span class="s2">&quot;--ira-kmax&quot;</span><span class="p">,</span>
</span><span data-line="360">    <span class="n">default</span><span class="o">=</span><span class="n">IRA_KMAX_DEFAULT</span><span class="p">,</span>
</span><span data-line="361">    <span class="n">help</span><span class="o">=</span><span class="s2">&quot;kmax factor for IRA.&quot;</span><span class="p">,</span>
</span><span data-line="362"><span class="p">)</span>
</span><span data-line="363"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span>
</span><span data-line="364">    <span class="c1"># --- Input Files ---</span>
</span><span data-line="365">    <span class="n">input_dat_pattern</span><span class="p">,</span>
</span><span data-line="366">    <span class="n">input_path_pattern</span><span class="p">,</span>
</span><span data-line="367">    <span class="n">con_file</span><span class="p">,</span>
</span><span data-line="368">    <span class="n">additional_con</span><span class="p">,</span>
</span><span data-line="369">    <span class="c1"># --- Plot Behavior ---</span>
</span><span data-line="370">    <span class="n">plot_type</span><span class="p">,</span>
</span><span data-line="371">    <span class="n">landscape_mode</span><span class="p">,</span>
</span><span data-line="372">    <span class="n">landscape_path</span><span class="p">,</span>
</span><span data-line="373">    <span class="n">project_path</span><span class="p">,</span>
</span><span data-line="374">    <span class="n">rc_mode</span><span class="p">,</span>
</span><span data-line="375">    <span class="n">plot_structures</span><span class="p">,</span>
</span><span data-line="376">    <span class="n">rbf_smoothing</span><span class="p">,</span>
</span><span data-line="377">    <span class="n">show_pts</span><span class="p">,</span>
</span><span data-line="378">    <span class="n">plot_mode</span><span class="p">,</span>
</span><span data-line="379">    <span class="n">surface_type</span><span class="p">,</span>
</span><span data-line="380">    <span class="c1"># --- Output &amp; Slicing ---</span>
</span><span data-line="381">    <span class="n">output_file</span><span class="p">,</span>
</span><span data-line="382">    <span class="n">start</span><span class="p">,</span>
</span><span data-line="383">    <span class="n">end</span><span class="p">,</span>
</span><span data-line="384">    <span class="c1"># --- Plot Aesthetics ---</span>
</span><span data-line="385">    <span class="n">normalize_rc</span><span class="p">,</span>
</span><span data-line="386">    <span class="n">title</span><span class="p">,</span>
</span><span data-line="387">    <span class="n">xlabel</span><span class="p">,</span>
</span><span data-line="388">    <span class="n">ylabel</span><span class="p">,</span>
</span><span data-line="389">    <span class="n">highlight_last</span><span class="p">,</span>
</span><span data-line="390">    <span class="c1"># --- Theme ---</span>
</span><span data-line="391">    <span class="n">theme</span><span class="p">,</span>
</span><span data-line="392">    <span class="n">cmap_profile</span><span class="p">,</span>
</span><span data-line="393">    <span class="n">cmap_landscape</span><span class="p">,</span>
</span><span data-line="394">    <span class="n">facecolor</span><span class="p">,</span>
</span><span data-line="395">    <span class="n">fontsize_base</span><span class="p">,</span>
</span><span data-line="396">    <span class="c1"># --- Figure &amp; Inset ---</span>
</span><span data-line="397">    <span class="n">figsize</span><span class="p">,</span>
</span><span data-line="398">    <span class="n">fig_height</span><span class="p">,</span>
</span><span data-line="399">    <span class="n">aspect_ratio</span><span class="p">,</span>
</span><span data-line="400">    <span class="n">dpi</span><span class="p">,</span>
</span><span data-line="401">    <span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="402">    <span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="403">    <span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="404">    <span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="405">    <span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="406">    <span class="c1"># --- Spline ---</span>
</span><span data-line="407">    <span class="n">spline_method</span><span class="p">,</span>
</span><span data-line="408">    <span class="c1"># --- Inset Positions ---</span>
</span><span data-line="409">    <span class="n">draw_reactant</span><span class="p">,</span>
</span><span data-line="410">    <span class="n">draw_saddle</span><span class="p">,</span>
</span><span data-line="411">    <span class="n">draw_product</span><span class="p">,</span>
</span><span data-line="412">    <span class="n">show_legend</span><span class="p">,</span>
</span><span data-line="413">    <span class="c1"># Caching</span>
</span><span data-line="414">    <span class="n">cache_file</span><span class="p">,</span>
</span><span data-line="415">    <span class="n">force_recompute</span><span class="p">,</span>
</span><span data-line="416">    <span class="n">ira_kmax</span><span class="p">,</span>
</span><span data-line="417">    <span class="n">sp_file</span><span class="p">,</span>
</span><span data-line="418">    <span class="n">augment_dat</span><span class="p">,</span>
</span><span data-line="419">    <span class="n">augment_con</span><span class="p">,</span>
</span><span data-line="420"><span class="p">):</span>
</span><span data-line="421"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Main entry point for NEB plot script.&quot;&quot;&quot;</span>
</span><span data-line="422">
</span><span data-line="423">    <span class="c1"># 1. Setup Theme</span>
</span><span data-line="424">    <span class="n">active_theme</span> <span class="o">=</span> <span class="n">get_theme</span><span class="p">(</span>
</span><span data-line="425">        <span class="n">theme</span><span class="p">,</span>
</span><span data-line="426">        <span class="n">cmap_profile</span><span class="o">=</span><span class="n">cmap_profile</span><span class="p">,</span>
</span><span data-line="427">        <span class="n">cmap_landscape</span><span class="o">=</span><span class="n">cmap_landscape</span><span class="p">,</span>
</span><span data-line="428">        <span class="n">font_size</span><span class="o">=</span><span class="n">fontsize_base</span><span class="p">,</span>
</span><span data-line="429">        <span class="n">facecolor</span><span class="o">=</span><span class="n">facecolor</span><span class="p">,</span>
</span><span data-line="430">    <span class="p">)</span>
</span><span data-line="431">    <span class="n">setup_global_theme</span><span class="p">(</span><span class="n">active_theme</span><span class="p">)</span>
</span><span data-line="432">
</span><span data-line="433">    <span class="k">if</span> <span class="n">fig_height</span> <span class="ow">and</span> <span class="n">aspect_ratio</span><span class="p">:</span>
</span><span data-line="434">        <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">fig_height</span> <span class="o">*</span> <span class="n">aspect_ratio</span><span class="p">,</span> <span class="n">fig_height</span><span class="p">)</span>
</span><span data-line="435">    <span class="k">elif</span> <span class="n">fig_height</span> <span class="ow">or</span> <span class="n">aspect_ratio</span><span class="p">:</span>
</span><span data-line="436">        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span data-line="437">            <span class="s2">&quot;Both --fig-height and --aspect-ratio must be provided together. Using default figsize.&quot;</span>
</span><span data-line="438">        <span class="p">)</span>
</span><span data-line="439">
</span><span data-line="440">    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
</span><span data-line="441">
</span><span data-line="442">    <span class="c1"># Layout Logic</span>
</span><span data-line="443">    <span class="n">has_strip</span> <span class="o">=</span> <span class="n">plot_structures</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;all&quot;</span><span class="p">,</span> <span class="s2">&quot;crit_points&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;landscape&quot;</span>
</span><span data-line="444">
</span><span data-line="445">    <span class="k">if</span> <span class="n">has_strip</span><span class="p">:</span>
</span><span data-line="446">        <span class="c1"># Heuristic layout adjustment</span>
</span><span data-line="447">        <span class="n">n_expected</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">==</span> <span class="s2">&quot;crit_points&quot;</span> <span class="k">else</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span>
</span><span data-line="448">            <span class="n">additional_con</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="449">        <span class="p">)</span>
</span><span data-line="450">        <span class="n">max_cols</span> <span class="o">=</span> <span class="mi">6</span>
</span><span data-line="451">        <span class="n">n_rows</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_expected</span> <span class="o">+</span> <span class="n">max_cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="n">max_cols</span>
</span><span data-line="452">        <span class="n">calc_hspace</span> <span class="o">=</span> <span class="mf">0.8</span> <span class="k">if</span> <span class="n">n_rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.3</span>
</span><span data-line="453">
</span><span data-line="454">        <span class="n">gs</span> <span class="o">=</span> <span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span> <span class="n">hspace</span><span class="o">=</span><span class="n">calc_hspace</span><span class="p">,</span> <span class="n">figure</span><span class="o">=</span><span class="n">fig</span><span class="p">)</span>
</span><span data-line="455">        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span data-line="456">        <span class="n">ax_strip</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span data-line="457">        <span class="n">apply_axis_theme</span><span class="p">(</span><span class="n">ax_strip</span><span class="p">,</span> <span class="n">active_theme</span><span class="p">)</span>
</span><span data-line="458">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="459">        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
</span><span data-line="460">        <span class="n">ax_strip</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="461">
</span><span data-line="462">    <span class="n">apply_axis_theme</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">active_theme</span><span class="p">)</span>
</span><span data-line="463">
</span><span data-line="464">    <span class="n">atoms_list</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="465">    <span class="n">additional_atoms_data</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="466">    <span class="n">sp_data</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="467">
</span><span data-line="468">    <span class="c1"># Only attempt to load structures if specifically requested or needed for the plot type</span>
</span><span data-line="469">    <span class="k">if</span> <span class="n">con_file</span><span class="p">:</span>
</span><span data-line="470">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="471">            <span class="n">atoms_list</span><span class="p">,</span> <span class="n">additional_atoms_data</span><span class="p">,</span> <span class="n">sp_data</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="472">                <span class="n">load_structures_and_calculate_additional_rmsd</span><span class="p">(</span>
</span><span data-line="473">                    <span class="n">con_file</span><span class="p">,</span> <span class="n">additional_con</span><span class="p">,</span> <span class="n">ira_kmax</span><span class="p">,</span> <span class="n">sp_file</span>
</span><span data-line="474">                <span class="p">)</span>
</span><span data-line="475">            <span class="p">)</span>
</span><span data-line="476">        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span data-line="477">            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading structures: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="478">            <span class="c1"># Critical failure for landscape/RMSD modes</span>
</span><span data-line="479">            <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;landscape&quot;</span> <span class="ow">or</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="s2">&quot;rmsd&quot;</span><span class="p">:</span>
</span><span data-line="480">                <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Cannot proceed without structures. Exiting.&quot;</span><span class="p">)</span>
</span><span data-line="481">                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="482">
</span><span data-line="483">    <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;landscape&quot;</span><span class="p">:</span>
</span><span data-line="484">        <span class="c1"># --- Landscape Plot ---</span>
</span><span data-line="485">        <span class="n">dat_paths</span> <span class="o">=</span> <span class="n">find_file_paths</span><span class="p">(</span><span class="n">input_dat_pattern</span><span class="p">)</span>
</span><span data-line="486">        <span class="n">con_paths</span> <span class="o">=</span> <span class="n">find_file_paths</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">input_path_pattern</span><span class="p">))</span>
</span><span data-line="487">
</span><span data-line="488">        <span class="k">if</span> <span class="ow">not</span> <span class="n">dat_paths</span><span class="p">:</span>
</span><span data-line="489">            <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No data files found for pattern: </span><span class="si">{</span><span class="n">input_dat_pattern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="490">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="491">
</span><span data-line="492">        <span class="c1"># Fallback if no path files found but main file exists</span>
</span><span data-line="493">        <span class="k">if</span> <span class="ow">not</span> <span class="n">con_paths</span> <span class="ow">and</span> <span class="n">con_file</span><span class="p">:</span>
</span><span data-line="494">            <span class="n">con_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">con_file</span><span class="p">]</span>
</span><span data-line="495">
</span><span data-line="496">        <span class="n">y_col</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="s2">&quot;energy&quot;</span> <span class="k">else</span> <span class="mi">4</span>
</span><span data-line="497">        <span class="n">z_label</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="498">            <span class="s2">&quot;Relative Energy (eV)&quot;</span>
</span><span data-line="499">            <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="s2">&quot;energy&quot;</span>
</span><span data-line="500">            <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;Lowest Eigenvalue (eV/$\AA^2$)&quot;</span>
</span><span data-line="501">        <span class="p">)</span>
</span><span data-line="502">
</span><span data-line="503">        <span class="n">df</span> <span class="o">=</span> <span class="n">aggregate_neb_landscape_data</span><span class="p">(</span>
</span><span data-line="504">            <span class="n">dat_paths</span><span class="p">,</span>
</span><span data-line="505">            <span class="n">con_paths</span><span class="p">,</span>
</span><span data-line="506">            <span class="n">y_col</span><span class="p">,</span>
</span><span data-line="507">            <span class="kc">None</span><span class="p">,</span>
</span><span data-line="508">            <span class="n">cache_file</span><span class="p">,</span>
</span><span data-line="509">            <span class="n">force_recompute</span><span class="p">,</span>
</span><span data-line="510">            <span class="n">ira_kmax</span><span class="p">,</span>
</span><span data-line="511">            <span class="n">augment_dat</span><span class="o">=</span><span class="n">augment_dat</span><span class="p">,</span>
</span><span data-line="512">            <span class="n">augment_con</span><span class="o">=</span><span class="n">augment_con</span><span class="p">,</span>
</span><span data-line="513">            <span class="n">ref_atoms</span><span class="o">=</span><span class="n">atoms_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">atoms_list</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># main reactant</span>
</span><span data-line="514">            <span class="n">prod_atoms</span><span class="o">=</span><span class="n">atoms_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">atoms_list</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># main product</span>
</span><span data-line="515">        <span class="p">)</span>
</span><span data-line="516">
</span><span data-line="517">        <span class="c1"># Surface Generation</span>
</span><span data-line="518">        <span class="k">if</span> <span class="n">landscape_mode</span> <span class="o">==</span> <span class="s2">&quot;surface&quot;</span><span class="p">:</span>
</span><span data-line="519">            <span class="k">if</span> <span class="n">landscape_path</span> <span class="o">==</span> <span class="s2">&quot;last&quot;</span><span class="p">:</span>
</span><span data-line="520">                <span class="n">max_step</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span data-line="521">                <span class="n">df_surface</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_step</span><span class="p">)</span>
</span><span data-line="522">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="523">                <span class="n">df_surface</span> <span class="o">=</span> <span class="n">df</span>
</span><span data-line="524">
</span><span data-line="525">            <span class="c1"># Prepare arrays</span>
</span><span data-line="526">            <span class="n">r_all</span> <span class="o">=</span> <span class="n">df_surface</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="527">            <span class="n">p_all</span> <span class="o">=</span> <span class="n">df_surface</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="528">            <span class="n">z_all</span> <span class="o">=</span> <span class="n">df_surface</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="529">            <span class="n">gr_all</span> <span class="o">=</span> <span class="n">df_surface</span><span class="p">[</span><span class="s2">&quot;grad_r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="530">            <span class="n">gp_all</span> <span class="o">=</span> <span class="n">df_surface</span><span class="p">[</span><span class="s2">&quot;grad_p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="531">            <span class="n">step_all</span> <span class="o">=</span> <span class="n">df_surface</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="532">
</span><span data-line="533">            <span class="c1"># Heuristic for RBF smoothing if missing</span>
</span><span data-line="534">            <span class="k">if</span> <span class="n">rbf_smoothing</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="535">                <span class="n">rbf_smoothing</span> <span class="o">=</span> <span class="n">estimate_rbf_smoothing</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</span><span data-line="536">                <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Calculated heuristic RBF smoothing: </span><span class="si">{</span><span class="n">rbf_smoothing</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="537">
</span><span data-line="538">            <span class="n">extra_pts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="539">            <span class="k">if</span> <span class="n">sp_data</span><span class="p">:</span>
</span><span data-line="540">                <span class="n">extra_pts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">sp_data</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">],</span> <span class="n">sp_data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]])</span>
</span><span data-line="541">            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">add_r</span><span class="p">,</span> <span class="n">add_p</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">additional_atoms_data</span><span class="p">:</span>
</span><span data-line="542">                <span class="n">extra_pts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">add_r</span><span class="p">,</span> <span class="n">add_p</span><span class="p">])</span>
</span><span data-line="543">            <span class="n">extra_pts_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">extra_pts</span><span class="p">)</span> <span class="k">if</span> <span class="n">extra_pts</span> <span class="k">else</span> <span class="kc">None</span>
</span><span data-line="544">            <span class="n">plot_landscape_surface</span><span class="p">(</span>
</span><span data-line="545">                <span class="n">ax</span><span class="p">,</span>
</span><span data-line="546">                <span class="n">r_all</span><span class="p">,</span>
</span><span data-line="547">                <span class="n">p_all</span><span class="p">,</span>
</span><span data-line="548">                <span class="n">gr_all</span><span class="p">,</span>
</span><span data-line="549">                <span class="n">gp_all</span><span class="p">,</span>
</span><span data-line="550">                <span class="n">z_all</span><span class="p">,</span>
</span><span data-line="551">                <span class="n">step_data</span><span class="o">=</span><span class="n">step_all</span><span class="p">,</span>
</span><span data-line="552">                <span class="n">method</span><span class="o">=</span><span class="n">surface_type</span><span class="p">,</span>
</span><span data-line="553">                <span class="n">rbf_smooth</span><span class="o">=</span><span class="n">rbf_smoothing</span><span class="p">,</span>
</span><span data-line="554">                <span class="n">cmap</span><span class="o">=</span><span class="n">active_theme</span><span class="o">.</span><span class="n">cmap_landscape</span><span class="p">,</span>
</span><span data-line="555">                <span class="n">show_pts</span><span class="o">=</span><span class="n">show_pts</span><span class="p">,</span>
</span><span data-line="556">                <span class="c1"># so we always show 5% and 95%, this is the user defined additional one</span>
</span><span data-line="557">                <span class="c1"># TODO(rg): just be a user parameter..</span>
</span><span data-line="558">                <span class="n">variance_threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>  <span class="c1"># 50% uncertainty</span>
</span><span data-line="559">                <span class="n">project_path</span><span class="o">=</span><span class="n">project_path</span><span class="p">,</span>
</span><span data-line="560">                <span class="n">extra_points</span><span class="o">=</span><span class="n">extra_pts_arr</span><span class="p">,</span>
</span><span data-line="561">            <span class="p">)</span>
</span><span data-line="562">
</span><span data-line="563">        <span class="c1"># Path Overlay (Final Step)</span>
</span><span data-line="564">        <span class="n">max_step</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;step&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span data-line="565">        <span class="n">df_final</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">col</span><span class="p">(</span><span class="s2">&quot;step&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="n">max_step</span><span class="p">)</span>
</span><span data-line="566">        <span class="n">final_r</span> <span class="o">=</span> <span class="n">df_final</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="567">        <span class="n">final_p</span> <span class="o">=</span> <span class="n">df_final</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="568">        <span class="n">final_z</span> <span class="o">=</span> <span class="n">df_final</span><span class="p">[</span><span class="s2">&quot;z&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="569">
</span><span data-line="570">        <span class="n">plot_landscape_path_overlay</span><span class="p">(</span>
</span><span data-line="571">            <span class="n">ax</span><span class="p">,</span>
</span><span data-line="572">            <span class="n">final_r</span><span class="p">,</span>
</span><span data-line="573">            <span class="n">final_p</span><span class="p">,</span>
</span><span data-line="574">            <span class="n">final_z</span><span class="p">,</span>
</span><span data-line="575">            <span class="n">active_theme</span><span class="o">.</span><span class="n">cmap_landscape</span><span class="p">,</span>
</span><span data-line="576">            <span class="n">z_label</span><span class="p">,</span>
</span><span data-line="577">            <span class="n">project_path</span><span class="o">=</span><span class="n">project_path</span><span class="p">,</span>
</span><span data-line="578">        <span class="p">)</span>
</span><span data-line="579">
</span><span data-line="580">        <span class="c1"># Saddle Point Marker</span>
</span><span data-line="581">        <span class="k">if</span> <span class="n">sp_data</span><span class="p">:</span>
</span><span data-line="582">            <span class="c1"># Use explicit SP coordinates</span>
</span><span data-line="583">            <span class="n">sp_x_raw</span><span class="p">,</span> <span class="n">sp_y_raw</span> <span class="o">=</span> <span class="n">sp_data</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">],</span> <span class="n">sp_data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span>
</span><span data-line="584">            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plotting explicit SP at R=</span><span class="si">{</span><span class="n">sp_x_raw</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">, P=</span><span class="si">{</span><span class="n">sp_y_raw</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="585">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="586">            <span class="c1"># Fallback to heuristic</span>
</span><span data-line="587">            <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="s2">&quot;energy&quot;</span><span class="p">:</span>
</span><span data-line="588">                <span class="n">saddle_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">final_z</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
</span><span data-line="589">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="590">                <span class="n">saddle_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">final_z</span><span class="p">)</span>
</span><span data-line="591">            <span class="n">sp_x_raw</span><span class="p">,</span> <span class="n">sp_y_raw</span> <span class="o">=</span> <span class="n">final_r</span><span class="p">[</span><span class="n">saddle_idx</span><span class="p">],</span> <span class="n">final_p</span><span class="p">[</span><span class="n">saddle_idx</span><span class="p">]</span>
</span><span data-line="592">
</span><span data-line="593">        <span class="c1"># Apply projection to saddle point if enabled</span>
</span><span data-line="594">        <span class="k">if</span> <span class="n">project_path</span><span class="p">:</span>
</span><span data-line="595">            <span class="n">r_start</span><span class="p">,</span> <span class="n">p_start</span> <span class="o">=</span> <span class="n">final_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">final_p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="596">            <span class="n">r_end</span><span class="p">,</span> <span class="n">p_end</span> <span class="o">=</span> <span class="n">final_r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">final_p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="597">            <span class="n">vec_r</span> <span class="o">=</span> <span class="n">r_end</span> <span class="o">-</span> <span class="n">r_start</span>
</span><span data-line="598">            <span class="n">vec_p</span> <span class="o">=</span> <span class="n">p_end</span> <span class="o">-</span> <span class="n">p_start</span>
</span><span data-line="599">            <span class="n">path_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">vec_r</span><span class="p">,</span> <span class="n">vec_p</span><span class="p">)</span>
</span><span data-line="600">            <span class="n">u_r</span><span class="p">,</span> <span class="n">u_p</span> <span class="o">=</span> <span class="n">vec_r</span> <span class="o">/</span> <span class="n">path_norm</span><span class="p">,</span> <span class="n">vec_p</span> <span class="o">/</span> <span class="n">path_norm</span>
</span><span data-line="601">            <span class="n">v_r</span><span class="p">,</span> <span class="n">v_p</span> <span class="o">=</span> <span class="o">-</span><span class="n">u_p</span><span class="p">,</span> <span class="n">u_r</span>
</span><span data-line="602">
</span><span data-line="603">            <span class="n">sp_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">sp_x_raw</span> <span class="o">-</span> <span class="n">r_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">u_r</span> <span class="o">+</span> <span class="p">(</span><span class="n">sp_y_raw</span> <span class="o">-</span> <span class="n">p_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">u_p</span>
</span><span data-line="604">            <span class="n">sp_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">sp_x_raw</span> <span class="o">-</span> <span class="n">r_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">v_r</span> <span class="o">+</span> <span class="p">(</span><span class="n">sp_y_raw</span> <span class="o">-</span> <span class="n">p_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">v_p</span>
</span><span data-line="605">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="606">            <span class="n">sp_x</span><span class="p">,</span> <span class="n">sp_y</span> <span class="o">=</span> <span class="n">sp_x_raw</span><span class="p">,</span> <span class="n">sp_y_raw</span>
</span><span data-line="607">
</span><span data-line="608">        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
</span><span data-line="609">            <span class="n">sp_x</span><span class="p">,</span>
</span><span data-line="610">            <span class="n">sp_y</span><span class="p">,</span>
</span><span data-line="611">            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span>
</span><span data-line="612">            <span class="n">s</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">active_theme</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
</span><span data-line="613">            <span class="n">c</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span data-line="614">            <span class="n">edgecolors</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="615">            <span class="n">linewidths</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span>
</span><span data-line="616">            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span data-line="617">            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;SP&quot;</span><span class="p">,</span>
</span><span data-line="618">        <span class="p">)</span>
</span><span data-line="619">
</span><span data-line="620">        <span class="k">if</span> <span class="n">additional_atoms_data</span><span class="p">:</span>
</span><span data-line="621">            <span class="n">marker_cmap</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colormaps</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;tab10&quot;</span><span class="p">)</span>
</span><span data-line="622">            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">add_r</span><span class="p">,</span> <span class="n">add_p</span><span class="p">,</span> <span class="n">add_label</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">additional_atoms_data</span><span class="p">):</span>
</span><span data-line="623">                <span class="n">color</span> <span class="o">=</span> <span class="n">marker_cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">10</span><span class="p">)</span>
</span><span data-line="624">
</span><span data-line="625">                <span class="k">if</span> <span class="n">project_path</span><span class="p">:</span>
</span><span data-line="626">                    <span class="n">plot_add_r</span> <span class="o">=</span> <span class="p">(</span><span class="n">add_r</span> <span class="o">-</span> <span class="n">r_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">u_r</span> <span class="o">+</span> <span class="p">(</span><span class="n">add_p</span> <span class="o">-</span> <span class="n">p_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">u_p</span>
</span><span data-line="627">                    <span class="n">plot_add_p</span> <span class="o">=</span> <span class="p">(</span><span class="n">add_r</span> <span class="o">-</span> <span class="n">r_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">v_r</span> <span class="o">+</span> <span class="p">(</span><span class="n">add_p</span> <span class="o">-</span> <span class="n">p_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">v_p</span>
</span><span data-line="628">                <span class="k">else</span><span class="p">:</span>
</span><span data-line="629">                    <span class="n">plot_add_r</span><span class="p">,</span> <span class="n">plot_add_p</span> <span class="o">=</span> <span class="n">add_r</span><span class="p">,</span> <span class="n">add_p</span>
</span><span data-line="630">
</span><span data-line="631">                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
</span><span data-line="632">                    <span class="n">plot_add_r</span><span class="p">,</span>
</span><span data-line="633">                    <span class="n">plot_add_p</span><span class="p">,</span>
</span><span data-line="634">                    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span data-line="635">                    <span class="n">markersize</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">active_theme</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mf">1.1</span><span class="p">),</span>
</span><span data-line="636">                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span data-line="637">                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span data-line="638">                    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span data-line="639">                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
</span><span data-line="640">                    <span class="n">zorder</span><span class="o">=</span><span class="mi">102</span><span class="p">,</span>
</span><span data-line="641">                    <span class="n">label</span><span class="o">=</span><span class="n">add_label</span><span class="p">,</span>
</span><span data-line="642">                <span class="p">)</span>
</span><span data-line="643">
</span><span data-line="644">        <span class="k">if</span> <span class="n">has_strip</span> <span class="ow">and</span> <span class="n">atoms_list</span><span class="p">:</span>
</span><span data-line="645">            <span class="n">strip_payload</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="646">
</span><span data-line="647">            <span class="c1"># Helper to calculate projected coordinates for labels</span>
</span><span data-line="648">            <span class="k">def</span><span class="w"> </span><span class="nf">get_projected_coords</span><span class="p">(</span><span class="n">r_val</span><span class="p">,</span> <span class="n">p_val</span><span class="p">):</span>
</span><span data-line="649">                <span class="k">if</span> <span class="n">project_path</span><span class="p">:</span>
</span><span data-line="650">                    <span class="n">s_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_val</span> <span class="o">-</span> <span class="n">r_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">u_r</span> <span class="o">+</span> <span class="p">(</span><span class="n">p_val</span> <span class="o">-</span> <span class="n">p_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">u_p</span>
</span><span data-line="651">                    <span class="n">d_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">r_val</span> <span class="o">-</span> <span class="n">r_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">v_r</span> <span class="o">+</span> <span class="p">(</span><span class="n">p_val</span> <span class="o">-</span> <span class="n">p_start</span><span class="p">)</span> <span class="o">*</span> <span class="n">v_p</span>
</span><span data-line="652">                    <span class="k">return</span> <span class="n">s_val</span><span class="p">,</span> <span class="n">d_val</span>
</span><span data-line="653">                <span class="k">return</span> <span class="n">r_val</span><span class="p">,</span> <span class="n">p_val</span>
</span><span data-line="654">
</span><span data-line="655">            <span class="c1"># Add Reactant</span>
</span><span data-line="656">            <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span> <span class="o">=</span> <span class="n">get_projected_coords</span><span class="p">(</span><span class="n">final_r</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">final_p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span data-line="657">            <span class="n">strip_payload</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">atoms_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">rx</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">ry</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;R&quot;</span><span class="p">})</span>
</span><span data-line="658">
</span><span data-line="659">            <span class="c1"># Add Saddle (Explicit or Heuristic)</span>
</span><span data-line="660">            <span class="k">if</span> <span class="n">sp_data</span><span class="p">:</span>
</span><span data-line="661">                <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span> <span class="o">=</span> <span class="n">get_projected_coords</span><span class="p">(</span><span class="n">sp_data</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">],</span> <span class="n">sp_data</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">])</span>
</span><span data-line="662">                <span class="n">strip_payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="663">                    <span class="p">{</span><span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">sp_data</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">],</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">sx</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">sy</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;SP&quot;</span><span class="p">}</span>
</span><span data-line="664">                <span class="p">)</span>
</span><span data-line="665">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="666">                <span class="n">s_idx</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="667">                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">final_z</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span data-line="668">                    <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="s2">&quot;energy&quot;</span>
</span><span data-line="669">                    <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">final_z</span><span class="p">)</span>
</span><span data-line="670">                <span class="p">)</span>
</span><span data-line="671">                <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span> <span class="o">=</span> <span class="n">get_projected_coords</span><span class="p">(</span><span class="n">final_r</span><span class="p">[</span><span class="n">s_idx</span><span class="p">],</span> <span class="n">final_p</span><span class="p">[</span><span class="n">s_idx</span><span class="p">])</span>
</span><span data-line="672">                <span class="n">strip_payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="673">                    <span class="p">{</span><span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">atoms_list</span><span class="p">[</span><span class="n">s_idx</span><span class="p">],</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">sx</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">sy</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;SP&quot;</span><span class="p">}</span>
</span><span data-line="674">                <span class="p">)</span>
</span><span data-line="675">
</span><span data-line="676">            <span class="c1"># Add Product</span>
</span><span data-line="677">            <span class="n">px</span><span class="p">,</span> <span class="n">py</span> <span class="o">=</span> <span class="n">get_projected_coords</span><span class="p">(</span><span class="n">final_r</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">final_p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span data-line="678">            <span class="n">strip_payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="679">                <span class="p">{</span><span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">atoms_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">px</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">py</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;P&quot;</span><span class="p">}</span>
</span><span data-line="680">            <span class="p">)</span>
</span><span data-line="681">
</span><span data-line="682">            <span class="c1"># Add intermediate points if &#39;all&#39; requested</span>
</span><span data-line="683">            <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span data-line="684">                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span data-line="685">                    <span class="n">ix</span><span class="p">,</span> <span class="n">iy</span> <span class="o">=</span> <span class="n">get_projected_coords</span><span class="p">(</span><span class="n">final_r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">final_p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span data-line="686">                    <span class="n">strip_payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="687">                        <span class="p">{</span><span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">atoms_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">ix</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">iy</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)}</span>
</span><span data-line="688">                    <span class="p">)</span>
</span><span data-line="689">
</span><span data-line="690">            <span class="c1"># Add additional structures</span>
</span><span data-line="691">            <span class="k">for</span> <span class="n">add_atoms</span><span class="p">,</span> <span class="n">add_r</span><span class="p">,</span> <span class="n">add_p</span><span class="p">,</span> <span class="n">add_label</span> <span class="ow">in</span> <span class="n">additional_atoms_data</span><span class="p">:</span>
</span><span data-line="692">                <span class="n">ax_r</span><span class="p">,</span> <span class="n">ax_p</span> <span class="o">=</span> <span class="n">get_projected_coords</span><span class="p">(</span><span class="n">add_r</span><span class="p">,</span> <span class="n">add_p</span><span class="p">)</span>
</span><span data-line="693">                <span class="n">strip_payload</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span data-line="694">                    <span class="p">{</span>
</span><span data-line="695">                        <span class="s2">&quot;atoms&quot;</span><span class="p">:</span> <span class="n">add_atoms</span><span class="p">,</span>
</span><span data-line="696">                        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">ax_r</span><span class="p">,</span>
</span><span data-line="697">                        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">ax_p</span><span class="p">,</span>
</span><span data-line="698">                        <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="n">add_label</span><span class="p">,</span>
</span><span data-line="699">                    <span class="p">}</span>
</span><span data-line="700">                <span class="p">)</span>
</span><span data-line="701">
</span><span data-line="702">            <span class="n">strip_payload</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">])</span>
</span><span data-line="703">            <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">strip_payload</span><span class="p">]</span>
</span><span data-line="704">            <span class="n">structs</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s2">&quot;atoms&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">strip_payload</span><span class="p">]</span>
</span><span data-line="705">
</span><span data-line="706">            <span class="n">plot_structure_strip</span><span class="p">(</span>
</span><span data-line="707">                <span class="n">ax_strip</span><span class="p">,</span>
</span><span data-line="708">                <span class="n">structs</span><span class="p">,</span>
</span><span data-line="709">                <span class="n">labels</span><span class="p">,</span>
</span><span data-line="710">                <span class="n">zoom</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="711">                <span class="n">rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="712">                <span class="n">theme_color</span><span class="o">=</span><span class="n">active_theme</span><span class="o">.</span><span class="n">textcolor</span><span class="p">,</span>
</span><span data-line="713">            <span class="p">)</span>
</span><span data-line="714">
</span><span data-line="715">            <span class="c1"># Annotate Main Plot</span>
</span><span data-line="716">            <span class="n">main_plot_texts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="717">            <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">strip_payload</span><span class="p">:</span>
</span><span data-line="718">                <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
</span><span data-line="719">                    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span>
</span><span data-line="720">                    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">],</span>
</span><span data-line="721">                    <span class="n">d</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
</span><span data-line="722">                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
</span><span data-line="723">                    <span class="n">fontweight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
</span><span data-line="724">                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span data-line="725">                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
</span><span data-line="726">                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
</span><span data-line="727">                    <span class="n">zorder</span><span class="o">=</span><span class="mi">102</span><span class="p">,</span>
</span><span data-line="728">                <span class="p">)</span>
</span><span data-line="729">                <span class="n">t</span><span class="o">.</span><span class="n">set_path_effects</span><span class="p">(</span>
</span><span data-line="730">                    <span class="p">[</span><span class="n">path_effects</span><span class="o">.</span><span class="n">withStroke</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">foreground</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)]</span>
</span><span data-line="731">                <span class="p">)</span>
</span><span data-line="732">                <span class="n">main_plot_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span data-line="733">
</span><span data-line="734">            <span class="k">if</span> <span class="n">main_plot_texts</span><span class="p">:</span>
</span><span data-line="735">                <span class="n">adjust_text</span><span class="p">(</span>
</span><span data-line="736">                    <span class="n">main_plot_texts</span><span class="p">,</span>
</span><span data-line="737">                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
</span><span data-line="738">                    <span class="n">arrowprops</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;arrowstyle&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="s2">&quot;lw&quot;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">},</span>
</span><span data-line="739">                    <span class="n">expand_points</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">),</span>
</span><span data-line="740">                    <span class="n">force_text</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span data-line="741">                <span class="p">)</span>
</span><span data-line="742">
</span><span data-line="743">        <span class="c1"># Labels</span>
</span><span data-line="744">        <span class="k">if</span> <span class="n">project_path</span><span class="p">:</span>
</span><span data-line="745">            <span class="n">final_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;RMSD from Reactant ($\AA$)&quot;</span>
</span><span data-line="746">            <span class="n">final_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;Orthogonal Deviation $d$ ($\AA$)&quot;</span>
</span><span data-line="747">            <span class="n">final_title</span> <span class="o">=</span> <span class="s2">&quot;Reaction Valley Projection&quot;</span> <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;NEB Path&quot;</span> <span class="k">else</span> <span class="n">title</span>
</span><span data-line="748">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="749">            <span class="n">final_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;RMSD from Reactant ($\AA$)&quot;</span>
</span><span data-line="750">            <span class="n">final_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span> <span class="ow">or</span> <span class="sa">r</span><span class="s2">&quot;RMSD from Product ($\AA$)&quot;</span>
</span><span data-line="751">            <span class="n">final_title</span> <span class="o">=</span> <span class="s2">&quot;RMSD(R,P) projection&quot;</span> <span class="k">if</span> <span class="n">title</span> <span class="o">==</span> <span class="s2">&quot;NEB Path&quot;</span> <span class="k">else</span> <span class="n">title</span>
</span><span data-line="752">
</span><span data-line="753">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="754">        <span class="c1"># --- Profile Plot ---</span>
</span><span data-line="755">        <span class="n">dat_paths</span> <span class="o">=</span> <span class="n">find_file_paths</span><span class="p">(</span><span class="n">input_dat_pattern</span><span class="p">)</span>
</span><span data-line="756">        <span class="n">file_paths_to_plot</span> <span class="o">=</span> <span class="n">dat_paths</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
</span><span data-line="757">
</span><span data-line="758">        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_paths_to_plot</span><span class="p">:</span>
</span><span data-line="759">            <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No files found in range.&quot;</span><span class="p">)</span>
</span><span data-line="760">            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span data-line="761">
</span><span data-line="762">        <span class="c1"># Optional: Load RMSD for X-axis</span>
</span><span data-line="763">        <span class="n">rmsd_rc</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="764">        <span class="k">if</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="s2">&quot;rmsd&quot;</span> <span class="ow">and</span> <span class="n">atoms_list</span><span class="p">:</span>
</span><span data-line="765">            <span class="n">df_rmsd</span> <span class="o">=</span> <span class="n">compute_profile_rmsd</span><span class="p">(</span>
</span><span data-line="766">                <span class="n">atoms_list</span><span class="p">,</span> <span class="n">cache_file</span><span class="p">,</span> <span class="n">force_recompute</span><span class="p">,</span> <span class="n">ira_kmax</span>
</span><span data-line="767">            <span class="p">)</span>
</span><span data-line="768">            <span class="n">rmsd_rc</span> <span class="o">=</span> <span class="n">df_rmsd</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</span><span data-line="769">
</span><span data-line="770">        <span class="c1"># Plot Loop</span>
</span><span data-line="771">        <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">active_theme</span><span class="o">.</span><span class="n">cmap_profile</span><span class="p">)</span>
</span><span data-line="772">        <span class="n">color_divisor</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="773">            <span class="nb">len</span><span class="p">(</span><span class="n">file_paths_to_plot</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths_to_plot</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">1.0</span>
</span><span data-line="774">        <span class="p">)</span>
</span><span data-line="775">
</span><span data-line="776">        <span class="n">y_col</span> <span class="o">=</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="s2">&quot;energy&quot;</span> <span class="k">else</span> <span class="mi">4</span>
</span><span data-line="777">
</span><span data-line="778">        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">fpath</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">file_paths_to_plot</span><span class="p">):</span>
</span><span data-line="779">            <span class="k">try</span><span class="p">:</span>
</span><span data-line="780">                <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span data-line="781">            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
</span><span data-line="782">                <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
</span><span data-line="783">                <span class="k">continue</span>
</span><span data-line="784">
</span><span data-line="785">            <span class="c1"># X-Axis Logic</span>
</span><span data-line="786">            <span class="k">if</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="s2">&quot;rmsd&quot;</span> <span class="ow">and</span> <span class="n">rmsd_rc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="787">                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rmsd_rc</span><span class="p">)</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
</span><span data-line="788">                    <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmsd_rc</span>
</span><span data-line="789">            <span class="k">elif</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="s2">&quot;index&quot;</span><span class="p">:</span>
</span><span data-line="790">                <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span data-line="791">            <span class="k">elif</span> <span class="n">normalize_rc</span><span class="p">:</span>
</span><span data-line="792">                <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="793">
</span><span data-line="794">            <span class="c1"># Style Logic</span>
</span><span data-line="795">            <span class="n">is_last</span> <span class="o">=</span> <span class="n">idx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">file_paths_to_plot</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span data-line="796">            <span class="k">if</span> <span class="n">highlight_last</span> <span class="ow">and</span> <span class="n">is_last</span><span class="p">:</span>
</span><span data-line="797">                <span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span> <span class="o">=</span> <span class="n">active_theme</span><span class="o">.</span><span class="n">highlight_color</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">20</span>
</span><span data-line="798">            <span class="k">else</span><span class="p">:</span>
</span><span data-line="799">                <span class="n">color</span> <span class="o">=</span> <span class="n">cm</span><span class="p">(</span><span class="n">idx</span> <span class="o">/</span> <span class="n">color_divisor</span><span class="p">)</span>
</span><span data-line="800">                <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.5</span>
</span><span data-line="801">                <span class="n">zorder</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">5</span>
</span><span data-line="802">
</span><span data-line="803">            <span class="c1"># Plot</span>
</span><span data-line="804">            <span class="n">plot_energy_path</span><span class="p">(</span>
</span><span data-line="805">                <span class="n">ax</span><span class="p">,</span>
</span><span data-line="806">                <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span data-line="807">                <span class="n">data</span><span class="p">[</span><span class="n">y_col</span><span class="p">],</span>
</span><span data-line="808">                <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>  <span class="c1"># Forces</span>
</span><span data-line="809">                <span class="n">color</span><span class="p">,</span>
</span><span data-line="810">                <span class="n">alpha</span><span class="p">,</span>
</span><span data-line="811">                <span class="n">zorder</span><span class="p">,</span>
</span><span data-line="812">                <span class="n">method</span><span class="o">=</span><span class="n">spline_method</span><span class="p">,</span>
</span><span data-line="813">            <span class="p">)</span>
</span><span data-line="814">
</span><span data-line="815">            <span class="k">if</span> <span class="n">highlight_last</span> <span class="ow">and</span> <span class="n">is_last</span> <span class="ow">and</span> <span class="n">atoms_list</span> <span class="ow">and</span> <span class="n">plot_structures</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span data-line="816">                <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="817">                    <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)))</span>
</span><span data-line="818">                    <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span>
</span><span data-line="819">                    <span class="k">else</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span data-line="820">                        <span class="p">{</span>
</span><span data-line="821">                            <span class="mi">0</span><span class="p">,</span>
</span><span data-line="822">                            <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">y_col</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span>
</span><span data-line="823">                            <span class="k">if</span> <span class="n">plot_mode</span> <span class="o">==</span> <span class="s2">&quot;energy&quot;</span>
</span><span data-line="824">                            <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">y_col</span><span class="p">]),</span>
</span><span data-line="825">                            <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
</span><span data-line="826">                        <span class="p">}</span>
</span><span data-line="827">                    <span class="p">)</span>
</span><span data-line="828">                <span class="p">)</span>
</span><span data-line="829">                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
</span><span data-line="830">                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="831">                        <span class="n">xybox</span><span class="p">,</span> <span class="n">rad</span> <span class="o">=</span> <span class="n">draw_reactant</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">draw_reactant</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span data-line="832">                    <span class="k">elif</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">atoms_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
</span><span data-line="833">                        <span class="n">xybox</span><span class="p">,</span> <span class="n">rad</span> <span class="o">=</span> <span class="n">draw_product</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">draw_product</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span data-line="834">                    <span class="k">else</span><span class="p">:</span>
</span><span data-line="835">                        <span class="n">xybox</span><span class="p">,</span> <span class="n">rad</span> <span class="o">=</span> <span class="n">draw_saddle</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">draw_saddle</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span data-line="836">
</span><span data-line="837">                    <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
</span><span data-line="838">                        <span class="n">xybox</span> <span class="o">=</span> <span class="p">(</span><span class="mf">15.0</span><span class="p">,</span> <span class="mf">60.0</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mf">60.0</span><span class="p">)</span>
</span><span data-line="839">                        <span class="n">rad</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="o">-</span><span class="mf">0.1</span>
</span><span data-line="840">
</span><span data-line="841">                    <span class="c1"># Call library function</span>
</span><span data-line="842">                    <span class="n">plot_structure_inset</span><span class="p">(</span>
</span><span data-line="843">                        <span class="n">ax</span><span class="p">,</span>
</span><span data-line="844">                        <span class="n">atoms_list</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
</span><span data-line="845">                        <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
</span><span data-line="846">                        <span class="n">data</span><span class="p">[</span><span class="n">y_col</span><span class="p">][</span><span class="n">i</span><span class="p">],</span>
</span><span data-line="847">                        <span class="n">xybox</span><span class="p">,</span>
</span><span data-line="848">                        <span class="n">rad</span><span class="p">,</span>
</span><span data-line="849">                        <span class="n">zoom</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="850">                        <span class="n">rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="851">                    <span class="p">)</span>
</span><span data-line="852">
</span><span data-line="853">        <span class="c1"># --- Profile Additional Structures ---</span>
</span><span data-line="854">        <span class="k">if</span> <span class="n">additional_atoms_data</span> <span class="ow">and</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="s2">&quot;rmsd&quot;</span><span class="p">:</span>
</span><span data-line="855">            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">add_atoms</span><span class="p">,</span> <span class="n">add_r</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">additional_atoms_data</span><span class="p">):</span>
</span><span data-line="856">                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span>
</span><span data-line="857">                    <span class="n">add_r</span><span class="p">,</span>
</span><span data-line="858">                    <span class="n">color</span><span class="o">=</span><span class="n">active_theme</span><span class="o">.</span><span class="n">gridcolor</span><span class="p">,</span>
</span><span data-line="859">                    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span>
</span><span data-line="860">                    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
</span><span data-line="861">                    <span class="n">zorder</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
</span><span data-line="862">                <span class="p">)</span>
</span><span data-line="863">                <span class="k">if</span> <span class="n">plot_structures</span> <span class="o">!=</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
</span><span data-line="864">                    <span class="n">y_span</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span data-line="865">                    <span class="n">y_pos</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.9</span> <span class="o">*</span> <span class="n">y_span</span>
</span><span data-line="866">                    <span class="n">plot_structure_inset</span><span class="p">(</span>
</span><span data-line="867">                        <span class="n">ax</span><span class="p">,</span>
</span><span data-line="868">                        <span class="n">add_atoms</span><span class="p">,</span>
</span><span data-line="869">                        <span class="n">add_r</span><span class="p">,</span>
</span><span data-line="870">                        <span class="n">y_pos</span><span class="p">,</span>
</span><span data-line="871">                        <span class="n">xybox</span><span class="o">=</span><span class="p">(</span>
</span><span data-line="872">                            <span class="n">draw_saddle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">15</span><span class="p">),</span>
</span><span data-line="873">                            <span class="n">draw_saddle</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
</span><span data-line="874">                        <span class="p">),</span>  <span class="c1"># Stagger slightly</span>
</span><span data-line="875">                        <span class="n">rad</span><span class="o">=</span><span class="n">draw_saddle</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
</span><span data-line="876">                        <span class="n">zoom</span><span class="o">=</span><span class="n">zoom_ratio</span><span class="p">,</span>
</span><span data-line="877">                        <span class="n">rotation</span><span class="o">=</span><span class="n">ase_rotation</span><span class="p">,</span>
</span><span data-line="878">                        <span class="n">arrow_props</span><span class="o">=</span><span class="p">{</span>
</span><span data-line="879">                            <span class="s2">&quot;arrowstyle&quot;</span><span class="p">:</span> <span class="n">ArrowStyle</span><span class="o">.</span><span class="n">Fancy</span><span class="p">(</span>
</span><span data-line="880">                                <span class="n">head_length</span><span class="o">=</span><span class="n">arrow_head_length</span><span class="p">,</span>
</span><span data-line="881">                                <span class="n">head_width</span><span class="o">=</span><span class="n">arrow_head_width</span><span class="p">,</span>
</span><span data-line="882">                                <span class="n">tail_width</span><span class="o">=</span><span class="n">arrow_tail_width</span><span class="p">,</span>
</span><span data-line="883">                            <span class="p">),</span>
</span><span data-line="884">                            <span class="s2">&quot;connectionstyle&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;arc3,rad=</span><span class="si">{</span><span class="n">rad</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span data-line="885">                            <span class="s2">&quot;linestyle&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span>
</span><span data-line="886">                            <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>
</span><span data-line="887">                            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="888">                            <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mf">1.2</span><span class="p">,</span>
</span><span data-line="889">                        <span class="p">},</span>
</span><span data-line="890">                    <span class="p">)</span>
</span><span data-line="891">
</span><span data-line="892">        <span class="c1"># Profile Labels</span>
</span><span data-line="893">        <span class="n">final_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span> <span class="ow">or</span> <span class="p">(</span>
</span><span data-line="894">            <span class="sa">r</span><span class="s2">&quot;RMSD ($\AA$)&quot;</span> <span class="k">if</span> <span class="n">rc_mode</span> <span class="o">==</span> <span class="s2">&quot;rmsd&quot;</span> <span class="k">else</span> <span class="sa">r</span><span class="s2">&quot;Reaction Coordinate ($\AA$)&quot;</span>
</span><span data-line="895">        <span class="p">)</span>
</span><span data-line="896">        <span class="n">final_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span> <span class="ow">or</span> <span class="s2">&quot;Relative Energy (eV)&quot;</span>
</span><span data-line="897">        <span class="n">final_title</span> <span class="o">=</span> <span class="n">title</span>
</span><span data-line="898">
</span><span data-line="899">    <span class="c1"># Final Aesthetics</span>
</span><span data-line="900">    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">final_xlabel</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</span><span data-line="901">    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">final_ylabel</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
</span><span data-line="902">    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">final_title</span><span class="p">)</span>
</span><span data-line="903">    <span class="n">ax</span><span class="o">.</span><span class="n">minorticks_on</span><span class="p">()</span>
</span><span data-line="904">
</span><span data-line="905">    <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s2">&quot;landscape&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">aspect_ratio</span><span class="p">:</span>
</span><span data-line="906">        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
</span><span data-line="907">        <span class="k">if</span> <span class="n">project_path</span><span class="p">:</span>
</span><span data-line="908">            <span class="c1"># Force Y-axis to be symmetric and match the X-axis span</span>
</span><span data-line="909">            <span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
</span><span data-line="910">            <span class="n">x_span</span> <span class="o">=</span> <span class="n">x_max</span> <span class="o">-</span> <span class="n">x_min</span>
</span><span data-line="911">            <span class="n">half_span</span> <span class="o">=</span> <span class="n">x_span</span> <span class="o">/</span> <span class="mi">2</span>
</span><span data-line="912">            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">half_span</span><span class="p">,</span> <span class="n">half_span</span><span class="p">)</span>
</span><span data-line="913">            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Set symmetric Y-axis limits: [-</span><span class="si">{</span><span class="n">half_span</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">half_span</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</span><span data-line="914">
</span><span data-line="915">    <span class="k">if</span> <span class="n">show_legend</span><span class="p">:</span>
</span><span data-line="916">        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
</span><span data-line="917">            <span class="c1"># Upper left is orthogonal to 0 distance from R, unlikely</span>
</span><span data-line="918">            <span class="c1"># Lower left is near 0 w.r.t R and P, always spurious</span>
</span><span data-line="919">            <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span> <span class="k">if</span> <span class="n">project_path</span> <span class="k">else</span> <span class="s2">&quot;lower left&quot;</span><span class="p">,</span>
</span><span data-line="920">            <span class="n">borderaxespad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span data-line="921">            <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span data-line="922">            <span class="n">framealpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
</span><span data-line="923">            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
</span><span data-line="924">            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
</span><span data-line="925">            <span class="n">fontsize</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">active_theme</span><span class="o">.</span><span class="n">font_size</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">),</span>
</span><span data-line="926">        <span class="p">)</span><span class="o">.</span><span class="n">set_zorder</span><span class="p">(</span><span class="mi">101</span><span class="p">)</span>
</span><span data-line="927">
</span><span data-line="928">    <span class="k">if</span> <span class="n">ax_strip</span><span class="p">:</span>
</span><span data-line="929">        <span class="n">pos_main</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
</span><span data-line="930">        <span class="n">pos_strip</span> <span class="o">=</span> <span class="n">ax_strip</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span>
</span><span data-line="931">
</span><span data-line="932">        <span class="c1"># Force strip to match the main plot&#39;s Left and Width exactly</span>
</span><span data-line="933">        <span class="n">ax_strip</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span>
</span><span data-line="934">            <span class="p">[</span><span class="n">pos_main</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span> <span class="n">pos_strip</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span> <span class="n">pos_main</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">pos_strip</span><span class="o">.</span><span class="n">height</span><span class="p">]</span>
</span><span data-line="935">        <span class="p">)</span>
</span><span data-line="936">
</span><span data-line="937">    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</span><span data-line="938">
</span><span data-line="939">    <span class="k">if</span> <span class="n">output_file</span><span class="p">:</span>
</span><span data-line="940">        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
</span><span data-line="941">    <span class="k">else</span><span class="p">:</span>
</span><span data-line="942">        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

</span><span data-line="943">
</span><span data-line="944">
</span><span data-line="945"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span data-line="946">    <span class="n">main</span><span class="p">()</span>
</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    
    <div
      style="
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        margin-bottom: 1.5rem;
        color: var(--sy-c-text-weak);
        font-size: 0.9em;
      "
    >
      <div
        style="
          display: flex;
          flex-wrap: wrap;
          justify-content: center;
          gap: 1rem;
          align-items: center;
        "
      >
        
        <span style="display: inline-flex; align-items: center; gap: 0.3em">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="1em"
            height="1em"
            viewBox="0 0 24 24"
            fill="currentColor"
            aria-hidden="true"
          >
            <path d="M7,20H4V4h3V20z M14,20h-3V12h3V20z M21,20h-3V8h3V20z" />
          </svg>
          <span
            >Analytics by
            <a
              href="https://plausible.io/"
              target="_blank"
              rel="noopener noreferrer"
              style="color: inherit; text-decoration: underline"
              >Plausible</a
            ></span
          >
        </span>

        
        <span style="display: inline-flex; align-items: center; gap: 0.3em">
          <span>provided by</span>
          <span style="display: inline-flex; align-items: center; gap: 0.3em">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="1.2em"
              height="1.2em"
              viewBox="0 0 64 64"
              aria-hidden="true"
            >
              <g fill-rule="evenodd">
                <ellipse cx="32" cy="11" fill="#80D25B" rx="7" ry="9" />
                <path
                  fill="#80D25B"
                  d="M20.302104,46 C20.302104,46 17.1330329,55.8812548 20.6828149,59.7817355 C24.232597,63.6822162 26.8008673,63.215359 26.8008673,53.7414927 C26.8008673,44.2676263 20.302104,46 20.302104,46 Z"
                />
                <path
                  fill="#80D25B"
                  d="M38.302104,46 C38.302104,46 35.1330329,55.8812548 38.6828149,59.7817355 C42.232597,63.6822162 44.8008673,63.215359 44.8008673,53.7414927 C44.8008673,44.2676263 38.302104,46 38.302104,46 Z"
                  transform="matrix(-1 0 0 1 81.8 0)"
                />
                <path
                  fill="#80D25B"
                  d="M20.6227767,21.2218684 C20.6227767,21.2218684 13.956214,15.3844007 10.091955,16.0534044 C6.22769598,16.722408 6,22.2124633 6,23.9992899 C6,25.7861165 7.78917398,37.3159836 9.78726488,36.4967476 C11.7853558,35.6775115 13.7411938,27.959322 13.7411938,27.959322 15.6510232,30.2287702 18.609193,30.4630388"
                />
                <path
                  fill="#80D25B"
                  d="M57.6227767,21.2218684 C57.6227767,21.2218684 50.956214,15.3844007 47.091955,16.0534044 C43.227696,16.722408 43,22.2124633 43,23.9992899 C43,25.7861165 44.789174,37.3159836 46.7872649,36.4967476 C48.7853558,35.6775115 50.7411938,27.959322 50.7411938,27.959322 52.6510232,30.2287702 55.609193,30.4630388"
                  transform="matrix(-1 0 0 1 100.623 0)"
                />
                <path
                  fill="#BD7575"
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M32,53 C40.836556,53 48,44.4934102 48,34 C48,23.5065898 46.6814044,17 32,17 C17.3185956,17 16,23.5065898 16,34 C16,44.4934102 23.163444,53 32,53 Z"
                />
                <polygon
                  fill="#BD7575"
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  points="32 22 38.928 26 38.928 34 32 38 25.072 34 25.072 26"
                />
                <path
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M30,8 C28.8954305,8 28,8.8954305 28,10"
                />
                <path
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M36,8 C34.8954305,8 34,8.8954305 34,10"
                  transform="matrix(-1 0 0 1 70 0)"
                />
                <path
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M32.1194396 38.1881507L32.1194396 52.4125899M32.0164956 21.7467197L32.0164956 17M25.2141026 26.0041506L17.737148 23.0721126M25.1254173 34.1534318L16.7659494 38.8876521"
                />
                <path
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M46.2141026,26.0041506 L38.737148,23.0721126"
                  transform="matrix(-1 0 0 1 84.951 0)"
                />
                <path
                  stroke="#595959"
                  stroke-linecap="round"
                  stroke-width="2"
                  d="M47.1254173,34.1534318 L38.7659494,38.8876521"
                  transform="matrix(-1 0 0 1 85.891 0)"
                />
              </g>
            </svg>
            <a
              href="https://turtletech.us/"
              target="_blank"
              rel="noopener noreferrer"
              style="color: inherit; text-decoration: underline"
              >TurtleTech ehf</a
            >
          </span>
        </span>
      </div>
    </div>

    
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, Rohit Goswami</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div> <div class="sy-foot-socials">
<a href="https://github.com/Haozeke/rgpycrumbs" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../../../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../../../_static/shibuya.js?v=cac61aee"></script></body>
</html>