rgpycrumbs.surfaces
===================

.. py:module:: rgpycrumbs.surfaces


Submodules
----------

.. toctree::
   :maxdepth: 1

   /autoapi/rgpycrumbs/surfaces/_base/index
   /autoapi/rgpycrumbs/surfaces/_kernels/index
   /autoapi/rgpycrumbs/surfaces/gradient/index
   /autoapi/rgpycrumbs/surfaces/standard/index


Classes
-------

.. autoapisummary::

   rgpycrumbs.surfaces.BaseGradientSurface
   rgpycrumbs.surfaces.BaseSurface
   rgpycrumbs.surfaces.GradientIMQ
   rgpycrumbs.surfaces.GradientMatern
   rgpycrumbs.surfaces.GradientRQ
   rgpycrumbs.surfaces.GradientSE
   rgpycrumbs.surfaces.NystromGradientIMQ
   rgpycrumbs.surfaces.FastIMQ
   rgpycrumbs.surfaces.FastMatern
   rgpycrumbs.surfaces.FastTPS


Functions
---------

.. autoapisummary::

   rgpycrumbs.surfaces.generic_negative_mll
   rgpycrumbs.surfaces.safe_cholesky_solve
   rgpycrumbs.surfaces._imq_kernel_matrix
   rgpycrumbs.surfaces._matern_kernel_matrix
   rgpycrumbs.surfaces._tps_kernel_matrix
   rgpycrumbs.surfaces.get_surface_model


Package Contents
----------------

.. py:class:: BaseGradientSurface(x, y, gradients=None, smoothing=0.0001, length_scale=None, optimize=True, **_kwargs)

   Abstract base class for gradient-enhanced surface models.

   Derived classes must implement `_fit`, `_solve`, `_predict_chunk`, and `_var_chunk`.
   These models incorporate both values and their gradients into the fit.


   .. py:attribute:: x


   .. py:attribute:: y_full


   .. py:attribute:: e_mean


   .. py:attribute:: y_flat


   .. py:attribute:: D_plus_1


   .. py:method:: _fit(smoothing, length_scale, optimize)
      :abstractmethod:


      Internal method to perform parameter optimization.



   .. py:method:: _solve()
      :abstractmethod:


      Internal method to solve the linear system for weights.



   .. py:method:: __call__(x_query, chunk_size=500)

      Predict values at query points.

      Args:
          x_query: Query inputs (M, D).
          chunk_size: Number of points to process per batch.

      Returns:
          jnp.ndarray: Predicted values (M,).



   .. py:method:: predict_var(x_query, chunk_size=500)

      Predict posterior variance at query points.

      Args:
          x_query: Query inputs (M, D).
          chunk_size: Number of points to process per batch.

      Returns:
          jnp.ndarray: Predicted variances (M,).



   .. py:method:: _predict_chunk(chunk)
      :abstractmethod:


      Internal method for batch prediction.



   .. py:method:: _var_chunk(chunk)
      :abstractmethod:


      Internal method for batch variance.



.. py:class:: BaseSurface(x_obs, y_obs, smoothing=0.001, length_scale=None, optimize=True, **_kwargs)

   Abstract base class for standard (non-gradient) surface models.

   Derived classes must implement `_fit`, `_solve`, `_predict_chunk`, and `_var_chunk`.


   .. py:attribute:: x_obs


   .. py:attribute:: y_obs


   .. py:attribute:: y_mean


   .. py:attribute:: y_centered


   .. py:method:: _fit(smoothing, length_scale, optimize)
      :abstractmethod:


      Internal method to perform parameter optimization.



   .. py:method:: _solve()
      :abstractmethod:


      Internal method to solve the linear system for weights.



   .. py:method:: __call__(x_query, chunk_size=500)

      Predict values at query points.

      Args:
          x_query: Query inputs (M, D).
          chunk_size: Number of points to process per batch to avoid OOM.

      Returns:
          jnp.ndarray: Predicted values (M,).



   .. py:method:: predict_var(x_query, chunk_size=500)

      Predict posterior variance at query points.

      Args:
          x_query: Query inputs (M, D).
          chunk_size: Number of points to process per batch.

      Returns:
          jnp.ndarray: Predicted variances (M,).



   .. py:method:: _predict_chunk(chunk)
      :abstractmethod:


      Internal method for batch prediction.



   .. py:method:: _var_chunk(chunk)
      :abstractmethod:


      Internal method for batch variance.



.. py:function:: generic_negative_mll(K, y, noise_scalar)

   Calculates the negative Marginal Log-Likelihood (MLL).

   Args:
       K: Covariance matrix.
       y: Observation vector.
       noise_scalar: Noise level for regularization.

   Returns:
       float: The negative MLL value, or a high penalty if Cholesky fails.


.. py:function:: safe_cholesky_solve(K, y, noise_scalar, jitter_steps=3)

   Retries Cholesky decomposition with increasing jitter if it fails.

   Args:
       K: Covariance matrix.
       y: Observation vector.
       noise_scalar: Initial noise level.
       jitter_steps: Number of retry attempts with increasing jitter.

   Returns:
       tuple: (alpha, log_det) where alpha is the solution vector and
              log_det is the log determinant of the jittered matrix.


.. py:function:: _imq_kernel_matrix(x, epsilon)

.. py:function:: _matern_kernel_matrix(x, length_scale)

.. py:function:: _tps_kernel_matrix(x)

.. py:class:: GradientIMQ(x, y, gradients=None, smoothing=0.0001, length_scale=None, optimize=True, **_kwargs)

   Bases: :py:obj:`rgpycrumbs.surfaces._base.BaseGradientSurface`


   Gradient-enhanced Inverse Multi-Quadratic (IMQ) surface implementation.


   .. py:method:: _fit(smoothing, length_scale, optimize)

      Internal method to perform parameter optimization.



   .. py:method:: _solve()

      Internal method to solve the linear system for weights.



   .. py:method:: _predict_chunk(chunk)

      Internal method for batch prediction.



   .. py:method:: _var_chunk(chunk)

      Internal method for batch variance.



.. py:class:: GradientMatern(x, y, gradients=None, smoothing=0.0001, length_scale=None, optimize=True, **_kwargs)

   Bases: :py:obj:`rgpycrumbs.surfaces._base.BaseGradientSurface`


   Gradient-enhanced Matérn 5/2 surface implementation.


   .. py:method:: _fit(smoothing, length_scale, optimize)

      Internal method to perform parameter optimization.



   .. py:method:: _solve()

      Internal method to solve the linear system for weights.



   .. py:method:: _predict_chunk(chunk)

      Internal method for batch prediction.



   .. py:method:: _var_chunk(chunk)

      Internal method for batch variance.



.. py:class:: GradientRQ(x, y, gradients=None, smoothing=0.0001, length_scale=None, optimize=True, **_kwargs)

   Bases: :py:obj:`rgpycrumbs.surfaces._base.BaseGradientSurface`


   Symmetric Gradient-enhanced Rational Quadratic (RQ) surface implementation.


   .. py:method:: _fit(_smoothing, length_scale, optimize)

      Internal method to perform parameter optimization.



   .. py:method:: _solve()

      Internal method to solve the linear system for weights.



   .. py:method:: _predict_chunk(chunk)

      Internal method for batch prediction.



   .. py:method:: _var_chunk(chunk)

      Internal method for batch variance.



.. py:class:: GradientSE(x, y, gradients=None, smoothing=0.0001, length_scale=None, optimize=True, **_kwargs)

   Bases: :py:obj:`rgpycrumbs.surfaces._base.BaseGradientSurface`


   Gradient-enhanced Squared Exponential (SE) surface implementation.


   .. py:method:: _fit(smoothing, length_scale, optimize)

      Internal method to perform parameter optimization.



   .. py:method:: _solve()

      Internal method to solve the linear system for weights.



   .. py:method:: _predict_chunk(chunk)

      Internal method for batch prediction.



   .. py:method:: _var_chunk(chunk)

      Internal method for batch variance.



.. py:class:: NystromGradientIMQ(x, y, gradients=None, n_inducing=300, nimags=None, smoothing=0.001, length_scale=None, optimize=True, **kwargs)

   Bases: :py:obj:`rgpycrumbs.surfaces._base.BaseGradientSurface`


   Memory-efficient Nystrom-approximated gradient-enhanced IMQ surface.


   .. py:attribute:: n_inducing
      :value: 300



   .. py:attribute:: nimags
      :value: None



   .. py:method:: _fit(smoothing, length_scale, _optimize)

      Internal method to perform parameter optimization.



   .. py:method:: _solve()

      Internal method to solve the linear system for weights.



   .. py:method:: _predict_chunk(chunk)

      Internal method for batch prediction.



   .. py:method:: _var_chunk(chunk)

      Internal method for batch variance.



.. py:class:: FastIMQ(x_obs, y_obs, smoothing=0.001, length_scale=None, optimize=True, **_kwargs)

   Bases: :py:obj:`rgpycrumbs.surfaces._base.BaseSurface`


   Inverse Multi-Quadratic (IMQ) surface implementation.


   .. py:method:: _fit(smoothing, length_scale, optimize)

      Internal method to perform parameter optimization.



   .. py:method:: _solve()

      Internal method to solve the linear system for weights.



   .. py:method:: _predict_chunk(chunk)

      Internal method for batch prediction.



   .. py:method:: _var_chunk(chunk)

      Internal method for batch variance.



.. py:class:: FastMatern(x_obs, y_obs, smoothing=0.001, length_scale=None, optimize=True, **_kwargs)

   Bases: :py:obj:`rgpycrumbs.surfaces._base.BaseSurface`


   Matérn 5/2 surface implementation.


   .. py:method:: _fit(smoothing, length_scale, optimize)

      Internal method to perform parameter optimization.



   .. py:method:: _solve()

      Internal method to solve the linear system for weights.



   .. py:method:: _predict_chunk(chunk)

      Internal method for batch prediction.



   .. py:method:: _var_chunk(chunk)

      Internal method for batch variance.



.. py:class:: FastTPS(x_obs, y_obs, smoothing=0.001, optimize=True, **_kwargs)

   Thin Plate Spline (TPS) surface implementation.
   Includes a polynomial mean function and supports smoothing optimization.


   .. py:attribute:: x_obs


   .. py:attribute:: y_obs


   .. py:attribute:: y_mean


   .. py:method:: __call__(x_query, chunk_size=500)

      Predict values at query points using chunking.

      Args:
          x_query: Query inputs (M, D).
          chunk_size: Processing batch size.

      Returns:
          jnp.ndarray: Predicted values (M,).



   .. py:method:: predict_var(x_query, chunk_size=500)

      Predict posterior variance at query points.

      Args:
          x_query: Query inputs (M, D).
          chunk_size: Processing batch size.

      Returns:
          jnp.ndarray: Predicted variances (M,).



.. py:function:: get_surface_model(name)

   Factory function to retrieve surface model classes by name.

   Args:
       name: Model identifier (e.g., 'grad_matern', 'tps', 'imq').

   Returns:
       type: The model class. Defaults to GradientMatern.


